%%[
/* START APP CENTRE AUTHENTICATION CHECK */
SET @brand = 'News Corp Australia'
SET @appEventID = GUID()
SET @appC_PermissionSet = "View|Create|Edit|Delete|Execute"
SET @localTime = SystemdateToLocalDate(NOW())
SET @stateDE = 'ent.AppC_Notifications'
SET @formName = RequestParameter('FormName')
SET @formRowCount = RowCount(BuildRowSetFromString(@formName,'//'))
IF @formRowCount > 0 AND NOT EMPTY(@formName) THEN
  SET @fn_rows = BuildRowSetFromString(@formName,'//')
  for @f_pairs = 1 to @formRowCount do
    SET @fn_row = Field(Row(@fn_rows,@f_pairs),1)
    IF RowCount(BuildRowSetFromString(@fn_row,':')) > 1 THEN
      SET @f_field = Field(Row(BuildRowSetFromString(@fn_row,':'),1),1)
      SET @f_value =  Field(Row(BuildRowSetFromString(@fn_row,':'),2),1)
      TreatAsContent(CONCAT('%','%[ SET @fn_',@f_field,' = "',@f_value,'" ]%','%'))
    ENDIF
  next @f_pairs
ENDIF

IF NOT EMPTY(Lookup('ent.Users','EmailAddress','SessionID',@cookie)) THEN
  SET @active = Lookup('ent.Users','Active','SessionID',@cookie)
  SET @secret = Lookup('ent.Users','Secret','SessionID',@cookie)
  SET @contactKey = Lookup('ent.Users','ContactKey','SessionID',@cookie)
  SET @emailAddress = Lookup('ent.Users','EmailAddress','SessionID',@cookie)
  SET @secret = Lookup('ent.Users','Secret','SessionID',@cookie)
  SET @bu = Trim(Lookup('ent.Users','BU','SessionID',@cookie))
  SET @mid = Lookup('ent.Users','MemberID','SessionID',@cookie)
  SET @domain = Field(Row(BuildRowSetFromString(@emailAddress,'@'),2),1)
  SET @domainCheck = IIF(RowCount(LookupRows('ent.AppC_User_domains','Domain',@domain)) > 0,1,0)
  IF @active == 1 AND @domainCheck == 1 THEN 
    SET @access = 1
    SET @app = Lookup('ent.Users','app','SessionID',@cookie)
    SET @userName = Lookup('ent.Users','Username','SessionID',@cookie)
    SET @userBrand = Lookup('ent.Users','Brand','SessionID',@cookie)
    SET @userCurrentBrand = IIF(EMPTY(Lookup('ent.Users','CurrentBrand','SessionID',@cookie)),@userBrand,Lookup('ent.Users','CurrentBrand','SessionID',@cookie))
    SET @firstName = Lookup('ent.Users','FirstName','SessionID',@cookie)
    SET @lastName = Lookup('ent.Users','LastName','SessionID',@cookie)
    SET @lastLoginDate = Lookup('ent.Users','LastLoginDate','SessionID',@cookie)
    SET @appAccess = Lookup('ent.Users','AccessLevel','SessionID',@cookie)
    SET @role = Lookup('ent.Users','UserRole','SessionID',@cookie)
    SET @preview_mode = Lookup('ent.Users','preview_mode','SessionID',@cookie)
    SET @preview_section = Lookup('ent.Users','preview_section','SessionID',@cookie)
    IF FormatDate(@lastLoginDate,"DD-MM-YYYY") != FormatDate(@localTime, "DD-MM-YYYY") THEN
      UpsertData('ent.Users',2,'ContactKey',@contactKey,'EmailAddress',@emailAddress,'SessionID','Logged Out','app','AppC_login')
      SET @refresh_page = 1
    ENDIF
    SET @appc_uat_access = Lookup('ent.Users','appc_uat_access','SessionID',@cookie)
    SET @appc_sit_access = Lookup('ent.Users','appc_sit_access','SessionID',@cookie)
    IF (@environmentAppCentre == "UAT" AND @appc_uat_access != true) OR (@environmentAppCentre == "SIT" AND @appc_sit_access != true) THEN
      SET @refresh_page = 1
      SET @appStart = 'https://cloud.e.newsdigitalmedia.com.au/AppCentre'
    ENDIF 
  ELSE 
    SET @app = 'AppC_login'
  ENDIF
ENDIF

IF @formName == 'accessRequest' AND @access != 1 THEN
  SET @username = Trim(requestparameter("username"))
  SET @contactKey = Lookup('ent.Users','ContactKey','Username',@username)
  SET @password = MD5(Trim(requestparameter("password")))
  SET @emailAddress = Lookup('ent.Users','EmailAddress','Username',@username,'Password',@password)
  SET @firstName = Lookup('ent.Users','FirstName','Username',@username,'Password',@password)
  SET @lastName = Lookup('ent.Users','LastName','Username',@username,'Password',@password)
  SET @cookie = Lookup('ent.Users','SessionID','Username',@username)
  SET @fn_Object = 'Home'
  SET @fn_brand_state = Lookup('ent.Users','currentBrand','Username',@username)
  IF NOT EMPTY(@emailAddress) THEN
    SET @active = Lookup('ent.Users','Active','Username',@username,'Password',@password)
    SET @secret = Lookup('ent.Users','Secret','Username',@username,'Password',@password)
    SET @bu = Lookup('ent.Users','BU','Username',@username,'Password',@password)
    SET @domain = Field(Row(BuildRowSetFromString(@emailAddress,'@'),2),1)
    SET @domainCheck = IIF(RowCount(LookupRows('ent.AppC_User_domains','Domain',@domain)) > 0,1,0)
    IF @active == 1 AND @domainCheck == 1 THEN
      SET @eventID = GUID()
      SET @date = FormatDate(@localTime, "DD-MM-YYYY")
      SET @HashCheck = SHA256(concat(@username,@eventID, @date, @brand),"UTF-16")
      UpsertData('ent.Users',2,'Username',@username,'ContactKey',@contactKey,'LastLoginDate',@localTime,'GUID',@eventID,'SessionID',@HashCheck,'app','Home','ErrorMessage','')
      InsertData('ent.userLogins','Username',@username,'ContactKey',@contactKey,'LoginDate',@localTime,'SessionID',@HashCheck,'EmailAddress',@emailAddress,'FirstName',@firstName,'LastName',@lastName)
      SET @layer = 'accessGranted'
      SET @cookie = @HashCheck
    ELSE
      SET @Message = 
        IIF(@active != 1,'This user has been disabled.',
          IIF(@domainCheck != 1,'Invalid email address.','OK'))
    ENDIF
  ELSE
    SET @Message = 'Incorrect password for this user.'
  ENDIF
ENDIF

SET @logOut = Requestparameter('LOGOUT')
IF @logOut == 'LOGOUT' AND @access == 1 THEN
  SET @contactKey = Lookup('ent.Users','ContactKey','SessionID',@cookie)
  SET @username = Lookup('ent.Users','Username','SessionID',@cookie)
  UpsertData('ent.Users',2,'ContactKey',@contactKey,'Username',@username,'SessionID','Logged Out','app','AppC_login')
  SET @refresh_page = 1
ELSEIF @logOut == 'LOGOUT' AND @access != 1 THEN
  SET @refresh_page = 1
ENDIF

SET @navSel = Requestparameter('navSel')
IF NOT EMPTY(@navSel) AND @access == 1 THEN
  SET @app = @navSel
  SET @contactKey = Lookup('ent.Users','ContactKey','SessionID',@cookie)
  SET @username = Lookup('ent.Users','Username','SessionID',@cookie)
  UpsertData('ent.Users',2,'ContactKey',@contactKey,'Username',@username,'app',@app)
  SET @formValue = '' SET @action = '' SET @sourceIdValue = '' SET @CurrentAppSection = 1 SET @DisplayedFormMessage = 1 SET @formName = 'navSel'
ENDIF

]%%
<script runat="server" language="javascript">
  var access = Variable.GetValue("@access");
  var layer = Variable.GetValue("@layer");
  var logout = Variable.GetValue("@logOut");
  if (layer == 'accessGranted') {
    var token = Variable.GetValue("@HashCheck");
    Platform.Response.SetCookie("token",token);
    Variable.SetValue("@layer","accessPersisted");
  } else if (access != 1 || logout == 'LOGOUT' || layer == 'accessDenied') {
    Platform.Response.SetCookie("token",'');
  }
</script>
%%[
/* END APP CENTRE AUTHENTICATION CHECK */ 
/* START APP CENTRE ENVIRONMENT SETUP */ 
IF @layer == 'accessPersisted' OR NOT EMPTY(@navSel) THEN SET @refresh_page = 1 ENDIF
SET @StandardVars = Concat('"CreatedBy","',@userName,'","CreatedDate","',@localTime,'","UpdatedBy","',@userName,'","UpdatedDate","',@localTime,'"')
SET @new_Active = IIF(@ShowInactive == 1,0,1)
SET @AppStateEnvironment = IIF(EMPTY(Lookup('ent.Users','Environment','EmailAddress',@EmailAddress)),'PROD',Lookup('ent.Users','Environment','EmailAddress',@EmailAddress))
SET @OppositEnv = IIF(@AppStateEnvironment == 'UAT','PROD','UAT')
SET @sourceTable = Lookup('ent.appC_applications',IIF(@AppStateEnvironment == 'UAT','sourceTable_UAT','sourceTable'),'Name',@app)
SET @sourceTable_reverse = Lookup('ent.appC_applications',IIF(@AppStateEnvironment == 'UAT','sourceTable','sourceTable_UAT'),'Name',@app)
SET @sourceEnvBadge = IIF(@AppStateEnvironment == 'UAT','','checked')
SET @AppCPermissionTable = IIF(@AppStateEnvironment == 'UAT','ent.AppC_AppPermissions_UAT','ent.AppC_AppPermissions')
SET @de_abi = IIF(@AppStateEnvironment == 'UAT','ent.All_Brand_Info_UAT','ent.All_Brand_Info')
SET @de_abi_reverse = IIF(@AppStateEnvironment == 'UAT','ent.All_Brand_Info','ent.All_Brand_Info_UAT')
SET @friendly_brandName = Lookup(@de_abi,'friendly_name','Brand',@userCurrentBrand)

SET @de_eca = IIF(@AppStateEnvironment == 'UAT','ent.email_contentBlock_areas_UAT','ent.email_contentBlock_areas')
SET @de_emailObject = IIF(@AppStateEnvironment == 'UAT','ent.EmailObject_UAT','ent.EmailObject')
SET @de_emailObject_reverse = IIF(@AppStateEnvironment == 'UAT','ent.EmailObject','ent.EmailObject_UAT')
SET @de_eca_reverse = IIF(@AppStateEnvironment == 'UAT','ent.email_contentBlock_areas','ent.email_contentBlock_areas_UAT')
SET @GPCMetadataDE = IIF(@AppStateEnvironment == 'UAT','ent.TEST GPC Newsletter Metadata','ent.GPC Newsletter Metadata')
SET @AffiliatesMetadataDE = IIF(@AppStateEnvironment == 'UAT','ent.TEST Affiliates Metadata','ent.TEST Affiliates Metadata')
SET @PandLMappingDE = IIF(@AppStateEnvironment == 'UAT','ent.TEST Permission and ListID Mapping','ent.Permission and ListID Mapping')
SET @sourceTable_history = Concat(@sourceTable,'_History')
SET @sourceTable_history_reverse = Concat(@sourceTable_reverse,'_History')
SET @ClearSiteCache = IIF(@AppStateEnvironment == 'UAT','https://uat.newsletters.news.com.au/api/clearCache','https://www.newsletters.news.com.au/api/clearCache')
SET @NSLPreviewButton = IIF(@AppStateEnvironment == 'UAT','https://www.newsletters.newsuat.com.au/','https://www.newsletters.news.com.au/') 
SET @PDE_DailyTotals = IIF(@AppStateEnvironment == 'UAT','ent.PDE_D_UAT','ent.PDE_D')
SET @GPCMetadataDE_reverse = IIF(@OppositEnv == 'UAT','ent.TEST GPC Newsletter Metadata','ent.GPC Newsletter Metadata')
SET @PandLMappingDE_reverse = IIF(@OppositEnv == 'UAT','ent.TEST Permission and ListID Mapping','ent.Permission and ListID Mapping')
SET @ClearSiteCache_reverse = IIF(@OppositEnv == 'UAT','https://uat.newsletters.news.com.au/api/clearCache','https://www.newsletters.news.com.au/api/clearCache')
SET @PDE_DailyTotals_reverse = IIF(@OppositEnv == 'UAT','ent.PDE_D_UAT','ent.PDE_D')
SET @NSLSourceTable = IIF(@AppStateEnvironment == 'UAT','ent.All_Newsletter_Info_UAT','ent.All_Newsletter_Info')
SET @NSLSourceTable_reverse = IIF(@AppStateEnvironment == 'UAT','ent.All_Newsletter_Info','ent.All_Newsletter_Info_UAT')
SET @de_ani = IIF(@AppStateEnvironment == 'UAT','ent.All_Newsletter_Info_UAT','ent.All_Newsletter_Info')
SET @de_ani_reverse = IIF(@AppStateEnvironment == 'UAT','ent.All_Newsletter_Info','ent.All_Newsletter_Info_UAT')
SET @PushDailyTotals = IIF(@AppStateEnvironment == 'UAT','ent.PushTag_DateLog_UAT','ent.PushTag_DateLog')
SET @cust_subs_daily_totals = IIF(@AppStateEnvironment == 'UAT','ent.Cust_Subs_D_UAT','ent.Cust_Subs_D')
SET @es_data_de = 'ent.Account_Send_Summary_cleansed' 
SET @default_emailComponents = IIF(@AppStateEnvironment == 'UAT','ent.UAT_default_emailComponents','ent.default_emailComponents')
SET @default_emailComponents_reverse = IIF(@AppStateEnvironment == 'UAT','ent.default_emailComponents','ent.UAT_default_emailComponents')
SET @de_dec = @default_emailComponents
SET @de_dec_reverse = @default_emailComponents_reverse
SET @custom_emailComponents = IIF(@AppStateEnvironment == 'UAT','ent.custom_emailComponents_UAT','ent.custom_emailComponents')
SET @custom_emailComponents_reverse = IIF(@AppStateEnvironment == 'UAT','ent.custom_emailComponents','ent.custom_emailComponents_UAT')
SET @default_templateComponents = IIF(@AppStateEnvironment == 'UAT','ent.default_templateComponents_UAT','ent.default_templateComponents')
SET @default_templateComponents_reverse = IIF(@AppStateEnvironment == 'UAT','ent.default_templateComponents','ent.default_templateComponents_UAT')
SET @de_dtc = @default_templateComponents
SET @de_dtc_reverse = @default_templateComponents_reverse
SET @de_cec = @custom_emailComponents
SET @de_cec_reverse = @custom_emailComponents_reverse
SET @de_appC_cc = IIF(@environmentAppCentre == 'UAT','ent.AppC_components_code',IIF(@environmentAppCentre == 'SIT','AppC_components_SIT_code','ent.AppC_components_code'))
SET @sysFieldsDe = IIF(@AppStateEnvironment == 'UAT','ent.system_field__obj_UAT','ent.system_field__obj')
SET @de_et_obj = IIF(@AppStateEnvironment == 'UAT','ent.email_template__obj_UAT','ent.email_template__obj')
SET @customDropdown_obj = IIF(@AppStateEnvironment == 'UAT','ent.customDropdown__obj_UAT','ent.customDropdown__obj')
SET @emailTemplates_HF = IIF(@AppStateEnvironment == 'UAT','ent.emailTemplates_UAT','ent.emailTemplates')
SET @de_cbc = IIF(@AppStateEnvironment == 'UAT','ent.custom_brandComponents_UAT','ent.custom_brandComponents')
SET @de_cbc_reverse = IIF(@AppStateEnvironment == 'UAT','ent.custom_brandComponents','ent.custom_brandComponents_UAT')
SET @de_p_obj = IIF(@AppStateEnvironment == 'UAT','ent.programs_obj_uat','ent.programs_obj')
SET @de_msg_groups = IIF(@AppStateEnvironment == 'UAT','ent.message_groups_uat','ent.message_groups')
SET @de_appC_send_log = IIF(@AppStateEnvironment == 'UAT','ent.appC_send_log_uat','ent.appC_send_log')
SET @de_appC_send_error_log = IIF(@AppStateEnvironment == 'UAT','ent.appC_send_error_log_uat','ent.appC_send_error_log')
SET @de_cssg = IIF(@AppStateEnvironment == 'UAT','ent.css_groups_UAT','ent.css_groups')
SET @de_email_css = IIF(@AppStateEnvironment == 'UAT','ent.email_css_groups_UAT','ent.email_css_groups')
SET @de_email_json = IIF(@AppStateEnvironment == 'UAT','ent.email_json_cache_UAT','ent.email_json_cache')
SET @de_email_json_reverse = IIF(@AppStateEnvironment == 'UAT','ent.email_json_cache','ent.email_json_cache_UAT')
SET @de_email_css_reverse = IIF(@AppStateEnvironment == 'UAT','ent.email_css_groups','ent.email_css_groups_UAT')
SET @de_brand_css = IIF(@AppStateEnvironment == 'UAT','ent.brand_css_groups_UAT','ent.brand_css_groups')
SET @de_brand_css_reverse = IIF(@AppStateEnvironment == 'UAT','ent.brand_css_groups','ent.brand_css_groups_UAT')
SET @de_template_css = IIF(@AppStateEnvironment == 'UAT','ent.template_css_groups_UAT','ent.template_css_groups')
SET @de_ecc = IIF(@AppStateEnvironment == 'UAT','ent.email_content_cache_UAT','ent.email_content_cache')
SET @de_ecc_reverse = IIF(@AppStateEnvironment == 'UAT','ent.email_content_cache','ent.email_content_cache_UAT')
SET @de_bcc = IIF(@AppStateEnvironment == 'UAT','ent.brand_content_cache_UAT','ent.brand_content_cache')
SET @de_bcc_reverse = IIF(@AppStateEnvironment == 'UAT','ent.brand_content_cache','ent.brand_content_cache_UAT')
SET @ecc_api = IIF(@AppStateEnvironment == 'UAT','https://cloud.e.newsdigitalmedia.com.au/uat_save_content_api','https://cloud.e.newsdigitalmedia.com.au/save_content_api')
SET @appC_brand_access_de = IIF(@AppStateEnvironment == 'UAT','ent.UAT_appC_brand_access','ent.appC_brand_access')
SET @appC_brand_access_de_reverse = IIF(@OppositEnv == 'UAT','ent.UAT_appC_brand_access','ent.appC_brand_access')
SET @AppCPermissionTable = IIF(@AppStateEnvironment == 'UAT','ent.AppC_AppPermissions_UAT','ent.AppC_AppPermissions')
SET @AppCPermissionTable_reverse = IIF(@OppositEnv == 'UAT','ent.AppC_AppPermissions_UAT','ent.AppC_AppPermissions')
SET @de_eca_backup = Concat(@de_eca,'_backup')
SET @de_ecc_backup = Concat(@de_ecc,'_backup')
SET @de_cec_backup = Concat(@de_cec,'_backup')

IF @FormName == Concat('Id:GlobalSearch//Action:View//target_field:',@fn_target_field) THEN
  SET @NewSearchVariable = Replace(Trim(Requestparameter('GlobalSearchValue')),' ','')
  SET @fn_SubObjValue = 'close'
  IF EMPTY(@NewSearchVariable) THEN
    SET @fn_Value = '' SET @DisplayedFormMessage = 1 SET @CurrentBrandFilter = ''
  ELSE
    IF RowCount(LookupRows(@de_abi,'Brand',@NewSearchVariable)) > 0 THEN
      IF Lookup(@appC_brand_access_de,'Access',"EmailAddress",@emailAddress,"Brand",@NewSearchVariable) == true 
      AND Lookup(@AppCPermissionTable,"Access","EmailAddress",@emailAddress,"ParentApp",'Brands',"Type",'View') == true THEN
        SET @showInactive = IIF(Lookup(@de_abi,'Active','Brand',@NewSearchVariable) == true,'0','1')
        SET @fn_Object = 'Brand Editor' SET @fn_value = @NewSearchVariable
        SET @app = 'Brand Editor'
        SET @sourceTable = Lookup('ent.appC_applications',IIF(@AppStateEnvironment == 'UAT','sourceTable_UAT','sourceTable'),'Name',@app)
        SET @sourceTable_reverse = Lookup('ent.appC_applications',IIF(@AppStateEnvironment == 'UAT','sourceTable','sourceTable_UAT'),'Name',@app)
        SET @sourceIdValue = @NewSearchVariable
        SET @CurrentBrandFilter = @NewSearchVariable
        SET @fn_brand_state = @CurrentBrandFilter
      ELSEIF Lookup(@appC_brand_access_de,'Access',"EmailAddress",@emailAddress,"Brand",@NewSearchVariable) != true THEN
        SET @fn_Displayed = 0 SET @FormMessage = Concat('You do not have permission to access the brand <strong>',@NewSearchVariable,'</strong>. Please log a <a href="https://sofi.newscorp.com/esc?id=sc_cat_item&table=sc_cat_item&sys_id=ae90bf888724a510d82afcc6cebb35d9" target="_blank">SOFI ticket</a> to request access.')
        SET @noMatch = 1 SET @formStatus = 0
      ELSE 
        SET @fn_Displayed = 0 SET @FormMessage = Concat('You do not have permission to access the <strong>Brand Editor</strong> app. Please log a <a href="https://sofi.newscorp.com/esc?id=sc_cat_item&table=sc_cat_item&sys_id=ae90bf888724a510d82afcc6cebb35d9" target="_blank">SOFI ticket</a> to request access.')
        SET @noMatch = 1 SET @formStatus = 0
      ENDIF
    ELSEIF RowCount(LookupRows(@de_abi_reverse,'Brand',@NewSearchVariable)) > 0 THEN
      IF Lookup(@appC_brand_access_de_reverse,'Access',"EmailAddress",@emailAddress,"Brand",@NewSearchVariable) == true 
      AND Lookup(@AppCPermissionTable_reverse,"Access","EmailAddress",@emailAddress,"ParentApp",'Brands',"Type",'View') == true THEN
        SET @showInactive = IIF(Lookup(@de_abi_reverse,'Active','Brand',@NewSearchVariable) == true,'0','1')
        SET @fn_Object = 'Brand Editor' SET @fn_value = @NewSearchVariable
        SET @app = 'Brand Editor'
        SET @fn_Environment = @OppositEnv
        SET @sourceTable = Lookup('ent.appC_applications',IIF(@fn_Environment == 'UAT','sourceTable_UAT','sourceTable'),'Name',@app)
        SET @sourceTable_reverse = Lookup('ent.appC_applications',IIF(@fn_Environment == 'UAT','sourceTable','sourceTable_UAT'),'Name',@app)
        SET @sourceIdValue = @NewSearchVariable
        SET @CurrentBrandFilter = @NewSearchVariable
        SET @fn_brand_state = @CurrentBrandFilter
      ELSEIF Lookup(@appC_brand_access_de_reverse,'Access',"EmailAddress",@emailAddress,"Brand",@NewSearchVariable) != true THEN
        SET @fn_Displayed = 0 SET @FormMessage = Concat('You do not have permission to access the brand <strong>',@NewSearchVariable,'</strong>. Please log a <a href="https://sofi.newscorp.com/esc?id=sc_cat_item&table=sc_cat_item&sys_id=ae90bf888724a510d82afcc6cebb35d9" target="_blank">SOFI ticket</a> to request access.')
        SET @noMatch = 1 SET @formStatus = 0
      ELSE 
        SET @fn_Displayed = 0 SET @FormMessage = Concat('You do not have permission to access the <strong>Brand Editor</strong> app. Please log a <a href="https://sofi.newscorp.com/esc?id=sc_cat_item&table=sc_cat_item&sys_id=ae90bf888724a510d82afcc6cebb35d9" target="_blank">SOFI ticket</a> to request access.')
        SET @noMatch = 1 SET @formStatus = 0
      ENDIF
    ELSEIF RowCount(LookupRows(@de_ani,'NewsletterID',@NewSearchVariable)) > 0 THEN
      SET @CurrentBrandFilter = Lookup(@de_ani,'Brand','NewsletterID',@NewSearchVariable)
      IF Lookup(@appC_brand_access_de,'Access',"EmailAddress",@emailAddress,"Brand",@CurrentBrandFilter) == true 
      AND Lookup(@AppCPermissionTable,"Access","EmailAddress",@emailAddress,"ParentApp",'GPC Tiles',"Type",'View') == true THEN
        SET @fn_value = @NewSearchVariable
        SET @app = IIF(@fn_target_field == 'Newsletter Preference History','Newsletter Preference History','Tile Editor')
        SET @fn_Object = @app
        SET @sourceTable = Lookup('ent.appC_applications',IIF(@AppStateEnvironment == 'UAT','sourceTable_UAT','sourceTable'),'Name',@app)
        SET @sourceTable_reverse = Lookup('ent.appC_applications',IIF(@AppStateEnvironment == 'UAT','sourceTable','sourceTable_UAT'),'Name',@app)
        SET @sourceIdValue = @NewSearchVariable
        SET @fn_brand_state = @CurrentBrandFilter
        SET @showInactive = IIF(Lookup(@de_ani,'Active','NewsletterID',@NewSearchVariable) == true,'0','1')
      ELSEIF Lookup(@appC_brand_access_de,'Access',"EmailAddress",@emailAddress,"Brand",@CurrentBrandFilter) != true THEN
        SET @fn_Displayed = 0 SET @FormMessage = Concat('You do not have permission to access the brand <strong>',@CurrentBrandFilter,'</strong>. Please log a <a href="https://sofi.newscorp.com/esc?id=sc_cat_item&table=sc_cat_item&sys_id=ae90bf888724a510d82afcc6cebb35d9" target="_blank">SOFI ticket</a> to request access.')
        SET @noMatch = 1 SET @formStatus = 0
      ELSE 
        SET @fn_Displayed = 0 SET @FormMessage = Concat('You do not have permission to access the <strong>Tile Editor</strong> app. Please log a <a href="https://sofi.newscorp.com/esc?id=sc_cat_item&table=sc_cat_item&sys_id=ae90bf888724a510d82afcc6cebb35d9" target="_blank">SOFI ticket</a> to request access.')
        SET @noMatch = 1 SET @formStatus = 0
      ENDIF
    ELSEIF RowCount(LookupRows(@de_ani_reverse,'NewsletterID',@NewSearchVariable)) > 0 THEN
      SET @CurrentBrandFilter = Lookup(@de_ani_reverse,'Brand','NewsletterID',@NewSearchVariable)
      IF Lookup(@appC_brand_access_de_reverse,'Access',"EmailAddress",@emailAddress,"Brand",@CurrentBrandFilter) == true 
      AND Lookup(@AppCPermissionTable_reverse,"Access","EmailAddress",@emailAddress,"ParentApp",'GPC Tiles',"Type",'View') == true THEN
        SET @fn_value = @NewSearchVariable
        SET @app = IIF(@fn_target_field == 'Newsletter Preference History','Newsletter Preference History','Tile Editor')
        SET @fn_Object = @app
        SET @fn_Environment = @OppositEnv
        SET @sourceTable = Lookup('ent.appC_applications',IIF(@fn_Environment == 'UAT','sourceTable_UAT','sourceTable'),'Name',@app)
        SET @sourceTable_reverse = Lookup('ent.appC_applications',IIF(@fn_Environment == 'UAT','sourceTable','sourceTable_UAT'),'Name',@app)
        SET @sourceIdValue = @NewSearchVariable
        SET @fn_brand_state = @CurrentBrandFilter
        SET @showInactive = IIF(Lookup(@de_ani_reverse,'Active','NewsletterID',@NewSearchVariable) == true,'0','1')
      ELSEIF Lookup(@appC_brand_access_de_reverse,'Access',"EmailAddress",@emailAddress,"Brand",@CurrentBrandFilter) != true THEN
        SET @fn_Displayed = 0 SET @FormMessage = Concat('You do not have permission to access the brand <strong>',@CurrentBrandFilter,'</strong>. Please log a <a href="https://sofi.newscorp.com/esc?id=sc_cat_item&table=sc_cat_item&sys_id=ae90bf888724a510d82afcc6cebb35d9" target="_blank">SOFI ticket</a> to request access.')
        SET @noMatch = 1 SET @formStatus = 0
      ELSE 
        SET @fn_Displayed = 0 SET @FormMessage = Concat('You do not have permission to access the <strong>Tile Editor</strong> app. Please log a <a href="https://sofi.newscorp.com/esc?id=sc_cat_item&table=sc_cat_item&sys_id=ae90bf888724a510d82afcc6cebb35d9" target="_blank">SOFI ticket</a> to request access.')
        SET @noMatch = 1 SET @formStatus = 0
      ENDIF
    ELSEIF RowCount(LookupRows(@de_emailObject,'EmailName',@NewSearchVariable)) > 0 THEN
      SET @CurrentBrandFilter = Lookup(@de_emailObject,'Brand','EmailName',@NewSearchVariable)
      IF Lookup(@appC_brand_access_de,'Access',"EmailAddress",@emailAddress,"Brand",@CurrentBrandFilter) == true 
      AND Lookup(@AppCPermissionTable,"Access","EmailAddress",@emailAddress,"ParentApp",'Emails',"Type",'View') == true THEN
        SET @fn_value = @NewSearchVariable
        SET @app = IIF(@fn_target_field == 'Email Send History','Email Send History','Email Editor')
        SET @fn_Object = @app
        SET @sourceTable = Lookup('ent.appC_applications',IIF(@AppStateEnvironment == 'UAT','sourceTable_UAT','sourceTable'),'Name',@app)
        SET @sourceTable_reverse = Lookup('ent.appC_applications',IIF(@AppStateEnvironment == 'UAT','sourceTable','sourceTable_UAT'),'Name',@app)
        SET @sourceIdValue = @NewSearchVariable
        SET @CurrentBrandFilter = Lookup(@de_emailObject,'Brand','EmailName',@NewSearchVariable)
        SET @fn_brand_state = @CurrentBrandFilter
        SET @showInactive = IIF(Lookup(@de_emailObject,'Active','EmailName',@NewSearchVariable) == true,'0','1')
      ELSEIF Lookup(@appC_brand_access_de,'Access',"EmailAddress",@emailAddress,"Brand",@CurrentBrandFilter) != true THEN
        SET @fn_Displayed = 0 SET @FormMessage = Concat('You do not have permission to access the brand <strong>',@CurrentBrandFilter,'</strong>. Please log a <a href="https://sofi.newscorp.com/esc?id=sc_cat_item&table=sc_cat_item&sys_id=ae90bf888724a510d82afcc6cebb35d9" target="_blank">SOFI ticket</a> to request access.')
        SET @noMatch = 1 SET @formStatus = 0
      ELSE 
        SET @fn_Displayed = 0 SET @FormMessage = Concat('You do not have permission to access the <strong>Email Editor</strong> app. Please log a <a href="https://sofi.newscorp.com/esc?id=sc_cat_item&table=sc_cat_item&sys_id=ae90bf888724a510d82afcc6cebb35d9" target="_blank">SOFI ticket</a> to request access.')
        SET @noMatch = 1 SET @formStatus = 0
      ENDIF
    ELSEIF RowCount(LookupRows(@de_emailObject_reverse,'EmailName',@NewSearchVariable)) > 0 THEN
      SET @CurrentBrandFilter = Lookup(@de_emailObject_reverse,'Brand','EmailName',@NewSearchVariable)
      IF Lookup(@appC_brand_access_de_reverse,'Access',"EmailAddress",@emailAddress,"Brand",@CurrentBrandFilter) == true 
      AND Lookup(@AppCPermissionTable_reverse,"Access","EmailAddress",@emailAddress,"ParentApp",'Emails',"Type",'View') == true THEN
        SET @fn_value = @NewSearchVariable
        SET @app = IIF(@fn_target_field == 'Email Send History','Email Send History','Email Editor')
        SET @fn_Object = @app
        SET @sourceTable = Lookup('ent.appC_applications',IIF(@AppStateEnvironment == 'UAT','sourceTable_UAT','sourceTable'),'Name',@app)
        SET @sourceTable_reverse = Lookup('ent.appC_applications',IIF(@AppStateEnvironment == 'UAT','sourceTable','sourceTable_UAT'),'Name',@app)
        SET @sourceIdValue = @NewSearchVariable
        SET @CurrentBrandFilter = Lookup(@de_emailObject_reverse,'Brand','EmailName',@NewSearchVariable)
        SET @fn_brand_state = @CurrentBrandFilter
        SET @fn_Environment = @OppositEnv
        SET @showInactive = IIF(Lookup(@de_emailObject_reverse,'Active','EmailName',@NewSearchVariable) == true,'0','1')
        SET @previewMode = 1
      ELSEIF Lookup(@appC_brand_access_de_reverse,'Access',"EmailAddress",@emailAddress,"Brand",@CurrentBrandFilter) != true THEN
        SET @fn_Displayed = 0 SET @FormMessage = Concat('You do not have permission to access the brand <strong>',@CurrentBrandFilter,'</strong> in the <strong>',@OppositEnv,'</strong> environment. Please log a <a href="https://sofi.newscorp.com/esc?id=sc_cat_item&table=sc_cat_item&sys_id=ae90bf888724a510d82afcc6cebb35d9" target="_blank">SOFI ticket</a> to request access.')
        SET @noMatch = 1 SET @formStatus = 0
      ELSE 
        SET @fn_Displayed = 0 SET @FormMessage = Concat('You do not have permission to access the <strong>Email Editor</strong> app in the <strong>',@OppositEnv,'</strong> environment. Please log a <a href="https://sofi.newscorp.com/esc?id=sc_cat_item&table=sc_cat_item&sys_id=ae90bf888724a510d82afcc6cebb35d9" target="_blank">SOFI ticket</a> to request access.')
        SET @noMatch = 1 SET @formStatus = 0
      ENDIF
    ELSE
      SET @fn_Displayed = 0 SET @FormMessage = Concat('Could not find ',@NewSearchVariable,'.')
      SET @noMatch = 1 SET @formStatus = 0
    ENDIF
    UpdateData('ent.Users',1,'Username',@userName,'preview_section','')
    IF @noMatch == 1 THEN SET @fn_Displayed = 0 ELSE SET @fn_Displayed = 1 ENDIF
  ENDIF
ENDIF

SET @ParentApp = Lookup('ent.appC_parent_apps','Name','Id',Lookup('ent.appC_applications','parent_Id','Name',@app))
SET @AppObject = Lookup('ent.appC_applications','Name','Name',@app)
SET @Path = Concat(@ParentApp,' / ',@app)
SET @App_content = IIF(@environmentAppCentre == 'UAT',Lookup('ent.appC_applications','list_view_url_code','Name',@app),Lookup('ent.appC_applications','list_view_de_code','Name',@app))
SET @App_content2 = IIF(@environmentAppCentre == 'UAT',Lookup('ent.appC_applications','single_view_url_code','Name',@app),Lookup('ent.appC_applications','single_view_de_code','Name',@app))
SET @sourceIdField = Lookup('ent.appC_applications','sourceIdField','Name',@app)
SET @ui_name = Lookup('ent.appC_applications','ui_name','Name',@app)

SET @AppAll = Lookup(@AppCPermissionTable,'Access','EmailAddress',@EmailAddress,'ParentApp',@ParentApp,'Type','All')
SET @AppView = Lookup(@AppCPermissionTable,'Access','EmailAddress',@EmailAddress,'ParentApp',@ParentApp,'Type','View')
SET @AppCreate = Lookup(@AppCPermissionTable,'Access','EmailAddress',@EmailAddress,'ParentApp',@ParentApp,'Type','Create') 
SET @AppEdit = Lookup(@AppCPermissionTable,'Access','EmailAddress',@EmailAddress,'ParentApp',@ParentApp,'Type','Edit') 
SET @AppDelete = Lookup(@AppCPermissionTable,'Access','EmailAddress',@EmailAddress,'ParentApp',@ParentApp,'Type','Delete')
SET @AppExecute = Lookup(@AppCPermissionTable,'Access','EmailAddress',@EmailAddress,'ParentApp',@ParentApp,'Type','Execute')
SET @AppAll_reverse = Lookup(@AppCPermissionTable_reverse,'Access','EmailAddress',@EmailAddress,'ParentApp',@ParentApp,'Type','All')
SET @AppView_reverse = Lookup(@AppCPermissionTable_reverse,'Access','EmailAddress',@EmailAddress,'ParentApp',@ParentApp,'Type','View')
SET @AppCreate_reverse = Lookup(@AppCPermissionTable_reverse,'Access','EmailAddress',@EmailAddress,'ParentApp',@ParentApp,'Type','Create') 
SET @AppEdit_reverse = Lookup(@AppCPermissionTable_reverse,'Access','EmailAddress',@EmailAddress,'ParentApp',@ParentApp,'Type','Edit') 
SET @AppDelete_reverse = Lookup(@AppCPermissionTable_reverse,'Access','EmailAddress',@EmailAddress,'ParentApp',@ParentApp,'Type','Delete') 
SET @AppExecute_reverse = Lookup(@AppCPermissionTable_reverse,'Access','EmailAddress',@EmailAddress,'ParentApp',@ParentApp,'Type','Execute') 

IF NOT EMPTY(Lookup(@StateDE,'EventID','Username',@Username,'SessionID',@cookie,'Object',@AppObject)) THEN
  SET @AppStateID = Field(Row(LookupOrderedRows(@StateDE,0,'DateAdded DESC','Username',@Username,'SessionID',@cookie,'Object',@AppObject),1),'EventID')
  IF @FormName == Concat('Id:GlobalSearch//Action:View//target_field:',@fn_target_field) THEN
  ELSE 
    SET @ShowInactive = Lookup(@StateDE,'ShowInactive','EventID',@AppStateID)
  ENDIF 
  SET @activeStatusName = IIF(@ShowInactive == true,'Inactive','Active')
  SET @NStatusText = IIF(@ShowInactive == true,'Activate','Deactivate')
  SET @activeStatusName_opposite = IIF(@activeStatusName == 'Active','Inactive','Active')
  SET @sourceActiveBadge = IIF(@activeStatusName == 'Active','checked','')
  SET @sourceEnvBadge = IIF(@AppStateEnvironment == 'UAT','','checked')
  SET @DisplayMessage = IIF(Lookup(@StateDE,'Displayed','EventID',@AppStateID) == false,1,0)
  IF @DisplayMessage == 1 THEN 
    SET @AppCMessage = Lookup(@StateDE,'Message','EventID',@AppStateID)
    SET @EventIdMessage = @AppStateID
    SET @StatusOfMessage = IIF(Lookup(@StateDE,'Status','EventID',@AppStateID) == true, 'success','danger')
  ENDIF
  SET @EventAction = Lookup(@StateDE,'Action','EventID',@AppStateID)
  SET @CurrentAppSection = IIF(EMPTY(Lookup(@StateDE,'Section','EventID',@AppStateID)),1,Lookup(@StateDE,'Section','EventID',@AppStateID))
  SET @CurrentAppSectionName = Lookup(@StateDE,'SectionName','EventID',@AppStateID)
  SET @sourceSubObjTableValue = Lookup(@StateDE,'SubObject','EventID',@AppStateID)
  SET @sourceObject = Lookup(@StateDE,'Object','EventID',@AppStateID)
  SET @sourceIdSubjValue = Lookup(@StateDE,'SubObjValue','EventID',@AppStateID)
  SET @EventStatus = Lookup(@StateDE,'Status','EventID',@AppStateID)
  SET @sourceIdValue = Lookup(@StateDE,'Value','EventID',@AppStateID)
  SET @CurrentFormName = Lookup(@StateDE,'FormName','EventID',@AppStateID)
  SET @CurrentProgress = Lookup(@StateDE,'Progress','EventID',@AppStateID)
  SET @CurrentTarget_field = Lookup(@StateDE,'target_field','EventID',@AppStateID)
  SET @CurrentBrand_state = Lookup(@StateDE,'brand_state','EventID',@AppStateID)
  SET @CurrentFields_state = Lookup(@StateDE,'fields_state','EventID',@AppStateID)
  IF NOT EMPTY(@sourceTable) THEN
    SET @previewMode = IIF(NOT EMPTY(@sourceIdValue) AND RowCount(LookupRows(@sourceTable,@sourceIdField,@sourceIdValue)) > 0,1,0)
    SET @App_content = IIF(@previewMode == 1,IIF(NOT EMPTY(@App_content2),@App_content2,@App_content),@App_content)
  ENDIF
ELSE
  SET @AppStateID = TreatAsContent(GUID())
  SET @ShowInactive = 0
  SET @activeStatusName = 'Active'
  SET @activeStatusName_opposite = 'Inactive'
  SET @sourceActiveBadge = IIF(@activeStatusName == 'Active','checked','')
ENDIF

SET @OppositeStatus = IIF(@ShowInactive == 1,0,1)
SET @navColor = IIF(@AppStateEnvironment == 'UAT' OR EMPTY(@AppStateEnvironment),'btn-secondary','btn-primary')
SET @CurrentToggleSortBy = IIF(EMPTY(@CurrentAppSectionName),IIF(@app == 'Home','DateAdded DESC',IIF(@app == 'Users','LastLoginDate DESC','UpdatedDate DESC')),@CurrentAppSectionName)

IF @AppAccess == 'Local' THEN SET @brand_state = @UserBrand ENDIF
IF @FormName == 'FilterBrand' THEN
  SET @NewFilterBrandValue = Requestparameter('FilterBrandName')
  SET @fn_Value = '' SET @DisplayedFormMessage = 0 SET @Action = 'Filter' SET @userCurrentBrand = @NewFilterBrandValue SET @FormMessage = Concat('Filtered on brand ',@NewFilterBrandValue,'.') SET @CurrentAppSection = 1
  UpdateData('ent.Users',1,'Username',@userName,'currentBrand',@NewFilterBrandValue)
ENDIF

IF indexOf(@FormName,'FilterEmail') > 0 THEN
  SET @NewSearchVariable = @fn_Value
  IF RowCount(LookupRows(@de_emailObject,'EmailName',@NewSearchVariable)) > 0 THEN
    SET @CurrentBrandFilter = Lookup(@de_emailObject,'Brand','EmailName',@NewSearchVariable)
    IF Lookup(@appC_brand_access_de,'Access',"EmailAddress",@emailAddress,"Brand",@CurrentBrandFilter) == true 
    AND Lookup(@AppCPermissionTable,"Access","EmailAddress",@emailAddress,"ParentApp",'Emails',"Type",'View') == true THEN
        SET @fn_value = @NewSearchVariable
        SET @app = IIF(@fn_target_field == 'Email Send History','Email Send History','Email Editor')
        SET @fn_Object = @app
        SET @sourceTable = Lookup('ent.appC_applications',IIF(@AppStateEnvironment == 'UAT','sourceTable_UAT','sourceTable'),'Name',@app)
        SET @sourceTable_reverse = Lookup('ent.appC_applications',IIF(@AppStateEnvironment == 'UAT','sourceTable','sourceTable_UAT'),'Name',@app)
        SET @sourceIdValue = @NewSearchVariable
        SET @CurrentBrandFilter = Lookup(@de_emailObject,'Brand','EmailName',@NewSearchVariable)
        SET @fn_brand_state = @CurrentBrandFilter
        SET @showInactive = IIF(Lookup(@de_emailObject,'Active','EmailName',@NewSearchVariable) == true,'0','1')
    ELSEIF Lookup(@appC_brand_access_de,'Access',"EmailAddress",@emailAddress,"Brand",@CurrentBrandFilter) != true THEN
        SET @fn_Displayed = 0 SET @FormMessage = Concat('You do not have permission to access the brand <strong>',@CurrentBrandFilter,'</strong>. Please log a <a href="https://sofi.newscorp.com/esc?id=sc_cat_item&table=sc_cat_item&sys_id=ae90bf888724a510d82afcc6cebb35d9" target="_blank">SOFI ticket</a> to request access.')
        SET @noMatch = 1 SET @formStatus = 0
    ELSE 
        SET @fn_Displayed = 0 SET @FormMessage = Concat('You do not have permission to access the <strong>Email Editor</strong> app. Please log a <a href="https://sofi.newscorp.com/esc?id=sc_cat_item&table=sc_cat_item&sys_id=ae90bf888724a510d82afcc6cebb35d9" target="_blank">SOFI ticket</a> to request access.')
        SET @noMatch = 1 SET @formStatus = 0
    ENDIF
  ELSEIF RowCount(LookupRows(@de_emailObject_reverse,'EmailName',@NewSearchVariable)) > 0 THEN
    SET @CurrentBrandFilter = Lookup(@de_emailObject_reverse,'Brand','EmailName',@NewSearchVariable)
    IF Lookup(@appC_brand_access_de_reverse,'Access',"EmailAddress",@emailAddress,"Brand",@CurrentBrandFilter) == true 
    AND Lookup(@AppCPermissionTable_reverse,"Access","EmailAddress",@emailAddress,"ParentApp",'Emails',"Type",'View') == true THEN
        SET @fn_value = @NewSearchVariable
        SET @app = IIF(@fn_target_field == 'Email Send History','Email Send History','Email Editor')
        SET @fn_Object = @app
        SET @sourceTable = Lookup('ent.appC_applications',IIF(@AppStateEnvironment == 'UAT','sourceTable_UAT','sourceTable'),'Name',@app)
        SET @sourceTable_reverse = Lookup('ent.appC_applications',IIF(@AppStateEnvironment == 'UAT','sourceTable','sourceTable_UAT'),'Name',@app)
        SET @sourceIdValue = @NewSearchVariable
        SET @CurrentBrandFilter = Lookup(@de_emailObject_reverse,'Brand','EmailName',@NewSearchVariable)
        SET @fn_brand_state = @CurrentBrandFilter
        SET @fn_Environment = @OppositEnv
        SET @showInactive = IIF(Lookup(@de_emailObject_reverse,'Active','EmailName',@NewSearchVariable) == true,'0','1')
        SET @previewMode = 1
    ELSEIF Lookup(@appC_brand_access_de_reverse,'Access',"EmailAddress",@emailAddress,"Brand",@CurrentBrandFilter) != true THEN
        SET @fn_Displayed = 0 SET @FormMessage = Concat('You do not have permission to access the brand <strong>',@CurrentBrandFilter,'</strong> in the <strong>',@OppositEnv,'</strong> environment. Please log a <a href="https://sofi.newscorp.com/esc?id=sc_cat_item&table=sc_cat_item&sys_id=ae90bf888724a510d82afcc6cebb35d9" target="_blank">SOFI ticket</a> to request access.')
        SET @noMatch = 1 SET @formStatus = 0
    ELSE 
        SET @fn_Displayed = 0 SET @FormMessage = Concat('You do not have permission to access the Email Editor app in the ',@OppositEnv,' environment.') Concat('You do not have permission to access the <strong>Email Editor</strong> app in the <strong>',@OppositEnv,'</strong> environment. Please log a <a href="https://sofi.newscorp.com/esc?id=sc_cat_item&table=sc_cat_item&sys_id=ae90bf888724a510d82afcc6cebb35d9" target="_blank">SOFI ticket</a> to request access.')
        SET @noMatch = 1 SET @formStatus = 0
    ENDIF
  ENDIF
  UpdateData('ent.Users',1,'Username',@userName,'preview_section',@fn_SubObjValue)
ENDIF

IF @FormName == 'ToggleSortBy' THEN SET @ToggleSortByInput = Requestparameter('ToggleSortByInput')
  IF @app == 'Home' THEN
    SET @CurrentAppSectionName = 'DateAdded DESC'
  ELSEIF @AppObject != 'Users' AND (@ToggleSortByInput == 'LastLoginDate DESC' OR @ToggleSortByInput == 'LastLoginDate ASC') THEN 
  ELSE
    SET @CurrentAppSectionName = @ToggleSortByInput SET @CurrentAppSection = 1 SET @DisplayedFormMessage = 1
  ENDIF
ENDIF
IF @FormName == 'ToggleStatus' THEN SET @showInactive = @OppositeStatus SET @CurrentAppSection = 1 SET @DisplayedFormMessage = 1 ENDIF
IF @FormName == 'ToggleEnvironment' THEN 
 SET @AppStateEnvironment = IIF(@AppStateEnvironment == 'PROD','UAT','PROD')
 SET @CurrentAppSection = 1 SET @DisplayedFormMessage = 1
 IF NOT EMPTY(@sourceTable) THEN 
    IF RowCount(LookupRows(@sourceTable_reverse,@sourceIdField,@sourceIdValue)) > 0 THEN 
       SET @fn_Value = @sourceIdValue 
       SET @formName = 'SearchVariable'
    ELSEIF NOT EMPTY(@sourceIdValue) THEN
       SET @fn_Value = '' SET @action = '' SET @sourceIdValue = '' SET @sourceIdSubjValue = '' SET @sourceSubObjTableValue = ''
    ENDIF
 ELSE 
  SET @fn_Value = '' SET @action = '' SET @sourceIdValue = '' SET @sourceIdSubjValue = '' SET @sourceSubObjTableValue = ''
 ENDIF
 UpdateData('ent.Users',1,'EmailAddress',@EmailAddress,'Environment',@OppositEnv)
ENDIF

IF @ParentApp == 'System' THEN 
  SET @sourceIdRowCount = RowCount(LookupORderedRows(@sourceTable,0,@CurrentToggleSortBy,'Active',@OppositeStatus))
  IF @sourceIdRowCount > 0 THEN
    SET @sourceIdRows = LookupORderedRows(@sourceTable,0,@CurrentToggleSortBy,'Active',@OppositeStatus)
  ENDIF
ELSEIF @app != 'Users' AND NOT EMPTY(@sourceTable) AND @app != 'Brand Editor' AND @app != 'Home' AND @ParentApp != 'Settings' THEN
  SET @BURowCount = RowCount(LookupORderedRows(@de_abi,0,'Brand ASC','Active',@OppositeStatus,'Brand',@userCurrentBrand))
  SET @BURows = LookupORderedRows(@de_abi,0,'Brand ASC','Active',@OppositeStatus,'Brand',@userCurrentBrand)
  SET @sourceIdRowCount = RowCount(LookupORderedRows(@sourceTable,0,@CurrentToggleSortBy,'Brand',@userCurrentBrand,'Active',@OppositeStatus))
  IF @sourceIdRowCount > 0 THEN
    SET @sourceIdRows = LookupORderedRows(@sourceTable,0,@CurrentToggleSortBy,'Brand',@userCurrentBrand,'Active',@OppositeStatus)
    IF @app == 'Email Send History' THEN 
      SET @sourceIdRows = LookupORderedRows(@sourceTable,0,@CurrentToggleSortBy,'Brand',@userCurrentBrand,'Active',@OppositeStatus,'Sent','1')
      SET @sourceIdRowCount = RowCount(LookupORderedRows(@sourceTable,0,@CurrentToggleSortBy,'Brand',@userCurrentBrand,'Active',@OppositeStatus,'Sent','1')) 
    ENDIF
  ENDIF
ELSEIF @app == 'Home' THEN
  SET @BURowCount = RowCount(LookupORderedRows(@de_abi,0,'Brand ASC','Active',@OppositeStatus))
  SET @BURows = LookupORderedRows(@de_abi,0,'Brand ASC','Active',@OppositeStatus)
  SET @sourceIdRowCount = RowCount(LookupOrderedRows(@stateDE,50,'DateAdded DESC','username',@username,'Environment',@AppStateEnvironment))
  IF @sourceIdRowCount > 0 THEN
    SET @sourceIdRows = LookupOrderedRows(@stateDE,50,'DateAdded DESC','username',@username,'Environment',@AppStateEnvironment)
  ENDIF
ELSEIF NOT EMPTY(@sourceTable) THEN
  SET @BURowCount = RowCount(LookupORderedRows(@de_abi,0,'Brand ASC','Active',@OppositeStatus))
  SET @BURows = LookupORderedRows(@de_abi,0,'Brand ASC','Active',@OppositeStatus)
  SET @sourceIdRowCount = RowCount(LookupORderedRows(@sourceTable,0,@CurrentToggleSortBy,'Active',@OppositeStatus))
  IF @sourceIdRowCount > 0 THEN
    SET @sourceIdRows = LookupORderedRows(@sourceTable,0,@CurrentToggleSortBy,'Active',@OppositeStatus)
  ENDIF
ENDIF

IF @app == 'Home' OR EMPTY(@sourceTable) THEN
  IF RowCount(LookupOrderedRows(@StateDE,0,'DateAdded DESC','Username',@Username,'SessionID',@cookie,'Object',@AppObject,'FormName','ErrorForm')) > 0 THEN
    SET @AppStateID = Field(Row(LookupOrderedRows(@StateDE,0,'DateAdded DESC','Username',@Username,'SessionID',@cookie,'Object',@AppObject,'FormName','ErrorForm'),1),'EventID')
    SET @DisplayMessage = IIF(Lookup(@StateDE,'Displayed','EventID',@AppStateID) == false,1,0)
    IF @DisplayMessage == 1 THEN 
      SET @AppCMessage = Lookup(@StateDE,'Message','EventID',@AppStateID)
      SET @EventIdMessage = @AppStateID
      SET @StatusOfMessage = IIF(Lookup(@StateDE,'Status','EventID',@AppStateID) == true, 'success','danger')
    ENDIF
  ENDIF     
ENDIF

IF IndexOf(@formName,Concat('Id:NavigateToButton//Value:',@fn_Value)) == 1 THEN
  IF NOT EMPTY(@fn_Brand_state) AND @src_Brand_state != @userCurrentBrand AND @fn_Brand_state != 'All brands' THEN
    UpdateData('ent.Users',1,'username',@username,'currentBrand',@fn_Brand_state)
  ENDIF
  IF NOT EMPTY(@fn_Object) AND @app != @fn_Object THEN
    UpdateData('ent.Users',1,'username',@username,'app',@fn_Object)
  ENDIF
  IF NOT EMPTY(@fn_Environment) AND @AppStateEnvironment != @fn_Environment THEN
    UpdateData('ent.Users',1,'username',@username,'Environment',@fn_Environment)
  ENDIF
  IF @fn_Object == 'Email Editor' AND @fn_SubObject == 'Content block settings' AND RowCount(LookupRows(@de_eca,'EventID',@fn_SubObjValue)) > 0 THEN
    UpdateData('ent.Users',1,'Username',@userName,'preview_section',@fn_SubObjValue)
  ENDIF 
  IF @fn_Object == 'Email Editor' AND @fn_SubObject == 'Content block settings' AND RowCount(LookupRows(@de_eca,'EventID',@fn_SubObjValue)) > 0 THEN
    UpdateData('ent.Users',1,'Username',@userName,'preview_section',@fn_SubObjValue)
  ELSEIF @fn_Object == 'Email Editor' AND @fn_SubObject == 'Email header settings' THEN
    UpdateData('ent.Users',1,'Username',@userName,'preview_section','header')
  ELSEIF @fn_Object == 'Email Editor' AND @fn_SubObject == 'Email footer settings' THEN
    UpdateData('ent.Users',1,'Username',@userName,'preview_section','footer')
  ELSEIF @fn_Object == 'Email Editor' AND @fn_SubObject == 'Email settings and layout' THEN
    UpdateData('ent.Users',1,'Username',@userName,'preview_section','template')
  ELSEIF @fn_Object == 'Email Editor' THEN 
    UpdateData('ent.Users',1,'Username',@userName,'preview_section','')
  ENDIF 
ENDIF

SET @eTemplateTypes_RC = RowCount(LookupOrderedRows(@de_et_obj,0,'Name ASC','Active','1'))
IF @eTemplateTypes_RC > 0 THEN SET @eTemplateTypeRows = LookupOrderedRows(@de_et_obj,0,'Name ASC','Active','1') ENDIF

SET @de_eT_h_RC = RowCount(LookupORderedRows(@emailTemplates_HF,0,'Name ASC','Active',1,'Type','emailHeader'))
IF @de_eT_h_RC > 0 THEN SET @de_eT_h_Rows = LookupORderedRows(@emailTemplates_HF,0,'Name ASC','Active',1,'Type','emailHeader') ENDIF
SET @de_eT_f_RC = RowCount(LookupORderedRows(@emailTemplates_HF,0,'Name ASC','Active',1,'Type','emailFooter'))
IF @de_eT_f_RC > 0 THEN SET @de_eT_f_Rows = LookupORderedRows(@emailTemplates_HF,0,'Name ASC','Active',1,'Type','emailFooter') ENDIF

SET @nslObjectFields = "NewsletterID,NewsletterName,Description,Active,PublicationListName,ListID,NameSendDE,ExtKeySendDE,NameUIS,ExtKeyUIS,NameJB,EventDefKeyJB,Masthead,BrandName,AbbrBrandName,BrandEmailAddress,BrandLogo,BrandFont,BrandButton,BrandColor,CardLogo,Schedule,Order,LocalType,IsPartner,Category,Preview,PostCodes,Card,BrandHeaderCBKey,BrandFooterCBKey,MemberID,BusinessUnitName,AccessLevel,field,CreatedDate,UpdatedDate,EmailTemplateCBKey,NewsletterGroup,CreatedBy,UpdatedBy,SenderName,SiteLocation,Hidden,AbbrNewsletterName,Brand,WidgetCopyText,Premium,Exclude_90D_Inactive,suppress_confirmation_email,home_page_text,home_page_location,article_page_location,article_page_text"
SET @gpcDeFields = "Brand,NewsletterName,Permission,Description,Schedule,Order,Category,IsPartner,PostCodes,Preview,Card,BrandName,BrandLogo,CardLogo,BrandFont,BrandColor,Active,BrandButton,LocalType,CreatedBy,CreatedDate,UpdatedBy,UpdatedDate,DateAdded"
SET @ABIDeFields = "Brand,MemberID,Active,BusinessUnit,Abbreviated,AccessLevel,cbCategoryId,BrandName,siteURL,FromAddress,termsURL,LogoSource,CreatedDate,UpdatedDate,field,LocalType,BrandLogo,BrandButton,Type,Masthead,CreatedBy,UpdatedBy,BrandFont,CardLogo,DEKey,UISCategoryId,email_header,email_footer,de_folder_categoryId,crm_name,email_template,friendly_name,allow_mkt_in_email"
SET @de_eca_fields = "EventID,EmailName,ContentBlock,default_template_settings,PositionInEmail,Visible,Active,field,CreatedBy,CreatedDate,UpdatedBy,UpdatedDate,use_more_cts,friendly_name,marketing"
SET @pushObject = "Brand,MemberID,Active,AccessLevel,CreatedDate,UpdatedDate,CreatedBy,UpdatedBy,field,APID,AppName"
SET @AppC_Notifications_Object = "EventID,SessionID,Message,DateAdded,Value,Object,SubObject,SubObjValue,Environment,Username,brand_state,Action,show_help_tool"
SET @UsersObject = "EmailAddress,BU,CreatedDate,LastLoginDate,FirstName,LastName,Brand,app,UserRole,Active,AccessLevel,UpdatedDate,Username,Environment,currentBrand,appc_uat_access,appc_sit_access"
SET @de_et_obj_fields = "Name,Description,Active,field,CreatedBy,CreatedDate,UpdatedBy,UpdatedDate,Brand,brand_exclusive"

SET @header_image = Lookup(@de_dec,'Value','Brand',@userCurrentBrand,'Component','header','Name','image')
]%%
<script runat="server" language="javascript">
var appStateID = Variable.GetValue("@appStateID");
var eventAction = Variable.GetValue("@eventAction");
var currentAppSection = Variable.GetValue("@currentAppSection");
var currentAppSectionName = Variable.GetValue("@currentAppSectionName");
var de_emailObject = Variable.GetValue("@de_emailObject");
var sourceSubObjTableValue = Variable.GetValue("@sourceSubObjTableValue");
var sourceIdSubjValue = Variable.GetValue("@sourceIdSubjValue");
var eventStatus = Variable.GetValue("@eventStatus");
var sourceIdValue = Variable.GetValue("@sourceIdValue");
var sourceIdField = Variable.GetValue("@sourceIdField");
var showInactive = Variable.GetValue("@showInactive");
var oppositeStatus = Variable.GetValue("@oppositeStatus");
var currentBrandFilter = Variable.GetValue("@currentBrandFilter");
var currentFormName = Variable.GetValue("@currentFormName");
var currentAppSection = Variable.GetValue("@currentAppSection");
var sourceTable = Variable.GetValue("@sourceTable");
var PandLMappingDE = Variable.GetValue("@PandLMappingDE");
var sourceTable_reverse = Variable.GetValue("@sourceTable_reverse");
var appStateEnvironment = Variable.GetValue("@appStateEnvironment");
var appC_environment = Variable.GetValue("@environmentAppCentre");
var appCPermissionTable = Variable.GetValue("@appCPermissionTable");
var sourceSubObjTable = Variable.GetValue("@sourceSubObjTable");
var oppositEnv = Variable.GetValue("@oppositEnv");
var sourceSubObjTableUAT_reverse = Variable.GetValue("@sourceSubObjTableUAT_reverse");
var appCPermissionTable_reverse = Variable.GetValue("@appCPermissionTable_reverse");
var AppView = Variable.GetValue("@AppView");
var AppAll = Variable.GetValue("@AppAll");
var AppCreate = Variable.GetValue("@AppCreate");
var AppEdit = Variable.GetValue("@AppEdit");
var AppDelete = Variable.GetValue("@AppDelete");
var AppAll_reverse = Variable.GetValue("@AppAll_reverse");
var AppView_reverse = Variable.GetValue("@AppView_reverse");
var AppCreate_reverse = Variable.GetValue("@AppCreate_reverse");
var AppEdit_reverse = Variable.GetValue("@AppEdit_reverse");
var AppDelete_reverse = Variable.GetValue("@AppDelete_reverse");
var AppExecute_reverse = Variable.GetValue("@AppExecute_reverse");
var BURowCount = Variable.GetValue("@BURowCount");
var BURows = Variable.GetValue("@BURows");
var sourceIdRowCount = Variable.GetValue("@sourceIdRowCount");
var sourceIdRows = Variable.GetValue("@sourceIdRows");
var currentRowCountOnPage = Variable.GetValue("@CurrentRowCountOnPage");
var appAccess = Variable.GetValue("@appAccess");
var mid = Variable.GetValue("@mid");
var userBrand = Variable.GetValue("@userBrand");
var userName = Variable.GetValue("@userName");
var userEmailAddress = Variable.GetValue("@emailAddress");
var currentBrandFilter = Variable.GetValue("@CurrentBrandFilter");
var currentToggleSortBy = Variable.GetValue("@CurrentToggleSortBy");
var currentProgress = Variable.GetValue("@CurrentProgress");
var de_appC_send_log = Variable.GetValue("@de_appC_send_log");
var de_p_obj = Variable.GetValue("@de_p_obj");
var userCurrentBrand = Variable.GetValue("@userCurrentBrand");
var de_cssg = Variable.GetValue("@de_cssg");
var de_ecc = Variable.GetValue("@de_ecc");
var de_bcc = Variable.GetValue("@de_bcc");
var de_eca = Variable.GetValue("@de_eca");
var de_email_css = Variable.GetValue("@de_email_css");
var de_brand_css = Variable.GetValue("@de_brand_css");
var custom_emailComponents = Variable.GetValue("@custom_emailComponents");
var de_msg_groups = Variable.GetValue("@de_msg_groups");
var de_abi = Variable.GetValue("@de_abi");
var de_ani = Variable.GetValue("@NSLSourceTable");
var emailTemplates_HF = Variable.GetValue("@emailTemplates_HF");
var aestTime = new Date().toLocaleString("en-US", {timeZone: "Australia/Sydney"});
aestTime = new Date(aestTime);
var localTime = aestTime.toLocaleString();
var createdBy = Variable.GetValue("@userName");
var createdDate = localTime;
var updatedBy = Variable.GetValue("@userName");
var updatedDate = localTime;
var standardFields = ["CreatedBy","CreatedDate","UpdatedBy","UpdatedDate"];
var standardValues = [createdBy,createdDate,updatedBy,updatedDate];
var role = Variable.GetValue("@role");

/* END APP CENTRE ENVIRONMENT SETUP */
</script>
<!DOCTYPE html>
<html lang="en">
   <head>
      <title>App Centre </title>
      <meta charset="utf-8">
      <meta name="ROBOTS" content="NOINDEX, NOFOLLOW">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="mobile-web-app-capable" content="yes">
      <meta name="apple-mobile-web-app-capable" content="yes">
      <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1">
      <meta content="width=device-width, initial-scale=1" name="viewport" />
      <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/github.min.css" />-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/highlight.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/xml.min.js"></script>
      %%[ IF @environmentAppCentre == 'UAT' THEN ]%%
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
      %%[ ENDIF ]%%
      <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
      %%[ IF @app == 'Email Editor' AND NOT EMPTY(@sourceIdValue) THEN ]%%
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.7/quill.snow.min.css" integrity="sha512-/FHUK/LsH78K9XTqsR9hbzr21J8B8RwHR/r8Jv9fzry6NVAOVIGFKQCNINsbhK7a1xubVu2r5QZcz2T9cKpubw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.7/quill.bubble.min.css" integrity="sha512-laOBZ+/WvReCfvAK076yy3Hm3J+X1iI0wIYGMzsmm4HJbYvQdAGZZ1kszc1hVYUIZQ/faZ+eEtJVL28sxPSJag==" crossorigin="anonymous" referrerpolicy="no-referrer" />
      %%[ ENDIF ]%%
      %%[ IF @app == 'Brand Editor' OR @app == 'Email Editor' THEN ]%%
      <link href="https://cdn.jsdelivr.net/npm/quill-emoji@0.1.8/dist/quill-emoji.min.css" rel="stylesheet">
      %%[ ENDIF ]%%
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
      <!--<link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">-->
      <!--<script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>-->
      %%[ IF (@app == 'Newsletter preference history' OR @app == 'MobilePush tag history' OR @app == 'Email send history') AND NOT EMPTY(@sourceIdValue) THEN ]%%
        <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0/dist/Chart.min.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@2.8.0/dist/Chart.min.css">
      %%[ ENDIF ]%%
      <!-- jQuery -->
      %%[ IF @app == 'Brand Editor' OR @app == 'Email Editor' THEN ]%%
      <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-colorpicker/3.2.0/js/bootstrap-colorpicker.min.js"></script>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-colorpicker/3.2.0/css/bootstrap-colorpicker.min.css">
      %%[ ENDIF ]%%
      %%[ IF @app == 'Brand Editor' OR @app == 'Email Editor' THEN ]%%
        <script src="https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.7/quill.min.js" integrity="sha512-P2W2rr8ikUPfa31PLBo5bcBQrsa+TNj8jiKadtaIrHQGMo6hQM6RdPjQYxlNguwHz8AwSQ28VkBK6kHBLgd/8g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="https://cdn.jsdelivr.net/npm/quill-emoji@0.2.0/dist/quill-emoji.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-simulate/1.1.1/jquery.simulate.min.js" integrity="sha512-99l4kQHM730187dXruSGULp7g34xamOKXWXHrzz1HuKuKrLg/VBpRTbbI8in5g8lUnzJkchunWlHlHznEbQzAw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
      %%[ ENDIF ]%%
        <script type="text/javascript">
          function refreshIframebyId(iframe_id) {
            $("#" + iframe_id).attr('src', ($('#' + iframe_id).attr('src')));
          }
          %%[ IF @app == 'Brand Editor' OR @app == 'Email Editor' THEN ]%%
           async function load_list_of_content_blocks(action_area,src_secret,type,id,spinningWheel) {
            if (spinningWheel == '1') { 
              let spinning_modal = '<div style="text-align:center;"> Loading</div><div style="text-align:center;"><br><div class="modall-dialog modal-sm" style="text-align:center;max-width:100%;"><div class="modall-content"><span class="fa fa-circle-o-notch fa-spin fa-fw fa-2x" aria-hidden="true"></span></div></div></div></div>';
              document.getElementById("list_of_content_blocks_" + action_area).innerHTML = spinning_modal;
            };
            %%[ IF @environmentAppCentre == 'UAT' THEN ]%%
            console.log('src_secret: ' + src_secret + ' | action_area: ' + action_area + ' | type: ' + type + ' | id: ' + id);
            %%[ ENDIF ]%%
            var file = "%%=Concat('https://cloud.e.newsdigitalmedia.com.au/list_of_content_blocks_ui?e=" + src_secret + "&key=',@cookie)=%%&user_env=%%=v(@AppStateEnvironment)=%%&sys_env=%%=v(@environmentAppCentre)=%%&action_area=" + action_area+'&appStateId=%%=v(@appStateId)=%%';
            let myObject = await fetch(file);
            let myText = await myObject.text();
            document.getElementById("list_of_content_blocks_" + action_area).innerHTML = myText;
            %%[ IF @environmentAppCentre == "UAT" OR @environmentAppCentre == 'SIT' THEN ]%%
            console.log('list_of_cbs file: ' + file);
            console.log('list of cbs loaded.');
            %%[ ENDIF ]%%
              if(action_area == 'edit') {
                $('#hidden_edit_cb_'+action_area+id).simulate("click");
              };
            $('.modall').modal('hide');
          }
        %%[ ENDIF ]%%
        %%[ /* https://newsau.atlassian.net/wiki/spaces/natit/pages/79102836840/appC+ui+component */ ]%%
        async function appC_ui_component(component,target,tab,moreParams,showModal,spinningWheel,refreshIframe,idOneOff,disableButton,enableButton,load_home_page_logic_function) {
          if (refreshIframe == '1') {
            %%[ IF @preview_mode != 'focused' THEN ]%%
              $("#emailPreviewIframe").css("display","none");
            %%[ ENDIF ]%%
          };
          if (disableButton) { let button = '#'+disableButton; $(button).prop('disabled',true); $(button).css('background-color','grey'); $(button).html('Loading'); }
          if (spinningWheel == '1') {
            let spinning_modal = '<div style="padding: 1rem 1.5rem 1rem 1.5rem;"><div style="text-align:center;"> Loading</div><div style="text-align:center;"><br><div class="modall-dialog modal-sm" style="text-align:center;max-width:100%;"><div class="modall-content"><span class="fa fa-circle-o-notch fa-spin fa-fw fa-2x" aria-hidden="true"></span></div></div></div></div>';
            document.getElementById(target).innerHTML = spinning_modal;
            %%[ IF @environmentAppCentre == 'UAT' THEN ]%%
            console.log("spinned the wheel - appC_ui_component()");
            %%[ ENDIF ]%%
          };
          if (showModal != '0') { $('.modall').modal('show'); };
          var file = "%%=Concat('https://cloud.e.newsdigitalmedia.com.au/appC_components_',LowerCase(@appStateEnvironment),'?key=',@cookie,'&appStateId=',@appStateId,'&sys_env=',@environmentAppCentre,'&component=')=%%"+component+'&'+moreParams;
          %%[ IF @environmentAppCentre == 'UAT' THEN ]%%
          console.log("%%=Concat('https://cloud.e.newsdigitalmedia.com.au/appC_components_',LowerCase(@appStateEnvironment),'?key=',@cookie,'&appStateId=',@appStateId,'&sys_env=',@environmentAppCentre,'&component=')=%%"+component+'&'+moreParams);
          %%[ ENDIF ]%%
          let myObject = await fetch(file);
          let myText = await myObject.text();
          document.getElementById(target).innerHTML = myText;
          if (idOneOff) { $("#" + idOneOff).removeAttr('onclick'); };
          if (showModal != '0') { $('.modall').modal('hide'); };
          if (load_home_page_logic_function) { load_home_page_logic(); };
          %%[ IF @preview_mode == 'focused' THEN ]%%
            if (refreshIframe == '1') {
              $("#emailPreviewIframe").css("display","none");
              if (tab == 'template') { 
                load_subject_and_preheader(); 
              };
              if (tab && component != 'email_settings_and_layout') { change_block_view(tab); };
            };
          %%[ ELSE ]%%
            if (refreshIframe == '1') {
              refreshIframebyId('emailPreviewIframe');
            };
          %%[ ENDIF ]%%
          %%[ IF @environmentAppCentre == 'UAT' THEN ]%%
          console.log('The component "' + component + '" was placed in id "' + target + '"');
          console.log('appC_ui_component('+component+','+target+','+tab+','+moreParams+','+showModal+','+spinningWheel+','+refreshIframe+','+idOneOff+','+disableButton+','+enableButton+')');
          %%[ ENDIF ]%%
          if (enableButton) { let button = '#'+enableButton; $(button).prop('disabled',false); $(button).css('background-color','#497edd'); $(button).html('Save'); }
           if (component == 'free_text_block') {
              load_free_text_logic(tab);
              %%[ IF @environmentAppCentre == 'UAT' THEN ]%%
              console.log('loaded free text block js logic.');
              %%[ ENDIF ]%%
            } else if (component == 'quote_block') {
              load_quote_text_logic(tab);
              %%[ IF @environmentAppCentre == 'UAT' THEN ]%%
              console.log('loaded quote block js logic.');
              %%[ ENDIF ]%%
            }
          if (refreshIframe != '1') {
            %%[ IF @preview_mode == 'focused' THEN ]%%
              $("#emailPreviewIframe").css("display","block");
            %%[ ENDIF ]%%
          };
        }

        </script>
      <link href="https://image.e.newsdigitalmedia.com.au/lib/fe9515747362007f76/m/1/newscorp-favicon.png" rel="SHORTCUT ICON" type="image/png" />
      <style>
      %%[ IF @environmentAppCentre == 'UAT' THEN ]%%
        %%=TreatAsContent(HTTPGET('https://dl.dropboxusercontent.com/s/a4kpaksdkmudak5/css_new_appC_nav.css'))=%%
      %%[ ELSE ]%%
        .list_view_accordion {max-width:100%;position: absolute;left: 15px;right: 15px;bottom:20px;top: 90px;margin-bottom: 70px;}.list_view_table_row_container {height: 100%;overflow-y: scroll;border-radius: 0px 0px 4px 4px;background-color: white;margin-bottom: 20px!important;}@media screen and (max-width:550px) {#content {top:183px!important;}#header {height: 182px!important;}}.checkbox label .toggle,.checkbox-inline .toggle{margin-left:-20px;margin-right:5px}.toggle{position:relative;overflow:hidden}.toggle input[type=checkbox]{display:none}.toggle-group{position:absolute;width:200%;top:0;bottom:0;left:0;transition:left .35s;-webkit-transition:left .35s;-moz-user-select:none;-webkit-user-select:none}.toggle.off .toggle-group{left:-100%}.toggle-on{position:absolute;top:0;bottom:0;left:0;right:50%;margin:0;border:0;border-radius:0}.toggle-off{position:absolute;top:0;bottom:0;left:50%;right:0;margin:0;border:0;border-radius:0}.toggle-handle{position:relative;margin:0 auto;padding-top:0;padding-bottom:0;height:100%;width:0;border-width:0 1px}.toggle.btn{min-width:59px;min-height:34px}.toggle-on.btn{padding-right:24px}.toggle-off.btn{padding-left:24px}.toggle.btn-lg{min-width:79px;min-height:45px}.toggle-on.btn-lg{padding-right:31px}.toggle-off.btn-lg{padding-left:31px}.toggle-handle.btn-lg{width:40px}.toggle.btn-sm{min-width:50px;min-height:30px}.toggle-on.btn-sm{padding-right:20px}.toggle-off.btn-sm{padding-left:20px}.toggle.btn-xs{min-width:35px;min-height:22px}.toggle-on.btn-xs{padding-right:12px}.toggle-off.btn-xs{padding-left:12px}.hljs{display:block;overflow-x:auto;padding:.5em;color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}input[type=date] {margin-top: 10px;}.ql-editor {padding-right: 26px }.cross {font-size: 16px;color: red;font-weight: bold;margin-left: 5px;}.emoji_completions {background: #fff;border: 1px solid rgba(0,0,0,.15);border-radius: 3px;box-shadow: 0 5px 10px rgba(0,0,0,.12);list-style: none;margin: 0;padding: 6px }.centre_box {text-align: center!important;}.help_tool .detailTableOuterLayer {width: 24%;padding: 0 10px 0 10px;position: absolute;left: 0.5%!important;right: auto!important;top: 118px;}.ql-container , .ql-editor {height: auto;}*[quill__html]{display: none;width: 100%;margin: 0;background: rgb(29, 29, 29);box-sizing: border-box;color: rgb(204, 204, 204);outline: none;padding: 12px 15px;line-height: 24px;font-family: Consolas, Menlo, Monaco, "Courier New", monospace;position: absolute;top: 0;bottom: 0;border: none;}*[quill__html *= '-active-']{display: initial;height: 100%!important;}*[quill__html]:hover {background-color: black!important;}.isDisabled {color: currentColor;cursor: not-allowed;opacity: 0.5;text-decoration: none;}.input-group {position: relative;display: -ms-flexbox;display: flex;-ms-flex-wrap: wrap;flex-wrap: wrap;-ms-flex-align: stretch;align-items: stretch;width: 100% }.ql-editor {max-height: 500px!important;}.ql-editor p, ul, ol {padding-bottom: 15px!important;}.input-group>.custom-file,.input-group>.custom-select,.input-group>.form-control,.input-group>.form-control-plaintext {position: relative;-ms-flex: 1 1 0%;flex: 1 1 0%;min-width: 0;margin-bottom: 0 }.input-group>.custom-select:not(:last-child),.input-group>.form-control:not(:last-child) {border-top-right-radius: 0;border-bottom-right-radius: 0 }.input-group-append {margin-left: -1px }.input-group-text {display: -ms-flexbox;display: flex;-ms-flex-align: center;align-items: center;padding: 7.564px;margin-bottom: 0;font-size: 1rem;line-height: 1.5;color: #495057;text-align: center;white-space: nowrap;background-color: #e9ecef;border: 1px solid #ced4da;border-radius: .25rem;height: 28px;}.input-group>.input-group-append:last-child>.btn:not(:last-child):not(.dropdown-toggle),.input-group>.input-group-append:last-child>.input-group-text:not(:last-child),.input-group>.input-group-append:not(:last-child)>.btn,.input-group>.input-group-append:not(:last-child)>.input-group-text,.input-group>.input-group-prepend>.btn,.input-group>.input-group-prepend>.input-group-text {border-top-right-radius: 0;border-bottom-right-radius: 0 }.input-group>.input-group-append>.btn,.input-group>.input-group-append>.input-group-text,.input-group>.input-group-prepend:first-child>.btn:not(:first-child),.input-group>.input-group-prepend:first-child>.input-group-text:not(:first-child),.input-group>.input-group-prepend:not(:first-child)>.btn,.input-group>.input-group-prepend:not(:first-child)>.input-group-text {border-top-left-radius: 0;border-bottom-left-radius: 0 }.fa-fw {text-align: center;width: auto!important;}.progress {display: -ms-flexbox;display: flex;height: 1rem;overflow: hidden;font-size: .75rem;background-color: #e9ecef;border-radius: .25rem }.progress-bar {display: -ms-flexbox;display: flex;-ms-flex-direction: column;flex-direction: column;-ms-flex-pack: center;justify-content: center;overflow: hidden;color: #fff;text-align: center;white-space: nowrap;background-color: #007bff;transition: width .6s ease;}.btn-group,.btn-group-vertical {position: relative;display: -ms-inline-flexbox;display: inline-flex;vertical-align: middle }.btn-group-vertical>.btn,.btn-group>.btn {position: relative;-ms-flex: 1 1 auto;flex: 1 1 auto }.btn-group-vertical>.btn:hover,.btn-group>.btn:hover {z-index: 1 }.btn-group-vertical>.btn.active,.btn-group-vertical>.btn:active,.btn-group-vertical>.btn:focus,.btn-group>.btn.active,.btn-group>.btn:active,.btn-group>.btn:focus {z-index: 1 }.pagination {display: -ms-flexbox;display: flex;padding-left: 0;list-style: none;border-radius: .25rem }.page-link {position: relative;display: block;padding: .25rem .5rem;margin-left: -1px;line-height: 1.25;color: #007bff;background-color: #fff;border: 1px solid #dee2e6 }.page-link:hover {z-index: 2;color: #0056b3;text-decoration: none;background-color: #e9ecef;border-color: #dee2e6 }.page-link:focus {z-index: 3;outline: 0;box-shadow: 0 0 0 .2rem rgba(0,123,255,.25) }.page-item:first-child .page-link {margin-left: 0;border-top-left-radius: .25rem;border-bottom-left-radius: .25rem }.page-item:last-child .page-link {border-top-right-radius: .25rem;border-bottom-right-radius: .25rem }.page-item.active .page-link {z-index: 0;color: #fff;background-color: #007bff;border-color: #007bff }.page-item.disabled .page-link {color: #6c757d;pointer-events: none;cursor: auto;background-color: #fff;border-color: #dee2e6 }.pagination-lg .page-link {padding: .75rem 1.5rem;font-size: 1.25rem;line-height: 1.5 }.pagination-lg .page-item:first-child .page-link {border-top-left-radius: .3rem;border-bottom-left-radius: .3rem }.pagination-lg .page-item:last-child .page-link {border-top-right-radius: .3rem;border-bottom-right-radius: .3rem }.pagination-sm .page-link {padding: .25rem .5rem;font-size: .875rem;line-height: 1.5 }.pagination-sm .page-item:first-child .page-link {border-top-left-radius: .2rem;border-bottom-left-radius: .2rem }.pagination-sm .page-item:last-child .page-link {border-top-right-radius: .2rem;border-bottom-right-radius: .2rem }.justify-content-center {-ms-flex-pack: center!important;justify-content: center!important }.fadeInDown {-webkit-animation-name: fadeInDown;animation-name: fadeInDown;-webkit-animation-duration: .8s;animation-duration: .8s;-webkit-animation-fill-mode: both;animation-fill-mode: both }@-webkit-keyframes fadeInDown {0% {opacity: 0;-webkit-transform: translate3d(0, -100%, 0);transform: translate3d(0, -100%, 0) }100% {opacity: 1;-webkit-transform: none;transform: none }}@-webkit-keyframes fadeIn {from {opacity: 0 }to {opacity: 1 }}@-moz-keyframes fadeIn {from {opacity: 0 }to {opacity: 1 }}@keyframes fadeIn {from {opacity: 0 }to {opacity: 1 }}.colorpickerBox {width: 22px;height: 27px;padding: 0!important;border: none;margin: 5px 0px;}.fadeIn {opacity: 0;-webkit-animation: fadeIn ease-in 1;-moz-animation: fadeIn ease-in 1;animation: fadeIn ease-in 1;-webkit-animation-fill-mode: forwards;-moz-animation-fill-mode: forwards;animation-fill-mode: forwards;-webkit-animation-duration: .2s;-moz-animation-duration: .2s;animation-duration: .2s;font-family: Salesforce Sans }.fadeIn.first {-webkit-animation-delay: .8s;-moz-animation-delay: .8s;animation-delay: .8s }.fadeIn.second {-webkit-animation-delay: .8s;-moz-animation-delay: .8s;animation-delay: .8s }.fadeIn.third {-webkit-animation-delay: .8s;-moz-animation-delay: .8s;animation-delay: .8s }.fadeIn.fourth {width: 200px;-webkit-animation-delay: 1s;-moz-animation-delay: 1s;animation-delay: 1s }.underlineHover:after {display: block;left: 0;bottom: -10px;width: 0;height: 2px;background-color: #56baed;content: "";transition: width .2s }.underlineHover:hover {color: #fff }.underlineHover:hover:after {width: 100% }.modal_content_800 {position: absolute;display: -ms-flexbox;-ms-flex-direction: column;pointer-events: auto;background-clip: padding-box;outline: 0;min-width: 800px;max-width: 1000px;top: 50%;left: 50%;transform: translate(-50%, -50%);overflow: hidden;border-radius: 6px;border:none;}.modal-content {position: absolute;display: -ms-flexbox;-ms-flex-direction: column;pointer-events: auto;background-clip: padding-box;outline: 0;min-width: 800px;max-width: 1000px;top: 50%;left: 50%;transform: translate(-50%, -50%);overflow: hidden;border-radius: 6px;border:none;}.modal_content_600 {position: absolute;display: -ms-flexbox;-ms-flex-direction: column;pointer-events: auto;background-clip: padding-box;outline: 0;min-width: 600px;max-width: 1000px;top: 50%;left: 50%;transform: translate(-50%, -50%);overflow: hidden;border-radius: 6px;border:none;}.modal_content_400 {position: absolute;display: -ms-flexbox;-ms-flex-direction: column;pointer-events: auto;background-clip: padding-box;outline: 0;min-width: 400px;max-width: 1000px;top: 50%;left: 50%;transform: translate(-50%, -50%);overflow: hidden;border-radius: 6px;border:none;}.modal-backdrop {position: fixed;top: 0;left: 0;z-index: 2040;width: 100vw;height: 100vh;background-color: #000 }.modal-backdrop.fade {opacity: 0 }.modal-backdrop.show {opacity: .5 }.modal-header {display: -ms-flexbox;display: flex;-ms-flex-align: start;align-items: flex-start;-ms-flex-pack: justify;justify-content: space-between;padding: 5px 15px 5px 15px!important;border-bottom: 1.5px solid #dee2e6;border-top-left-radius: calc(.3rem - 1px);border-top-right-radius: calc(.3rem - 1px);background-color: #ffffff!important;border-radius: 4px 4px 0 0!important;color: #000000!important;}.modal-header .close {width: 40px!important;}.modal-title {margin-bottom: 0;line-height: 2.0;font-size: 16px;}.modal-header .modal-title {font-size: 22px;font-weight: normal!important;}.modal-body {position: relative;-ms-flex: 1 1 auto;flex: 1 1 auto;padding: 1rem;background-color: white;}.modal-footer {display: -ms-flexbox;display: flex;-ms-flex-wrap: wrap;flex-wrap: wrap;-ms-flex-align: center;align-items: center;-ms-flex-pack: end;justify-content: flex-end;padding: .75rem;border-top: 1px solid #dee2e6;border-bottom-right-radius: calc(.3rem - 1px);border-bottom-left-radius: calc(.3rem - 1px);background-color: white;}.modal-footer>* {margin: .25rem }.modal-scrollbar-measure {position: absolute;top: -9999px;width: 50px;height: 50px;overflow: scroll }.modal-open {overflow: hidden;padding: 0!important;}.modal-open .modal {overflow-x: hidden;overflow-y: auto }.modal-dialog {position: fixed;width: auto;pointer-events: none;max-width: 100%!important;top: 50%;left: 50%;transform: translate(-50%, -50%)!important;}.scroll_700 {max-height: 1000px;overflow-y: auto;overflow-x: hidden;background-color:white;}.modal.show .modal-dialog {-webkit-transform: none;transform: none }.modal-dialog {transition: -webkit-transform .3s ease-out;transition: transform .3s ease-out;transition: transform .3s ease-out, -webkit-transform .3s ease-out;-webkit-transform: translate(0, -50px);transform: translate(0, -50px) }.overFlowYAssetList {max-height: 150px;overflow: auto;}*, ::after, ::before {box-sizing: border-box }article, aside, figcaption, figure, footer, header, hgroup, main, nav, section {display: block }h1, h2, h3, h4, h5, h6 {margin-top: 0;margin-bottom: .5rem }p {margin-top: 0;margin-bottom: 1rem }dl, ol, ul {margin-top: 0;margin-bottom: 1rem }ol ol, ol ul, ul ol, ul ul {margin-bottom: 0 }a {color: #007bff;text-decoration: none;background-color: transparent }a:hover {color: #0056b3;text-decoration: underline }a:not([href]) {color: inherit;text-decoration: none }button {border-radius: 0 }button:focus {outline: 1px dotted;outline: 5px auto -webkit-focus-ring-color }button, input, optgroup, select, textarea {margin: 0;font-family: inherit;font-size: inherit;line-height: inherit }button, input {overflow: visible }button, select {text-transform: none }table {border-collapse: collapse }[type=button], [type=reset], [type=submit], button {-webkit-appearance: button }[type=button]:not(:disabled), [type=reset]:not(:disabled), [type=submit]:not(:disabled), button:not(:disabled) {cursor: pointer }input[type=checkbox], input[type=radio] {box-sizing: border-box;padding: 0 }.h1, .h2, .h3, .h4, .h5, .h6, h1, h2, h3, h4, h5, h6 {margin-bottom: .5rem;line-height: 1.2 }.h2, h2 {font-size: 2rem }.h5, h5 {font-size: 1.25rem }.btn {display: inline-block;color: #212529;text-align: center;vertical-align: middle;cursor: pointer;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;background-color: transparent;border: 1px solid transparent;padding: .375rem .75rem;font-size: 1rem;font-size: 12px!important;line-height: 0.4;border-radius: 5px;}.searchbutton {width: 25px;background-color: grey;padding: 0;height: 25px;}.inputsearchbutton {display: inline;margin-right: 0!important;max-width: 285px!important;padding: 0 4px 0 4px;font-size: 12px!important;top: 65px!important;}.btn:hover {color: #212529;text-decoration: none }.btn.focus, .btn:focus {outline: 0!important;}.btn-primary:focus {outline: 0!important;}.default_template_checkbox {margin-top: -15px;margin-bottom: 10px;}.toggle-group .btn-success {color: #fff!important;background-color: #56ab6a;border-color: #56ab6a;border-radius: 5px;}.toggle-group.btn-success:hover {color: #fff!important;background-color: #34974b;border-color: #34974b;}.toggle-group .btn-primary {color: #fff!important;background-color: #497edd!important;border-radius: 5px;max-width: 800px;border-color: #497edd!important;}.toggle-group .btn-primary:hover {color: #fff!important;background-color: #3f6ec2;border-color: #3f6ec2;}.btn-danger {color: #fff;background-color: #dc3545;border-color: #ab0c1b;border-radius: 4px;}.btn-danger:hover {color: #fff!important;background-color: #c82333;border-color: #bd2130;}.btn-warning {color: #fff!important;background-color: #b3b3b3;border-color: #b3b3b3;}.btn-warning:hover {color: #fff!important;background-color: #9a9a9a!important;border-color: #9a9a9a!important;}.btn-info {color: #fff;background-color: #17a2b8!important;border-color: #00869b!important;border-radius: 4px;}.btn-info:hover {color: #fff;background-color: #167691!important;border-color: #167691!important;border-radius: 4px;}.btn-secondary {color: #fff;background-color: #e66040!important;border-radius: 4px;border-color: #e66040!important;}.btn-secondary:hover {color: #fff;background-color: #c9640f!important;border-color: #c72d09!important;}.btn-danger:not(:disabled):not(.disabled).active, .btn-danger:not(:disabled):not(.disabled):active, .show>.btn-danger.dropdown-toggle {color: #fff;background-color: #bd2130;border-color: #b21f2d }.btn-primary {color: #fff!important;background-color: #497edd;border-radius: 4px;max-width: 800px;border-color: #497edd;}.btn-primary:hover {color: #fff!important;background-color: #3f6ec2;border-color: #3f6ec2;}.btn-success {color: #fff!important;background-color: #4db465;border-color: #4db465;border-radius: 4px;}.btn-success:hover {color: #fff!important;background-color: #34974b;border-color: #4db465;}.dropdown-item {display: block;width: 100%;padding: .25rem 1.5rem;white-space: nowrap;border: 0;height: 35px;font-size: 14px!important;}.bg-secondary {color: #fff;background-color: #e66040!important;}.bg-success {background-color: #28a745!important }.dropdown-item:focus,.dropdown-item:hover, .userTabButton:hover {color: #16181b;text-decoration: none;background-color: #efefef!important }.btn-link {color: #007bff;text-decoration: none }.btn-link:hover {color: #0056b3;text-decoration: underline ;background-color: #b4b3b33d;border-radius: 0;}.btn-link.focus, .btn-link:focus {text-decoration: underline;box-shadow: none;background-color: #b4b3b33d;border-radius: 0;}.fade {transition: opacity .15s linear }.fade:not(.show) {opacity: 0 }.collapse:not(.show) {display: none }.collapsing {position: relative;height: 0;overflow: hidden;transition: height .35s ease }.dropdown, .dropleft, .dropright, .dropup {position: relative }.dropdown-toggle {white-space: nowrap }.dropdown-toggle::after {display: inline-block;margin-left: .255em;vertical-align: .255em;content: "";border-top: .3em solid;border-right: .3em solid transparent;border-bottom: 0;border-left: .3em solid transparent }.dropdown-menu {position: absolute;z-index: 1;display: none;min-width: 10rem;padding: 0!important;margin: .125rem 0 0;background-color: #fff;background-clip: padding-box;border: 1px solid rgba(0, 0, 0, .15);border-radius: 0px;max-height: 650px;overflow: auto;box-shadow: 0 5px 8px 0 rgb(0 0 0 / 10%);top: 40px;}.nav {display: -ms-flexbox;display: flex;-ms-flex-wrap: wrap;flex-wrap: wrap;padding-left: 0;margin-bottom: 0;list-style: none;}.navbar {position: relative;display: -ms-flexbox;display: flex;-ms-flex-wrap: wrap;flex-wrap: wrap;-ms-flex-align: center;align-items: center;-ms-flex-pack: justify;justify-content: space-between;padding: .5rem 1rem }.card {position: relative;display: -ms-flexbox;display: flex;-ms-flex-direction: column;flex-direction: column;min-width: 0;word-wrap: break-word;background-color: #fff;background-clip: border-box;border: 1px solid rgb(39 38 38 / 25%);border-radius: 4px;overflow: hidden;margin-bottom: .8rem;}.card2 {position: relative;display: -ms-flexbox;display: flex;-ms-flex-direction: column;flex-direction: column;min-width: 0;word-wrap: break-word;background-color: #fff;background-clip: border-box;border-radius: 0 0 4px 4px;overflow: hidden;border-top: none;}.assetCard {position: relative;display: -ms-flexbox;display: flex;-ms-flex-direction: column;flex-direction: column;min-width: 0;word-wrap: break-word;background-color: #fff;background-clip: border-box;border-left: none;border-top: none;border-bottom: none;border-right: none;}.card-body {-ms-flex: 1 1 auto;flex: 1 1 auto;min-height: 1px;padding: .8rem!important;}.card_body2 {-ms-flex: 1 1 auto;flex: 1 1 auto;min-height: 1px;padding: 0.5rem 1.5rem 1.5rem 1.5rem;}.card_body3 {-ms-flex: 1 1 auto;flex: 1 1 auto;min-height: 1px;padding: 0.5rem 1.5rem 0.5rem 1.5rem;}.card-header {padding: .75rem 1.25rem;margin-bottom: 0;background-color: rgba(0, 0, 0, .03);border-bottom: none;border-radius: 15px 15px 0 0;}.card-header:first-child {border-radius: calc(.25rem - 1px) calc(.25rem - 1px) 0 0 }.accordion>.card:not(:last-of-type) {border-bottom: 0;border-bottom-right-radius: 0;border-bottom-left-radius: 0 }.accordion>.card:not(:first-of-type) {border-top-left-radius: 0;border-top-right-radius: 0 }.accordion>.card>.card-header {border-radius: 0;}.badge {display: inline-block;padding: .25em .4em;font-size: 85%;line-height: 1;text-align: center;white-space: nowrap;vertical-align: baseline;border-radius: .25rem;transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, box-shadow .15s ease-in-out }.deletebutton {position: absolute!important;right: 10px!important;font-size:20px!important;color:red }.deleteBadge {font-size: 20px!important;color:red;}a.badge:focus, a.badge:hover {text-decoration: none }.btn .badge {padding: 6px;font-size: 12px;margin: 0 2px 0 2px;top:0!important;}.badge-success {color: #fff;background-color: #28a745 }.badge-dark {color: #fff;background-color: #717982 }.badge-warning {color: #fff!important;background-color: #ea8216;border-color: #b78b04!important;}.badge-warning:hover {color: #fff!important;background-color: #e8af04!important;border-color: #e8af04!important;}.badge-primary {color: #fff;background-color: #2f81de }.badge-primary:hover {color: #fff;background-color: #0e6bd0 }.badge-secondary {color: #fff;background-color: #e66040!important }a.badge-secondary:focus,a.badge-secondary:hover {color: #fff;background-color: #c72d09!important }a.badge-success:focus, a.badge-success:hover {color: #fff;background-color: #1e7e34 }.modal {position: fixed;top: 0;left: 0;z-index: 5050;display: none;width: 100%;height: 100%;overflow: hidden;outline: 0 }.modall {position: fixed;top: 0;left: 0;z-index: 5050;display: none;width: 100%;height: 100%;overflow: hidden;outline: 0 }.modal-backdrop {position: fixed;top: 0;left: 0;z-index: 2040;width: 100vw;height: 100vh;background-color: #000 }.modal-backdrop.fade {opacity: 0 }.modal-backdrop.show {opacity: .5 }.sr-only {position: absolute;width: 1px;height: 1px;padding: 0;margin: -1px;overflow: hidden;clip: rect(0, 0, 0, 0);white-space: nowrap;border: 0 }.mb-0, .my-0 {margin-bottom: 0!important;line-height: 0!important;}.dropdown, .dropleft, .dropright, .dropup {position: relative }.dropdown-toggle {white-space: nowrap }.dropdown-toggle::after {display: inline-block;margin-left: .255em;vertical-align: .255em;content: "";border-top: .3em solid;border-right: .3em solid transparent;border-bottom: 0;border-left: .3em solid transparent }.collapse:not(.show) {display: none }div.scroll {margin:4px;padding:4px;width: 500px;height: 110px;overflow-x: hidden;overflow-x: auto;text-align:justify;}.nslCardImage {border-radius: 4px;width: 100%;}.dropdown-menu.show {display: block }.badge-danger {color: #fff!important;background-color: #dc3545;}body {margin: 0;font-family: system-ui;color: #000c48;font-size: 12px;background: #e0e2ea;opacity: 1;outline: 0!important;line-height: 1.5;}.explainer {font-size: 20px;font-family: system-ui;}.appC_login_name {font-size: 30px!important;padding-top: 25px!important;padding-bottom: 20px!important;text-align: center!important;}.explainertwo {color: #000c48;font-size: 14px!important;line-height: 34px;background-color: #f1f1f1;border-radius: 4px;text-align: center;border: 1px solid rgba(0, 0, 0, .125);margin: 15px 0;font-weight: bolder;font-family: system-ui;}.explainertwo_left_c {color: #000c48;font-size: 12px!important;line-height: 2;background-color: #f1f1f1;border-radius: 4px;text-align: left;border: 1px solid rgba(0, 0, 0, .125);font-weight: bolder;font-family: system-ui;padding: 12px;margin-bottom: 12px;}.explainertwo_orange {color: #000c48;font-size: 15px!important;line-height: 34px;text-align: left;margin: 15px 0;font-weight: bolder;border-bottom: 1px solid #e98300;font-family: system-ui;}.explainertwoAndaHalf {color: #000c48;padding-top: 10px;text-align: left;line-height: 30px;font-size: 15px;font-family: system-ui;}.explainerthree {color: #000c48;padding-top: 15px;text-align: left;line-height: 42px;font-size: 18px;font-weight: bolder;font-family: system-ui;}.template_block_preview {padding-top: 80px;padding-bottom:80px;}.other_block_preview {padding-top: 50px;padding-bottom:80px;}.explainerthreeAndHalf {color: #000c48;text-align: left;line-height: 40px;font-size: 14px;font-family: system-ui;}.explainerfour {text-align: left;font-size: 12px!important;line-height: 25px;font-family: system-ui;}.explainerfourAndHalf {font-size: 14px!important;line-height: 30px;padding: 2px;font-family: system-ui;color: #000c48;font-weight: 500;}.pTop {padding-top: 10px;}.explainerfive {text-align: left;color: #666;font-size: 10px!important;line-height: 25px;font-family: system-ui;}.detailTableHeader1 {position: relative;flex: 1 1 auto;font-size: 16px!important;padding: 5px 15px 5px 15px!important;background-color: #ffffff;border-radius: 4px 4px 0 0;text-align: left;color: #000000;border-bottom: 1px solid #dad8d8;}.detailTableOuterLayer3 {margin: auto;color: #000c48!important;display: block;border-radius: 4px;position: absolute;top: 135px;left: 50%;transform: translate(-50%,0);overflow: hidden;width: 800px;}.fas.fa-info-circle {font-size: 11px;padding-left: 4px!important }.detailTableHeader2 {margin-bottom: -5px;font-size: 15px!important;line-height: 42px;border-bottom: 1px solid #e98300;margin-bottom: 10px }.detailTableHeader3 {background-color: #ec825a;padding: 8px 0 8px 15px;color: white;position: relative;flex: 1 1 auto;font-size: 16px!important;border-radius: 5px 5px 0 0;text-align: left;}.detailTable {table-layout: fixed;width: 100%;font-size: 11px!important }label {color: #000c48!important;line-height: 1.8 }.content {min-width: 450px;max-width: 100%;text-align: center;margin: 1rem auto .5rem;flex: 1;width: 100%!important }#BackToEmailsId.question {width: 200px!important;justify-content: center!important;align-items: center!important;margin-top: 25px!important }#formContent {margin-bottom: 150px!important;-webkit-border-radius: 5px;border-radius: 15px;background: white;padding: 30px;width: 90%;max-width: 450px;position: relative;padding: 0;-webkit-box-shadow: 0 30px 60px 0 rgba(0, 0, 0, .3);box-shadow: 0 30px 60px 0 rgba(0, 0, 0, .3);text-align: center }#formFooter {background-color: white;padding: 25px;text-align: center;-webkit-border-radius: 0 0 10px 10px;border-radius: 0 0 15px 15px;color: white;}div.content-wrapper {color: #000c48!important;text-align: left;margin: 0 auto;padding: 10px 10px;background-color: #fff;box-shadow: 0 .125rem .5rem .125rem rgba(0, 0, 0, .15);min-width: 250px;padding-right: 25px!important;padding-left: 25px!important;width: 100%!important;}div.content-wrapper p {font-size: .875rem;padding-left: 10px;padding-right: 10px }div.preference {margin: auto;color: #000c48!important;max-width: 450px;display: block }.detailTableOuterLayer {margin: auto;color: #000c48!important;width: 100%;padding-left: 50px;padding-right: 50px;display: block;border-radius: 4px;position: relative;top: 118px;overflow: hidden;}.detailTableOuterLayer_750 {margin: auto;color: #000c48!important;width: 90%;display: block;border-radius: 4px;position: relative;top: 95px;border-bottom: 1px solid rgba(0, 0, 0, .125);box-shadow: 0 0px 10px 0 rgb(0 0 0 / 5%);max-width: 750px;background-color:white;padding: 30px;}.detailTableOuterLayer_1000 {margin: auto;color: #000c48!important;width: 90%;display: block;border-radius: 4px;position: relative;max-width: 750px;background-color:white;padding: 0 0 20px 0;}.leftEditor {margin: auto;color: #000c48!important;width: 50%!important;display: block;border-radius: 0px!important;position: absolute;padding-top: 120px!important;height: 100%;overflow-y: scroll;border: 1px solid rgba(0, 0, 0, .2);left: 0!important;}#ToggleEmailViewForm {top: 27.5px;z-index: 1000;right: 130px!important;position: fixed!important;}#preview_mode {top: 27.5px;z-index: 1000;right: 325px!important;position: fixed!important;}.leftEditorHeader {position: relative;flex: 1 1 auto;font-size: 16px!important;padding: 5px 15px 5px 15px!important;background-color: #f8f8f8;border-radius: 0;text-align: left;border: 1px solid rgba(0, 0, 0, .125);left: 1px;}.leftEditorBody {border-radius: 0;border-top: 0;position: absolute;width: 100%;padding: 25px 10px 25px 10px;margin: 0!important;padding-bottom: 65px!important;top: 60px;}.rightPreview {margin: auto;color: #000c48!important;width: 50%!important;display: block;border-radius: 0px!important;position: fixed;top: 65px;border-bottom: 1px solid rgba(0, 0, 0, .125);height: 100%;background-color: white;right:0px!important;}.rightPreviewHeader {position: relative;flex: 1 1 auto;font-size: 16px!important;padding: 5px 15px 5px 15px!important;background-color: #f8f8f8;border-radius: 0;text-align: left;border: 1px solid rgba(0, 0, 0, .125);right: 1px;}.rightPreviewBody {border-radius: 0;border-top: 0;height: 100%;position: absolute;background-color: #f7f7f7;width: 100%;padding: 20px;margin: 0!important;right: 0px;}.rightPreviewIframe {width: 100%;height: 100%;border: none;position: absolute;z-index: 100;left: 1px;top: 10px;}.bottomSideActionPane {bottom: 0;position: fixed;z-index: 1000;background-color: white;padding: 10px;border: 1px solid rgba(0, 0, 0, .2);width: 49.9%;border-right: none;left: 0;}.radiodiv {margin-top: 10px;text-align: left;}input[type=radio] {width: 20px!important;height: 15px!important }button {outline: none!important;}.buttons {margin-top: 10px!important;background-color: #0070d2;border: none!important;color: #fff!important;text-align: center!important;text-decoration: none!important;cursor: pointer!important;border-radius: 5px!important;height: 35px;margin-bottom: 5px }.buttons:hover {background: #7ca3ea;color: #fff }.buttons:active {position: relative;top: 2px }.form-toggle {position: absolute!important;right: 22px!important;}.form-control:hover {background-color: white!important;}.form-control {width: auto;height: 25px;font-size: 1rem;background-color: #fff!important;background-clip: padding-box;border: 1px solid #ced4da;border-radius: .25rem;transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;}.form-control:focus {color: #495057;background-color: #fff!important;border-color: #80bdff;outline: 0;box-shadow: 0 0 0 .2rem rgba(0,123,255,.25) }.form-control::-webkit-input-placeholder {color: #6c757d;opacity: 1 }.form-control::placeholder {color: #6c757d;opacity: 1 }.form-inline {display: -ms-flexbox;-ms-flex-flow: row wrap;flex-flow: row wrap;-ms-flex-align: center;align-items: center;z-index: 1002!important;right: 40px!important;top: 11px!important;}.form-inline .form-control {width: 500px!important;border: solid 1px #e2e2e2!important;position: absolute;height: 34px;top: 4px!important;background-color: #ecedef!important;border-radius: 4px;padding-left: 15px;left: 50%;transform: translate(-50%,0);}.form-inline .form-check {width: 100% }.toggle-handle {background-color: #fff!important;}.toggle-on.btn {padding-left: 5px;padding-right: 15px;}.toggle-off.btn {padding-left: 15px;color: #fff!important;padding-right: 5px;}div.toggle.btn-secondary {width: auto!important;height: 40px!important;box-shadow: none!important;}div.toggle.btn-primary {width: auto!important;height: 40px!important;}form button div.toggle.btn-success, form button div.toggle.btn-danger {position: relative!important;right: auto!important;top: 0px;}label.btn.btn-secondary,label.btn.btn-primary {line-height: 25px!important;}div.toggle.btn.btn-success {width: auto!important;height: auto!important;box-shadow: none!important;border-radius: 5px;}div.toggle.btn.btn-success.listView {top:-2px;right:-1px!important;}div.toggle.btn.btn-danger {width: auto!important;height: auto!important;box-shadow: none!important;border-radius: 5px;}div.toggle.btn.btn-warning {width: auto!important;height: auto!important;box-shadow: none!important;}div.toggle.btn.btn-info {width: auto!important;height: auto!important }.toggle.btn {min-width: 105px!important;min-height: 20px!important;box-shadow: none!important;}i.down {border: solid #de7318;border-width: 0 1px 1px 0;display: inline-block;padding: 3px;transform: rotate(45deg);-webkit-transform: rotate(45deg);text-align: center!important;height: 20px;width: 20px }.update-text {width: 90%!important;text-align: center!important;border-radius: 5px;text-align: left;border: 0;padding-top: 10px;padding-bottom: 10px;margin: 0 auto;margin-top: 15px!important;background: #e98300!important;color: #fff }.appC_name {font-size: 23px;padding: 10px 15px;position: fixed;z-index: 1336;}.navigation-logo {background-color: #ffffff;font-size: 14px;width: 100%;position: fixed;z-index: 997;top: 40px!important;color: #005bff!important;border-bottom: 1px solid rgba(0,0,0,.25);}.navMenuButton {width: auto;height: 36px;top: 0px!important;position: fixed;left: 0px;font-size: 15px!important;background-color: white;color: #005bff!important;z-index: 1199;padding-left: 7px;border-radius: 0!important;padding-right: 0;}.spanRowData {font-size: 12px!important;color: #525252;}@media screen and (max-height:100vh) {.scroll_700 {max-height: 90vh;}}.appNavButton {background-color: inherit;color: #005bff;border: none;height: 50px;}.appNavForm {display: block;position: absolute;top: 0;right: 140px;}.dropdown-menu2 {position: absolute;z-index: 1000;right: 0px;border: 1px solid rgba(0, 0, 0, .15);background-color: white;padding: 5px 0px 5px;box-shadow: 0 5px 8px 0 rgb(0 0 0 / 10%);border: 1px solid rgba(0, 0, 0, .15);}label.btn.btn-secondary, label.btn.btn-primary {line-height: 0.5!important;color: white!important;font-size: 11px!important;}.toggle.btn.btn-primary, .toggle.btn.btn-secondary {height: 20px!important;top: 19px;box-shadow: none;right: 45px;color: white!important;border-radius: 5px;}.btnCol2 {color: #0e6bdf;background-color: #e9ecef;transition: none;width: 32.999%;font-size: 14px!important;box-shadow: 0 5px 8px 0 rgb(0 0 0 / 10%);}.btnCol2:hover {color: #0e6bd0;background-color: #ccd8e4;border-color: #0e6bd0;}.assetRowContainer {padding: 14px;width: 100%;background: white;font-size: 10px!important;color: #525252!important;text-decoration: none!important;text-align: left!important;transition: none;border-bottom: 1px solid rgba(0, 0, 0, .125);outline: none;height: 32px;}.spanToggleSortBy {position: absolute;right: 190px;padding-top: 2px;font-size: 10px;color: #525252;}.selectCBRow {position: absolute;right: 15px!important;color: #007bff;cursor: pointer;top: 20px;font-size: 12px;}.editAssetRow {cursor: pointer;color: #007bff;outline: 0!important;font-size: 12px;}.viewAssetRow {cursor: pointer;color: #007bff!important;outline: 0!important;font-size: 12px;}.deleteAssetRow {color: #ff0505;cursor: pointer;outline: 0!important;font-size: 12px;}.continueEditingRow {all: unset;color: #005bff;background-color: inherit;outline: 0;}.viewAssetRow2 {position: absolute;right: 135px;cursor: pointer;top:15px;background-color: white;outline: 0!important;}.editAssetRow2 {cursor: pointer;outline: 0!important;}.cb_action_buttons {line-height: 0;padding-bottom: 3px;}.navigation_header {position: fixed;z-index: 1300;background-color: #FFFFFF;text-align: center;line-height: 100%;text-align: center;padding: 10px;width: 100%;height: 40px;border-bottom: 4px solid #e98300;}.fas {line-height: .5;}.subText {font-size: 12px;padding-top: 7px;color: #5f5e5e;font-family: system-ui;margin-bottom: -4px;font-weight: normal;line-height: 2;}.subText2 {font-size: 12px;padding-bottom: 5px!important;color: #5f5e5e;padding-left: 2px;font-family: system-ui;font-weight: normal;line-height: 2;}.starsAlign {position: absolute!important;top: 15px!important;}.emailEditordropDownMenuButton {height: 70px;font-size: 15px!important;background-color: #efefef73;padding: 10px;width: 100%;color: #007bff!important;text-decoration: none!important;text-align: left!important;transition: none;font-family: sans-serif;border-radius: 4px 4px 0 0!important;line-height: 1;height: 100%;max-width: 100%!important;font-weight: bold;}.inputCol2 {border-color: #e0e0e0!important;background-color: whitesmoke!important;border-radius: 4px 0 0 4px!important;border: 1px solid rgba(0, 0, 0, .125)!important;min-height: 28px;}.emailEditorDropdownIcon {text-align: right;position: absolute;right: 15px;top:25px!important;}.user_icon {position: fixed;z-index: 1301;right: 0px;width: auto;border-radius: 0!important;color: #005bff!important;}.userTab {width: 228px!important;position: fixed;right: 0px;top: 40px;z-index: 1201;padding-top: 0px;border: 1px solid rgba(0, 0, 0, .15);background-color: #fff;}.userTabButton {height: 42px;font-size: 14px!important;padding-left: 20px;border-radius: 0!important;}.appVersion {font-size:14px!important;border:none;color:#005bff!important;padding-left: 15px;margin-bottom: 5px;}.user_icon:hover, .user_icon:focus, .assetRowContainer:hover .emailditordropDownMenuButton:hover, .navMenuButton:hover, .navMenuButton:focus, .nav_tab_button:hover, .nav_tab_button:focus, #helpBar:hover, #helpBar:focus, #AnalyticsButton:hover, #AnalyticsButton:focus, #createTab:hover, #createTab:focus, .closeSingleView:hover, .appNavButton:hover, #relatedButton:hover, #PopupButton:hover {color: #0070FA!important;outline: 0!important;text-shadow: .7px .7px #3690ff;}.appNavForm .appNavButton {height: 42px;}.brand_tab {color: #005bff!important;position: fixed;z-index: 1301;right: 210px!important;padding-right: 8px;padding-left: 8px;top: -1px;}.environmentTab {position: fixed;z-index: 1301;left: 150px!important;padding-right: 8px;padding-left: 8px;margin-top: -11.2px;}.input_search_brand {padding-left: 14px!important;margin-bottom: 10px!important;width: 95%;position: relative;left: 10px;text-align: left!important;background-color: #eaeaea!important;}.nav_tab_button {height: 35px;font-size: 14px!important;color: #005bff!important;padding: 9px;top: -2px;}.home_nav_button {width:100%!important;font-size:14px!important;color: #005bff!important;}.toggle-handle {border: 1px solid #8f8f8f!important;}#helpBar {position: fixed;top: 39px;z-index: 1000;height: 35px!important;width: auto;right: 0px;line-height: 0;font-size: 12px!important;border-radius: 0!important;padding-bottom: 1px;border-radius: 0px;outline: 0!important;color: #005bff!important;}#relatedButton {position: fixed;top: 37px;z-index: 1000;height: 39px!important;width: auto;right: 155px;line-height: 0;padding: 0px 10px;font-size: 12px!important;border-radius: 0px!important;outline: 0!important;color: #005bff!important;}#AnalyticsButton {position: fixed;top: 39px;z-index: 1000;height: 35px!important;width: auto;right: 55px;line-height: 0;font-size: 12px!important;border-radius: 0px!important;outline: 0!important;color: #005bff!important;}#PopupButton {position: fixed;top: 57px;z-index: 1000;width: auto;right: 300px;line-height: 0;padding: 0px 10px;font-size: 12px!important;border-radius: 0px!important;outline: 0!important;color: #005bff!important;}.analytics_right_title {position: absolute;right: 25px;top: 15px;font-size: 18px;}#createTab {position: fixed;top: 39px;z-index: 1000;height: 36px!important;width: auto;right: 50px;line-height: 0;padding: 0 10px;font-size: 12px!important;border-radius: 0px;outline: 0!important;color: #005bff!important;}.closeSingleView {z-index: 1000;height: 35px!important;width: auto;padding: 0 5px 1px 5px!important;border-radius: 0!important;outline: none!important;font-size: 12px!important;color: #005bff!important;}.mobileViewClass {width: 450px;left: 50%;transform: translate(-50%, 0px);}.assetSearch {display: block;position: absolute;right: 146px!important;top: 108px!important;left: auto!important;overflow: auto!important;width: 289px;}.sidebar-nav li a:hover, .sidebar-nav li button:hover {background-color: #eaeaea!important;outline: 0;}.checkcontainer {font-size: 13px;text-align: left;display: block;position: relative;padding-left: 45px;padding-bottom: 8px;}.checkcontainer input {position: absolute;opacity: 0;}.checkcontainer2 {display: block;position: relative;margin-bottom: 25px;}.modal-header .close {padding: 1rem 1rem;margin: -1rem -1rem -1rem auto;}.checkbox-inline {font-size: 12px;width: 25px;text-align: center }.communication-prefer {display: block;margin-bottom: 20px!important;font-size: 26px;line-height: 25px;text-align: center }.checkmark {position: absolute;top: 0;left: 0;height: 25px;width: 25px;background-color: #eee }.checkcontainer:hover input~.checkmark, .checkcontainer2:hover input~.checkmark {background-color: #ccc }.checkcontainer input:checked~.checkmark, .checkcontainer2 input:checked~.checkmark {background-color: #5580ce }.checkmark:after {content: "";position: absolute;display: none }.checkcontainer input:checked~.checkmark:after, .checkcontainer2 input:checked~.checkmark:after {display: block }.checkcontainer .checkmark:after, .checkcontainer2 .checkmark:after {left: 9px;top: 5px;width: 7px;height: 11px;border: solid #fff;border-width: 0 3px 3px 0;-webkit-transform: rotate(45deg);-ms-transform: rotate(45deg);transform: rotate(45deg) }.td_w_50 {width:50%!important;}.tw_100 {width:100%!important;}.td_w_7 {width: 6%!important;}.td_pL_32 {padding-left:32px!important;}.td_w_32_px {width: 32px!important;}.question {padding: 5px;min-height: 32px;font-size: 12px!important;border-radius: 5px;border-color: #e0e0e0!important;background-color: #efefef73;}.question2 {min-height: 28px;font-size: 12px!important;border-color: #e0e0e0!important;background-color: #f5f5f5;border: 1px grey;border: 1px solid rgba(0, 0, 0, .125);border-radius: 4px;}input#file-upload-button {border: none!important;font-size: 14px!important;color: #007bff!important;text-decoration: none!important;text-align: left!important;outline: none!important;}.assetRowContainer>table {width: 100%;display: table;table-layout: fixed;border-collapse: collapse;color: #000;height: 100%;}.two_column_field_group {table-layout: fixed;width: 100%;}.assetRowContainer td {text-align: left!important;font-size: 12px;padding-left: 10px;width: auto!important;display: table-cell;text-align: center;vertical-align: middle;word-wrap: break-word;white-space: nowrap;font-weight: 500;overflow: hidden;}.min1 {height: 32px!important;border-top-color: #fff!important;border-right-color: #fff!important;border-left-color: #fff!important;}.min2 {height: 32px!important;border-top-color: #fff!important;border-right-color: #fff!important;border-left-color: #fff!important;}td {text-align: left!important;line-height: 25px!important;width: 100%!important;margin: 10px;font-size: 12px;}.navLogo {padding: 30px!important;color: white!important;font-size: 15px!important;}@media screen and (max-width:650px) {.navigation-logo {font-size: 15px;}.communication-prefer {font-size: 20px!important;}.explainer {font-size: 18px!important;}.explainertwo {font-size: 14px!important;line-height: 32px;}.card-body {padding: 1.2rem;}.form-toggle {right: 8px!important;}}.accordion {padding: 0!important;border-radius: 4px;max-width: 1200px;}.accordion_1200 {padding: 0!important;max-width: 1200px;border-radius: 4px;box-shadow: 0 0px 10px 0 rgb(0 0 0 / 5%);}@media screen and (max-width:2600px) {.detailTableOuterLayer2 {width: 1500px;}}.singleTableWrapper {padding: 0 60px 0px 60px;}.detailTableOuterLayer2 {margin: auto;color: #000c48!important;width: 90%;display: block;border-radius: 4px;position: relative;top: 95px;max-width: 1200px;padding-bottom: 30px;}.card-header {padding: 0!important;}.btn-link {font-size: 14px!important;color: #007bff!important;text-decoration: none!important;text-align: left!important;outline: none!important;}.alert {position: fixed;top: 40px!important;border-radius: 0!important;border: 1px solid transparent;text-align: left;font-size: 16px;padding: 10px 30px 10px 15px;margin-bottom: 0!important;width: 100%;z-index: 1400;}.alert-dismissible .close {position: absolute;right: 9px;color: inherit;padding: 0!important;top: 2px;font-size: 30px!important;width: auto;}.alert-success {color: #155724;background-color: #d4edda;border-color: #819c7b!important;}.alert-danger{color: #721c24;background-color: #f8d7da;border-color: #b47178;}.alert-warning {color: #856404;background-color: #fff3cd;border-color: #d9bd65;}.toast {max-width: 100%;font-size: 14px;border: 1px solid rgba(0,0,0,.1);opacity: 100%!important;top: 121px;position: fixed;display: block;z-index: 1000;position: fixed;left: 50%;transform: translate(-50%, 0);box-shadow: none!important;line-height: 43px;padding-left: 20px;width: 100%!important;}.toast:not(:last-child) {margin-bottom: 0!important;}.bd-example-modal-lg .modall-dialog {display: table;position: relative;margin: 0 auto;top: calc(50% - 24px) }.bd-example-modal-lg .modall-dialog .modall-content {background-color: transparent;border: none }.fa-2x {font-size: 50px!important }.fa-spin {animation: fa-spin 1s infinite linear!important }.mr-sm-2, .mx-sm-2 {margin-right: .2rem!important;}.navPath{height:45px!important;border-radius: 0!important;font-size: 16px!important;padding-bottom: 0!important;}.licon {font-size:14px!important;}@media screen and (max-width: 1100px) {.nslCardImage {left: 50%;}}@media screen and (max-width:500px) {.buttons {background-color: #0070d2;border: none!important;color: #fff!important;text-align: center!important;text-decoration: none!important;letter-spacing: 2px!important;cursor: pointer!important;border-radius: 3px!important }.inputsearchbutton {width: 100%!important;top: 65px!important;}.alert {font-size: 12px!important;}.btn-link {font-size:12px!important;}.navPath {font-size: 14px!important;border-bottom: 0!important;}.licon {font-size: 12px!important;}.modal-dialog-scrollable {max-height: calc(100% - 3.5rem) }.modal-dialog-scrollable .modal-content {max-height: calc(100vh - 3.5rem) }.modal-dialog-centered {min-height: calc(100% - 3.5rem) }.modal-dialog-centered::before {height: calc(100vh - 3.5rem) }.modal-sm {max-width: 300px }.explainerfour {text-align: left;line-height: 25px }.detailTable td {font-size: 11px;line-height: 22px!important }.detailTableHeader2 {font-size: 13px!important }.nslCardImage {top: 220px;left: 50%;max-width: 90%;}}.cBlack {color: black!important;}.cBlack:hover{color: blue!important;}.ql-snow .ql-tooltip::before {content: "Visit URL:";line-height: 26px;margin-right: 8px;display: block!important;}.ql-snow .ql-tooltip a.ql-action::after {border-right: none!important;content: 'Edit';margin-left: 0!important;padding-right: 0!important;}.ql-snow .ql-tooltip a {line-height: 26px;display: block!important;}.ql-snow .ql-tooltip a.ql-remove::before {content: 'Remove';margin-left: 0!important;}.ql-flip {right: 0!important;left: 0!important;width: 100%;top: 0!important;margin-top: 0!important;}.ql-snow .ql-tooltip input[type=text] {width: 100%!important;}.ql-snow .ql-tooltip a.ql-preview {max-width: 100%!important;}.ql-toolbar.ql-snow {border: 1px solid #ccc;box-sizing: border-box;font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif;padding: 8px;border-radius: 4px 4px 0 0px!important;}.open-text {border: 1px solid rgba(0, 0, 0, .125);z-index: auto;position: relative;width: 100%;min-height: 103px;border-radius: 4px;resize: none;font-size: 12px!important;background-color: #f5f5f5;margin-bottom: -5px;}.open-text-truncated {border: 1px solid rgba(0, 0, 0, .125);z-index: auto;position: relative;width: 100%;min-height: 103px;border-radius: 4px;resize: none;font-size: 12px!important;background-color: #f5f5f5;margin-bottom: -5px;}textarea.open-text {min-height: 55px!important;padding-top: 5px;}textarea.open-text-truncated {min-height: 28px!important;padding-top: 5px;}.freeTextClass {border: 1px solid rgba(0, 0, 0, .125);z-index: auto;position: relative;width: 100%;resize: none;font-size: 12px!important;background-color: #f5f5f5;min-height:250px;border-radius: 0 0 4px 4px;}button, input, select, textarea {height: 28px;background: 0 0;outline: 0;border: solid 1px #bebebe;font-size: 13px!important;padding-left: 10px;padding-right: 10px;border-radius: 4px;width: 100%;}.question:hover, select:hover, textarea:hover, .open-text:hover, .question2:hover, .inputCol2:hover {background: #efefef73!important;}button.question:hover {background-color:#0c5193!important;}#sidebar-wrapperShow {z-index: 1298;width: 0;-webkit-transition: all .2s ease;-moz-transition: all .2s ease;-o-transition: all .2s ease;transition: all .2s ease;padding: 0!important;border-top: none;transition: none;position: fixed;width: 200px;padding: 0!important;margin-top: 65px!important;top: -40px;border-radius: 0 0px 15px 15px;margin-top: 100px;background-color: white;}#sidebar-wrapper::-webkit-scrollbar {display: none;}.sidebar-nav {position: absolute;top: 0px;width: 200px;margin: 0;padding: 0;list-style: none;background-color: white;box-shadow: 0 5px 8px 0 rgb(0 0 0 / 10%);border: 1px solid rgba(0, 0, 0, .15);margin-top: 35px;}.sidebar-nav li {position: relative;display: inline-block;width: 100%;height: 35px;}.border_bottom {border: 1px solid rgba(0, 0, 0, .15)!important;}.sidebar-nav li:before {content: '';position: absolute;top: 0;left: 0;z-index: -1;height: 100%;background-color: #26263f;-webkit-transition: width .2s ease-in;-moz-transition: width .2s ease-in;-ms-transition: width .2s ease-in;transition: width .2s ease-in;background-color: white;}.sidebar-nav li:first-child a {text-align: left!important;padding-right: 25px!important;color: #fff;background-color: #FFFFFF }.sidebar-nav li:hover:before {width: 100%;-webkit-transition: width .2s ease-in;-moz-transition: width .2s ease-in;-ms-transition: width .2s ease-in;transition: width .2s ease-in }.sidebar-nav li a {display: block;color: #005bff!important;text-decoration: none;padding-left: 15px;text-align: left!important;font-size: 14px!important ;height: 35px;line-height: 8px;padding: 10px 10px 11px 15px!important;}.dropdown-toggle:focus {outline: 0;}.sidebar-nav li a:active, .sidebar-nav li a:focus, .sidebar-nav li.open a:active, .sidebar-nav li.open a:focus {color: #fff;text-decoration: none;background-color: transparent }.dropdown, .dropup {position: relative }.dropdown-toggle::after {display: inline-block;width: 0;height: 0;margin-left: .255em;vertical-align: .255em;content: "";border-top: .3em solid;border-right: .3em solid transparent;border-bottom: 0;border-left: .3em solid transparent }.dropdown-menu>li>a {display: block;clear: both;line-height: 1.42857143;color: #333;white-space: nowrap;color: #fff!important;background-color: inherit!important;padding: 0 10px 10px;line-height: 15px;max-width: 350px;}a:hover {text-decoration: none }.open>.dropdown-menu {display: block }.dropdown-header {display: block;padding: 3px 20px;line-height: 1.42857143;color: #777;white-space: nowrap }.sidebar-nav>.sidebar-brand {padding-right: 20px!important;text-align: center!important;height: 65px;font-size: 20px;line-height: 44px }.sidebar-nav .dropdown-menu {position: absolute!important;width: 100%;padding: 0;margin: 0;border-radius: 0;border: none;background-color: #fff;box-shadow: none;margin: 1px;display: block;position: absolute;left: 198px;width: auto;box-shadow: 0 5px 10px 0 rgb(0 0 0 / 30%);padding-left: 20px!important;top: 0;}.close {position: relative;font-size: 38px!important;right: 8px;top: 0px;outline: 0!important;float: right;font-size: 1.5rem;font-weight: 700;line-height: 1;color: #000;text-shadow: 0 1px 0 #fff;opacity: .5;right: 15px;}.navinput {all: unset!important;color: #005bff!important;padding: 0px 0 0px 15px!important;font-size: 14px!important;width: 255px!important;height: 100%!important;color: #005bff!important;}.homeButton {color: #005bff!important;padding-left: 0!important;height: 45px;}.overlay {position: fixed;display: none;width: 100%;height: 100%;top: 0;left: 0;right: 0;bottom: 0;background-color: rgba(250, 250, 250, .8);z-index: 1 }.wrapper {margin-top: 100px;display: flex!important;align-items: center;flex-direction: column;justify-content: center;width: 100%;min-height: 100%;}h2.inactive {color: #ccc }h2.active {color: #0d0d0d;border-bottom: 2px solid #5fbae9 }button, input[type=button], input[type=reset], input[type=submit] {border: none;color: #fff;text-align: center;text-decoration: none;display: inline-block;font-size: 13px;-webkit-border-radius: 5px 5px 5px 5px;border-radius: 5px 5px 5px 5px;}input[type=text]:hover, input[type=button]:hover, input:hover::placeholder, .open-text:hover::placeholder {background-color: #efefef73;}.toggleSortByFields {color:#428bca!important;font-size:13px!important;text-align:left;background-color: white!important;outline: 0!important;border-radius: 0!important;padding-left: 20px;}.related_fields {border: 0.5px solid rgb(219, 219, 219);border-radius: 4px;padding: 0.8rem;margin-bottom: 20px;}hr {margin-top: 15px;margin-bottom: 10px;border: 0;border-top: 1px solid #f44335 }.nav {padding-left: 0;margin-bottom: 0;list-style: none;}.nav>li {position: relative;display: block }.nav>li>a, .nav>li>button {position: relative;display: block;padding: 10px 15px }.btn-info.active, .btn-info.focus, .btn-info:active, .btn-info:focus, .btn-info:hover, .open>.dropdown-toggle.btn-info {color: #fff;background-color: #31b0d5;border-color: #269abc }i.fas.fa-angle-down.rotate-icon {position: absolute;right: 12px;top: 13px;}.floatLeft {float: unset;display: inline-block;margin-bottom: 20px;width: 235px;}.close:not(:disabled):not(.disabled):focus, .close:not(:disabled):not(.disabled):hover {opacity: .75;}.ql-tooltip .ql-editing .ql-flip {position: fixed!important;top: 50%;left: 20%;}.p_top_n_bottom_10 {padding-top: 10px!important;padding-bottom: 10px!important;}.bold {font-weight:bold!important;}.font20 {font-size: 20px!important;}#global_search_tab {position: fixed;z-index: 1300;left: 230px;top:8px;}.global_search_input:hover, .global_search_input:focus, .global_search_input:active {box-shadow: 0 0px 15px 0 rgb(10 176 224 / 99%);}.global_search_input {padding-left:5px;background-color: #edeef0!important;text-align: left;width:225px;font-size: 11px;height:21px;margin: 0!important;}@media screen and (max-width:1135px) {.global_search_input {width:150px!important;font-size: 8px!important;}}#global_search_tooltip {background-color: white!important;}.main-flex-container, .main-flex-container-2, .inner-flex-tabel-container, .inner-flex-chart-container {display: flex;padding: 8px;flex-direction: row;align-items: flex-start;}.main-flex-container {padding: 0px;}.inner-flex-chart-container {flex-direction: column;align-items: stretch;}.box, .box-tabel {flex-grow: 1;flex-basis: 100%;padding: 5px;}.box-type-2 {flex-basis: 100%;}.main-flex-container-2 {justify-content: center;padding: 20px 0 0 0;}@media (max-width: 768px) {.main-flex-container, .inner-flex-tabel-container {flex-direction: column;align-items: stretch;}.main-flex-container-2 {justify-content: flex-start;align-items: stretch;}.box-type-2 {flex-basis: 100%;}}table.chart-tabel-container {border-collapse: collapse;text-align: left;width: 100%;border: solid 1px #ddd;}table.chart-tabel-container tr {background: white;}table.chart-tabel-container tr:nth-child(even) {background: #f1efef;}table.chart-tabel-container th, table.chart-tabel-container td {padding: 0px 4px;width: unset !important;border: none !important;}table.chart-tabel-container th {font-size: 12px;background-color: #ddd;padding: 4px 4px;}table.chart-tabel-container td span {background: #ddd;color: #000;display: none;font-size: 10px;font-weight: bold;padding: 0px 10px;position: absolute;text-transform: uppercase;top: 0;left: 0;}@media(max-width: 768px) {table.chart-tabel-container thead {left: -9999px;position: absolute;visibility: hidden;}table.chart-tabel-container tr {border-bottom: 0;display: flex;flex-direction: row;flex-wrap: wrap;margin-bottom: 4px;}table.chart-tabel-container td {border: 1px solid #ddd;margin: 0 -1px -1px 0;padding-top: 23px;position: relative;width: 50% !important;}table.chart-tabel-container td span {display: block;}table.chart-tabel-container {border: none;}table.chart-tabel-container tr:nth-child(even) {background: #fff;}table.chart-tabel-container th, table.chart-tabel-container td {border: solid 1px #afacac !important;}}@media(max-width: 576px) {table.chart-tabel-container td {width: 100%;}table.chart-tabel-container tr:nth-child(even) {background: #fff;}table.chart-tabel-container {border: none;}}.container-date-range {padding: 6px 0px 15px 0px;display: flex;flex-direction: row;gap: 25px;justify-content: center;}.container-date-range label {margin-bottom: 0;margin-top: 14px;padding-left: 6px;}.container-date-range>div button {margin-top: 10px;width: 220px;}.container-date-range>div input[type=date] {padding: 5px;background-color: #fff;width: 220px;}.table-checkbox-selection {border-collapse: collapse;border: 1px solid #000;width: 100%;}.table-checkbox-selection th {color: #000;}.table-checkbox-selection th:first-child {background-color: #000;color: #fff;}.table-checkbox-selection td:first-child {background-color: #aba9a9;color: #000;}.table-checkbox-selection thead th:nth-child(-n+1) {width: 4% !important;}.table-checkbox-selection thead th:nth-child(n+2):nth-child(-n+5) {width: 10% !important;}.table-checkbox-selection thead th:nth-child(n+6):nth-child(-n+11) {width: 14% !important;}.padLR40 .table-checkbox-selection td, th {padding: 8px;text-align: left;font-size: 11px;border: solid 1px #000;white-space: nowrap;font-weight: bold;width: unset !important;}.padTB15 {padding: 15px 0 15px 0;}.newsletter-perference-history-table {border-collapse: collapse;width: 100%;}.newsletter-perference-history-table tr.first th {top: 0;position: sticky;z-index: 20;background-color: #ffffff;}.newsletter-perference-history-table tr.second th {top: -1;position: sticky;z-index: 20;background-color: #ffffff;}.newsletter-perference-history-table th {padding: 4px 4px;text-align: left;font-size: 12px;border: none;}.newsletter-perference-history-table td {padding: 2px 4px;text-align: left;border-bottom: solid 1px #beb9b9;font-size: 12px;width: unset !important;}.newsletter-perference-history-table tbody tr:nth-child(odd) {background-color: #f1efef;}.newsletter-perference-history-table td.drop {color: #bb2020;cursor: default;}.newsletter-perference-history-table td.rise {color: #108a38;cursor: default;}.newsletter-perference-history-table td.null-value {color: #ff8f07;cursor: default;}.newsletter-perference-history-table td.drop:hover, .newsletter-perference-history-table td.rise:hover, .newsletter-perference-history-table td.null-value:hover {font-weight: bold;font-size: 14px;font-style: italic;}.newsletter-perference-history-table tbody tr td.drop:hover {background-color: rgb(189, 33, 33, 0.07);}.newsletter-perference-history-table tbody tr td.rise:hover {background-color: rgb(15, 138, 56, 0.07);}.newsletter-perference-history-table tbody tr td.null-value:hover {background-color: rgb(255, 143, 5, 0.07);}.newsletter-subscription-title {background-color: #f58690;text-align: center }.marketing-subscription-title {background: #65b6f4;text-align: center }.header-title {display: flex;align-items: stretch;background-color: #fff;}.header-title > div {color: #000;text-align: center;font-size: 14px;padding: 6px;font-weight: bold;}.newsletter-perference-history-table thead tr.first th.col1, .newsletter-perference-history-table tbody tr td.col1 {width: 4% !important;}.newsletter-perference-history-table thead tr.first th.col2, .newsletter-perference-history-table tbody tr td.col2 {width: 13% !important;}.newsletter-perference-history-table thead tr.first th.col3, .newsletter-perference-history-table tbody tr td.col3 {width: 8% !important;}.newsletter-perference-history-table thead tr.first th.col4, .newsletter-perference-history-table tbody tr td.col4 {width: 8% !important;}.newsletter-perference-history-table thead tr.first th.col5, .newsletter-perference-history-table tbody tr td.col5, .newsletter-perference-history-table thead tr.first th.col7, .newsletter-perference-history-table tbody tr td.col7, .newsletter-perference-history-table thead tr.first th.col8, .newsletter-perference-history-table tbody tr td.col8, .newsletter-perference-history-table thead tr.first th.col9, .newsletter-perference-history-table tbody tr td.col9 {width: 8% !important;}.newsletter-perference-history-table thead tr.first th.col10, .newsletter-perference-history-table tbody tr td.col10 {width: 8% !important;}.newsletter-perference-history-table thead tr.first th.col11, .newsletter-perference-history-table tbody tr td.col11 {min-width: 150px !important;}.newsletter-perference-history-table thead tr.first th.col6, .newsletter-perference-history-table tbody tr td.col6 {width: 12% !important;}.newsletter-perference-history-table thead tr.first th:last-child, .newsletter-perference-history-table tbody tr td:last-child {text-align: right !important;}.notClickable {pointer-events: none;}.newsletter-perference-history-table .asc, .newsletter-perference-history-table .desc {cursor: pointer;}.newsletter-perference-history-table tr.first th.desc:after, .assetRowContainer table tr td.clickable.desc:after {content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpolygon points='0, 0 8,0 4,8 8' fill='%23818688'/%3E%3C/svg%3E");margin-left: 10px;}.newsletter-perference-history-table tr.first th.asc:last-child:after .newsletter-perference-history-table tr.first th.desc:last-child:after {content: '';}.newsletter-perference-history-table tr.first th.asc::after, .assetRowContainer table tr td.clickable.asc:after {content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpolygon points='4 0,8 8,0 8' fill='%23818688'/%3E%3C/svg%3E");margin-left: 10px;}.date-range-field-note {padding: 10px 5px 9px 30px;font-size:12px;font-style: italic }.date-form-container {background-color: #f3f1f1;border: solid 1px #ddd;border-radius: 6px;margin:20px 0px;}.chart-container {position: relative;margin: auto;height: 80vh;width: 80vw;}.overflowX {overflow-x: scroll;}.Chart2 {margin-top: 25px;}.detailTableOuterLayer2.top72 {top: 72px;margin: unset;width: 100%;max-width: unset;}.detailTableHeader2.no-line-height {line-height: unset;}.padB10 {padding-bottom: 10px;}.padLR8 {padding: 0px 8px;}.padT36 {padding-top: 36px;}.padLR40.overflowX {width: 95%;margin: 0 auto }.detailTableHeader2.right-side-page-title {position: absolute;right: 25px;top: 10px;border-bottom: none;line-height: unset;}.padLR40 .table-checkbox-selection.textWrap td, th {white-space: unset;}.table-checkbox-selection.textWrap tbody td {width: unset !important;border: 1px solid #000;padding: 2px 8px;}.table-checkbox-selection.half-size thead tr th, .table-checkbox-selection.half-size tbody tr td {font-size: 8px;}.analytics-chart-tabel {display: flex;padding: 8px }.pad4 {padding: 4px;}.editAssetRow.related-email-name {text-align: left;padding-left:0px;height:0px;color:grey }@media (max-width: 768px) {.container-date-range {flex-direction: column;align-items: stretch;gap: 2px;padding: 0px 30px 20px 30px;}.container-date-range>div input[type=date] {margin-top: 0px;width: 100%;}.container-date-range>div button {margin-top: 20px;width: 100%;}.padLR40.overflowX {width: 96%;}.analytics-chart-tabel {flex-direction: column;}}.assetRowContainer.related-email {background-color: #ddd;padding: 0px;}.assetRowContainer .related-email-body tr:nth-child(even) {background-color: #f1efef;}.padT25 {padding-top: 25px;}.assetRowContainer.related-email-container {min-height:115px;overflow-y:scroll;padding:0px;}.related-email-main-container {border:solid 1px #ddd;}.detailTable.lastChild15p tr td:last-child {width:15px!important;}.displayNone {display:none }.accordion_1200.new-style {max-width: unset;}.singleTableWrapper.padLR15 {padding: 0 15px 0px 15px;}#tooltip, #infotip {position: absolute;display: none;top: 2px;left: 37px;background-color: rgba(0,0,0,.700);padding: 8px 14px;font-size: 14px;;border-radius: 6px;z-index: 999;color: #fff;}#infotip {font-size: 11px;padding: 4px 8px;}#tooltip span {float: left;margin-right: 10px;font-weight: bold;}#tooltip.news span {color: #f58690;font-style: italic;font-weight: bold;}#tooltip.marketing span {color: #65b6f4;font-style: italic;font-weight: bold;}#tooltip.news {border: solid 3px #f58690;}#tooltip.marketing {border: solid 3px #65b6f4;}.togglebtn {position: absolute;top: 0px;right: 146px;padding: 5px 5px 5px 0px;}.togglebtn .btn-outline-warning {color: #000 !important;border-color: #ffc107 !important;background-color: #ffc107!important;}.togglebtn .btn-outline-info.active:hover {background-color: #166e7b !important;border-color: #166e7b !important;}.togglebtn .btn-outline-warning:hover {color: #000 !important;border-color: #e0a800 !important;background-color: #e0a800 !important;}.togglebtn .toggle-handle {background-color: #000 !important;}.togglebtn .btn-outline-info.off .toggle-handle {background-color: #fff !important;}.togglebtn .btn-outline-info {border-color: #17a2b8;}.list_view_accordion.remove-scroll .list_view_table_row_container {overflow-y: unset;height: 0px;}.no-row-found {display: none;text-align: center;padding: 5px;background-color: #f1efef;border-bottom: solid 1px #beb9b9;}.newsletter-perference-history-table tr.first th.col11.asc::after {content: '';}.newsletter-perference-history-table tr.first th.col11.asc{cursor: default;}.percent.hideText::first-letter, .count-value.hideText::first-letter {visibility: hidden;}.percent.hideText, .count-value.hideText {position: relative;}.percent.hideText::after, .count-value.hideText::after {content: '0';position: absolute;left: 0;}.newsletter-perference-history-table tr.first th:nth-child(n+3):nth-child(-n+6):hover {background-color: rgba(245, 134, 144, 0.1);}.newsletter-perference-history-table tr.first th:nth-child(n+7):nth-child(-n+10):hover{background-color: rgba(101, 182, 244, 0.1);}.formContainer-listview {background-color: #fff;display: block;height: 97%;overflow-y: scroll;margin-top: 59px;border-bottom-left-radius: 4px;border-bottom-right-radius: 4px;}.title-grid-box-style {margin-bottom:5px!important;margin-top:10px!important;box-shadow: 0 5px 8px 0 rgb(0 0 0 / 10%);border-radius:2px!important;}.clickable {cursor: pointer;}.home-grid {width: 100%;}.home-grid tbody tr td {width: unset !important;}.home-grid tbody tr {border-bottom: 1px solid rgba(0, 0, 0, .125);}.home-grid tbody tr td {padding-left: 10px;}.home-grid tbody tr td span.no-overflow {display: block;white-space:nowrap;position:relative;width:100%;margin-right:-20000px;overflow:hidden;}.home-grid td.noRow {text-align: center !important;font-weight: bold;background-color: #ebe6e6;}#tooltip-home-page {display: none;position: absolute;padding: 8px;border: solid 2px #fac106;background-color: rgba(0, 0, 0, 0.8);color: #fac106;border-radius: 6px;z-index: 9999;}.home-grid tr.veryfirstrow {display: table-row !important;border-bottom: unset;}.home-grid.no-rows-home-grid {width: 100%;}.home-grid.no-rows-home-grid tr td {padding: 4px 4px 4px 10px;font-weight: bold;}.container-date-range .btn.btn-warning {background-color: #9a9a9a;color: #fff;border-color: #9a9a9a;}.daystylerange {padding:5px 12px;background:#497edd;font-weight: bold;color: #fff;border-radius: 6rem;font-size: 0.8rem }.marginR10 {margin-right:10px }::-webkit-scrollbar {width: 6px;height: 6px;}::-webkit-scrollbar-track {background: #fff;}::-webkit-scrollbar-thumb {background: #adacac;border-radius: 1rem;}::-webkit-scrollbar-thumb:hover {background: #7b7979;}.ql-picker-options {height: 290px!important;overflow: auto!important;}.width-auto {width: auto!important;}.ql-picker-label {padding-top: 2px;font-weight: normal;}.leftEditorBody2>.accordion>.card {box-shadow: 1px 0px 10px rgb(188 186 186 / 50%);}
      %%[ ENDIF ]%%
     </style>
   </head>
   <body>
      %%[ IF @access == 1 AND @layer != 'LOGOUT' THEN ]%%
        <!-- START APP CENTRE NAV -->
        <div class="appC_name">  
          <button type="button" data-toggle="offcanvas" class="dropdown-toggle navMenuButton" id="FilterApp" aria-haspopup="true" aria-expanded="false" onclick="appC_ui_component('retrieve_user_apps_nav','user_appsShow','','','1','0','0');show_or_hide_on_click('user_appsShow');">
          <i class="fas fa-bars"></i> &nbsp;Apps list
        </button>
        </div>
        <div class="navigation_header" width="100%">
          %%[ IF EMPTY(@header_image) THEN ]%%
            <div style="height:40px;"></div>
          %%[ ELSE ]%%
            <img src="%%=v(@header_image)=%%" style="height:16.5px;">
          %%[ ENDIF ]%%
        </div>
        <div class="environmentTab">
          <form action="" accept-charset="UTF-8" method="post" id="ToggleEnvironmentForm">
            <input type="hidden" value="ToggleEnvironment" name="FormName" >
            <input type="checkbox" %%=IIF(@appView_reverse == true OR @AppAll_reverse == true OR @app == 'Home','','disabled')=%% %%=v(@sourceEnvBadge)=%% data-toggle="toggle" data-onstyle="primary" data-offstyle="secondary" data-on="PROD" data-off="UAT" id="ToggleEnvironmentButton">
          </form>
        </div>
        <form action="" accept-charset="UTF-8" method="post" id="global_search_tab" onsubmit="modal();">
            <input type="hidden" value="Id:GlobalSearch//Action:View//target_field:%%=v(@sourceObject)=%%" name="FormName" >
            <input type="text" name="GlobalSearchValue" placeholder=" Search for an email, brand or tile" class="form-control mr-sm-2 inputsearchbutton global_search_input" >
            <button type="submit" onclick="modal();" style="font-size: 10.5px!important;width:20px;padding: 1.8px;border: solid #cbcaca 1px;height: auto;position: absolute;right: -10px;background-color: white;height: 21px;">🔎</button>
        </form>
        <div class="brand_tab">
          <div class="btn-group">
            <button type="button" class="dropdown-toggle nav_tab_button" id="FilterBrand" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" onclick="appC_ui_component('retrieve_brand_list_in_nav','brand_rows','','','0','0','0');">%%=IIF(LENGTH(@friendly_brandName) > 28,Concat(Substring(@friendly_brandName,1,25),'...'),@friendly_brandName)=%%</button>
            <div class="dropdown-menu" aria-labelledby="FilterBrand" id="FilterBrandShow" style="display:none;top: 37px;">
              <div id="brand_rows">
                <div style="text-align:center;padding:20px;">
                  <div class="modall-dialog modal-sm" style="text-align:center;max-width:100%;">
                    <div class="modall-content">
                      <span class="fa fa-circle-o-notch fa-spin fa-fw fa-2x" aria-hidden="true"></span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <button id="User" class="nav_tab_button user_icon">
          <div class="dropdown-toggle">
            <i class="fas fa-user" style="position: relative;right:0;padding-right:7px;"></i>%%=IIF(LENGTH(@userName) > 18,Concat(Substring(@userName,1,18),'...'),@userName)=%%
          </div>
        </button>
        <div class="userTab" id="UserShow" style="display:none">
          <form action="" accept-charset="UTF-8" method="post">
            <input type="hidden" value="LOGOUT" name="LOGOUT">
            <button class="toggleSortByFields userTabButton" type="submit" onclick="modal();" style="font-size: 14px!important;height:32px;">Log out</button>
          </form>
        </div>
        <div class="navigation-logo">
          <form method="post" action="" accept-charset="UTF-8" style="display:inline-block;">
            <button %%=IIF(NOT EMPTY(@sourceIdValue),'','disabled')=%% class="closeSingleView" style="padding-left:10px!important;padding-right:0px!important;%%=IIF(NOT EMPTY(@sourceIdValue),'','color: black!important;')=%%" name="FormName" value="Value://Id:CloseView" type="submit" onclick="modal();">
                %%=v(@ui_name)=%%
            </button>
          </form>
          %%[ IF NOT EMPTY(@sourceIdValue) AND @previewMode == 1 THEN ]%%
            %%[ IF @app == 'Email Editor' THEN ]%%
                <div style="display: inline-block;background-color: white;">
                  <div class="btn-group">
                    <button style="font-size: 12px!important;padding-right: 5px;padding-left: 5px;padding-top:8px;display: inline-block;padding-right:0px!important;" type="button" class="dropdown-toggle nav_tab_button" id="FilterEmail" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" onclick="appC_ui_component('all_accessible_emails_list','all_accessible_emails_rows','','status=%%=v(@OppositeStatus)=%%','0','0','0');"> <i class="fas fa-angle-right" aria-hidden="true"></i> &nbsp;  %%=IIF(LENGTH(@sourceIdValue) > 34,Concat(Substring(@sourceIdValue,1,32),'...'),@sourceIdValue)=%%&nbsp;</button>
                    <div class="dropdown-menu" aria-labelledby="FilterEmail" id="FilterEmailShow" style="display:none;top: 33.5px;min-width:300px;">
                      <div id="all_accessible_emails_rows">
                        <div style="text-align:center;padding:20px;">
                          <div class="modall-dialog modal-sm" style="text-align:center;max-width:100%;">
                            <div class="modall-content">
                              <span class="fa fa-circle-o-notch fa-spin fa-fw fa-2x" aria-hidden="true"></span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
            %%[ ELSE ]%%
                <span class="closeSingleView" style="color: black!important;" %%[ IF @app == 'Email Editor' THEN ]%% title="%%=v(Lookup(@sourceTable,'Description','EmailName',@sourceIdValue))=%%" %%[ ENDIF ]%%>
                >&nbsp; %%=IIF(@app != 'Mobile push tags',@sourceIdValue,Lookup(@sourceTable,'AppName','APID',@sourceIdValue))=%%
                </span>
            %%[ ENDIF ]%%
          %%[ ENDIF ]%%
          %%[ IF NOT EMPTY(@sourceIdValue) AND NOT EMPTY(@sourceSubObjTableValue) AND @sourceSubObjTableValue != 'Close' AND @previewMode == 1 THEN ]%%
            <form method="post" action="" accept-charset="UTF-8" style="display:inline-block;">
              <button disabled class="closeSingleView" name="FormName" value="%%=Concat('SubObject:Close//Id:CloseView//Value:',@sourceIdValue)=%%" type="submit" onclick="modal();" style="color: black!important;">
                %%=IIF(@sourceSubObjTableValue == 'Email settings and layout','Template Settings and Layout',IIF(@sourceSubObjTableValue == 'Email header settings','Header Settings and Layout',IIF(@sourceSubObjTableValue == 'Email footer settings','Footer Settings and Layout',@sourceSubObjTableValue)))=%%
              </button>
            </form>
          %%[ ENDIF ]%%
          %%[ IF @environmentAppCentre != 'PROD' AND @app == 'Email Editor' THEN ]%%
            <span style="text-align:center;color: black;display: inline-block;position: absolute;top: 50%;left: 50%;transform: translate(-50%, -50%);background: white;font-size: 12px;padding: 5px;font-weight: bolder;border-radius: 50px;">%%=v(@environmentAppCentre)=%%</span>
          %%[ ENDIF ]%%
        </div>
        <div id="user_appsShow" style="display:none;">
        </div>
        <button id="helpBar" type="button" data-toggle="modal" data-target="#exampleModal">Help ?</button>
        %%[ IF @displayMessage == 1 THEN ]%%
          <div id="appC_message" class="alert alert-%%=v(@statusOfMessage)=%% alert-dismissible fade show" role="alert">
            %%=v(@appCMessage)=%%
            <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          </div>
        %%[ ENDIF ]%%
        <div id="client_side_message"></div>
        <!-- END APP CENTRE NAV -->
        <!-- START CURRENT APP -->
        %%[   
        IF NOT EMPTY(@formName) THEN 
          for @pp = 1 to RowCount(BuildRowSetFromString(@appC_PermissionSet,"|")) do 
            IF Trim(Field(Row(BuildRowSetFromString(@appC_PermissionSet,"|"),@pp),1)) == @fn_Action THEN
              IF Lookup(@appCPermissionTable,'Access','EmailAddress',@emailAddress,'ParentApp',@parentApp,'Type',@fn_Action) != true AND IndexOf(@formName,'Id:NavigateToButton//') != 1 THEN
                SET @formMessage = Concat("You don't have permission to ",LowerCase(@fn_Action),' in this app or environment. To get your permissions updated, please raise a <a href="https://sofi.newscorp.com/esc?id=sc_cat_item&table=sc_cat_item&sys_id=ae90bf888724a510d82afcc6cebb35d9" target="_blank">SOFI access request ticket</a>.')
                InsertData(@stateDE,'EventID',GUID(),'Object',@appObject,'SectionName',@currentAppSectionName,'SessionID',@cookie,'Message',@formMessage,'Displayed',0,'DateAdded',@localTime,'Username',@username,'Status',0,'Value',@fn_Value,'ShowInactive',@showInactive,'Environment',@appStateEnvironment,'Section',@currentAppSection,'SectionName',@currentAppSectionName,'FormName',@formName,'Action',@fn_Action,'SubObject',@sourceSubObjTableValue,'SubObjValue',@sourceIdSubjValue,'FilterBU',@currentBrandFilter,'Progress',@CurrentProgress,'target_field',@selected_field,'brand_state',@brand_selected,'fields_state',@selected_fields)
                SET @refresh_page = 1
                SET @do_not_action = 1
                SET @formName = 'No permission'
              ENDIF
            ENDIF
          next @pp
        ENDIF
        IF @environmentAppCentre == 'UAT' THEN ]%%
          %%=TreatAsContent(HTTPGET(@app_content))=%%
        %%[ ELSEIF @environmentAppCentre == 'SIT' THEN ]%%
          %%=TreatAsContent(Lookup('ent.AppC_code_SIT','Code','Name',@App_content))=%%
        %%[ ELSE ]%%
          %%=TreatAsContent(Lookup('ent.AppC_code','Code','Name',@App_content))=%%
        %%[ ENDIF ]%%
        <!-- END CURRENT APP -->
      
      %%[ ELSE ]%%
        %%[ IF @environmentAppCentre == 'UAT' THEN ]%%
          %%=TreatAsContent(HTTPGET('https://dl.dropboxusercontent.com/s/tbn7x55ym2sagyj/appC_login.amp'))=%%
        %%[ ELSEIF @environmentAppCentre == 'SIT' THEN ]%%
          %%=TreatAsContent(Lookup('ent.AppC_code_SIT','Code','Name','AppC_login_PROD','Active','1'))=%%
        %%[ ELSE ]%%
          %%=TreatAsContent(Lookup('ent.AppC_code','Code','Name','AppC_login_PROD','Active','1'))=%%
        %%[ ENDIF 
      ENDIF ]%%
      %%[
        IF @fn_Action == 'Create' OR @fn_Action == 'Edit' OR @fn_Action == 'Execute' THEN
          SET @currentAppSectionName = 'UpdatedDate DESC'
          IF @fn_Action != 'Execute' THEN SET @fn_Progress = 0 ENDIF
        ENDIF
        IF @do_not_action != 1 THEN 
          IF NOT EMPTY(@formName) THEN 
            InsertData(@stateDE,
              'EventID',@appEventID,
              'Object',IIF(EMPTY(@fn_Object),@appObject,@fn_Object),
              'SectionName',@currentAppSectionName,
              'SessionID',@cookie,
              'Message',@formMessage,
              'Displayed',IIF(EMPTY(@fn_Displayed),IIF(EMPTY(@fn_Action),1,0),@fn_Displayed),
              'DateAdded',@localTime,
              'Username',@username,
              'Status',IIF(EMPTY(@formStatus),1,@formStatus),
              'Value',IIF(NOT EMPTY(@navSel),'',@fn_Value),
              'ShowInactive',@showInactive,
              'Environment',IIF(EMPTY(@fn_Environment),@appStateEnvironment,@fn_Environment),
              'Section',@currentAppSection,
              'FormName',@formName,
              'Action',@fn_Action,
              'SubObject',IIF(NOT EMPTY(@navSel) OR EMPTY(@fn_Value),'',IIF(EMPTY(@fn_SubObject),@sourceSubObjTableValue,@fn_SubObject)),
              'SubObjValue',IIF(NOT EMPTY(@navSel) OR EMPTY(@fn_Value),'',IIF(EMPTY(@fn_SubObjValue),@sourceIdSubjValue,@fn_SubObjValue)),
              'FilterBU',@currentBrandFilter,
              'Progress',IIF(EMPTY(@fn_Progress) OR EMPTY(@fn_Value),IIF(@ParentApp != 'Analytics',0,30),@fn_Progress),
              'target_field','',
              'brand_state',IIF(EMPTY(@fn_brand_state) OR EMPTY(@fn_Value),@userCurrentBrand,@fn_brand_state),
              'fields_state',IIF(EMPTY(@fn_fields_state) OR EMPTY(@fn_Value),@CurrentFields_state,@fn_fields_state),
              'appC_env',@environmentAppCentre,
              'show_help_tool',IIF(EMPTY(@fn_show_help_tool),0,@fn_show_help_tool))
            IF (@formName == Concat('Id:GlobalSearch//Action:View//target_field:',@fn_target_field) OR indexOf(@FormName,'FilterEmail') > 0) AND @noMatch != 1 THEN 
              UpsertData('ent.Users',2,'ContactKey',@contactKey,'Username',@username,'app',IIF(EMPTY(@fn_Object),@appObject,@fn_Object),'Environment',IIF(EMPTY(@fn_Environment),@appStateEnvironment,@fn_Environment),'currentBrand',IIF(EMPTY(@fn_brand_state) OR EMPTY(@fn_Value),@userCurrentBrand,@fn_brand_state))
            ENDIF
            SET @refresh_page = 1
          ELSE 
            UpdateData(@stateDE,1,'EventID',@eventIdMessage,'Displayed',1)
          ENDIF
        ENDIF ]%%
      <script type="text/javascript">
      %%[ IF @access == 1 AND @layer != 'LOGOUT' THEN ]%%
          function modal(){
                $('.modall').modal('show');
                setTimeout(function () {
                  %%[ IF @environmentAppCentre == 'UAT' THEN ]%%
                  console.log('completed');
                  %%[ ENDIF ]%%
              $('.modall').modal('hide');
            }, 70000);
          }

        %%[ IF @access == 1 AND @layer != 'LOGOUT' THEN ]%%
        var divHeight=$(window).height()*82/100; 
        $("#divid").css("height",divHeight).css({ "height": divHeight, "overflow-y": "scroll", 
                "border-top-left-r .alertadius": 0,
                "border-top-right-radius": 0,
                "border-bottom-right-radius": 4,
                "border-bottom-left-radius": 4, 
                "background-color":"white" });
        $("#divid2").css("height",divHeight).css({ "height": divHeight, "overflow-y": "scroll", 
                "border-top-left-radius": 0,
                "border-top-right-radius": 0,
                "border-bottom-right-radius": 4,
                "border-bottom-left-radius": 4, 
                "background-color":"white" });

        $(document).mouseup(function(e) {
            var container = $("[id*=Show]");
            if (!container.is(e.target) && container.has(e.target).length === 0) {container.hide();}
          });

        $(document).mouseup(function(e) {
            var container = $("#appC_message");
            if (!container.is(e.target) && container.has(e.target).length === 0) {
                container.hide();
            }
        });

        $(document).mouseup(function(e) {
            var container = $("#appC_message_2");
            if (!container.is(e.target) && container.has(e.target).length === 0) {
                container.hide();
            }
        });

        $('.dropdown-item.toggleSortByFields').click(function() { modal(); });

        function filterFunction() {
          var input, filter, ul, li, a, i;
          input = document.getElementById("brandsInputSearch");
          filter = input.value.toUpperCase();
          div = document.getElementById("FilterBrandShow");
          a = div.getElementsByTagName("button");
          for (i = 0; i < a.length; i++) {
            txtValue = a[i].textContent || a[i].innerText;
            if (txtValue.toUpperCase().indexOf(filter) > -1) {
              a[i].style.display = "";
            } else {
              a[i].style.display = "none";
            }
          }
          filterSearchInputPostion('brand', 0);
        }

        function filterFunctionEmails() {
          var input, filter, ul, li, a, i;
          input = document.getElementById("emailInputSearch");
          filter = input.value.toUpperCase();
          div = document.getElementById("FilterEmailShow");
          a = div.getElementsByTagName("button");
          for (i = 0; i < a.length; i++) {
            txtValue = a[i].textContent || a[i].innerText;
            if (txtValue.toUpperCase().indexOf(filter) > -1) {
              a[i].style.display = "";
            } else {
              a[i].style.display = "none";
            }
          }
          setTimeout(() => {

          },3000)
          filterSearchInputPostion('email', 0);
        }

        function filterFunctionCBs() {
          var input, filter, ul, li, a, i;
          input = document.getElementById("CBInputSearch");
          filter = input.value.toUpperCase();
          div = document.getElementById("FilterCB_dropdown_menu");
          a = document.getElementsByClassName("retrieve");
          for (i = 0; i < a.length; i++) {
            txtValue = a[i].textContent || a[i].innerText;
            if (txtValue.toUpperCase().indexOf(filter) > -1) {
              a[i].style.display = "";
            } else {
              a[i].style.display = "none";
            }
          }
        }

        $("#ToggleEnvironmentButton").change(function() { $("#ToggleEnvironmentForm").submit(); modal();});
        $("#FilterBrand").click(function() { 
            $("#FilterBrandShow").show(); 
            filterSearchInputPostion('brand', 3000);  
        });
        $("#FilterEmail").click(function() { 
            $("#FilterEmailShow").show(); 
            filterSearchInputPostion('email', 5000);
        });

         function filterSearchInputPostion (value, delay) {
            setTimeout(() => {
                if(value === 'brand') {
                    console.log(document.querySelectorAll('#FilterBrandShow')[0].clientWidth)
                    const width = document.querySelectorAll('#FilterBrandShow')[0].clientWidth
                    document.querySelectorAll('#FilterBrandForm')[0].style.padding = '50px 0px 0px 0px'
                    document.querySelectorAll('#brandsInputSearch')[0].style.position = 'fixed';
                    document.querySelectorAll('#brandsInputSearch')[0].style.width = width - 2 + 'px';  
                } else {
                    console.log(document.querySelectorAll('#FilterEmailShow')[0].clientWidth)
                    const width = document.querySelectorAll('#FilterEmailShow')[0].clientWidth
                    const parentElement = document.querySelectorAll('#all_accessible_emails_rows')[0]
                    document.querySelectorAll('#emailInputSearch')[0].style.position = 'fixed';
                    document.querySelectorAll('#emailInputSearch')[0].style.width = width + 'px'; 
                    const childElement = parentElement.childNodes[3];
                    childElement.style.paddingTop = '50px'  
                }
            }, delay)
        }
        $(document).ready(function() {$("#User").click(function() {$("#UserShow").toggle();});});

        async function add_or_edit_cb_api(action_area,src_secret,id,type,posInEmail,event) {
            event.preventDefault();
            event.stopPropagation();
            $("#loading_preview_right_view").show();
            $("#error_right_view").css("display","none");
            $("#emailPreviewIframe").css("display","none");
            %%[ IF @preview_mode == 'focused' THEN ]%%
                $("#subject_n_preheader").css("display","none");
            %%[ ENDIF ]%%
            $("#save_cb_message").css("display","none");
            $("#review_step_button").css("background-color","#c5c5c5").prop('disabled', true);
            $("#send_step_button").css("background-color","#c5c5c5").prop('disabled', true);
            let form_id = 'add_or_edit_contentBlock_api';
            let data = new FormData(event.target);
            let formJSON = Object.fromEntries(data.entries());
            console.log(formJSON);
            if (action_area == 'copy_or_duplicate_from_other_email') {
              var id = data.getAll("content_block_id").toString();
              var duplicate_or_reference = data.getAll("duplicate_or_reference").toString();
              var action_area = duplicate_or_reference;
              var posInEmail = data.getAll("PositionInEmail").toString();
              var use_ref_cb_hide = data.getAll("use_ref_cb_hide").toString();
            } else {
              var selectedDays = data.getAll("hide_set_of_days").toString();
              var newPos = data.getAll("PositionInEmail").toString();
              var ref_cb = data.getAll("ref_cb").toString();
              formJSON.hide_set_of_days = selectedDays;
              var make_backup = data.getAll("make_backup").toString();
              var create_or_update_backup = data.getAll("create_or_update_backup").toString();
              var backup_id = data.getAll("backup_id").toString();
              var de_eca_use_more_cts = (data.getAll("de_eca_use_more_cts").toString() == 'true') ? '1': '0';
              var edit_eca_use_more_cts = data.getAll("use_more_cts").toString();
              var block_section = data.getAll("block_section").toString();
            };
            if (data.getAll("backup_name").toString()) {
              formJSON.friendly_name = data.getAll("backup_name").toString();
            };
            console.log('ref_cb: '+ref_cb);
            try {
              if ((type == 'free_text_block' || type == 'quote_block') && (action_area == 'add' || action_area == 'edit') && ref_cb != '1') {
                  formJSON.freeText_content = document.getElementById("editor" + id).firstChild.innerHTML.replaceAll('="www.','="https://www.').replaceAll('<p><img src=','<p styling="margin-bottom:0px;"><img src=');
              }
              let response = await fetch('https://cloud.e.newsdigitalmedia.com.au/%%=IIF(@appStateEnvironment == 'UAT','uat_','')=%%add_edit_cb_and_gaf?biz_env=%%=v(@appStateEnvironment)=%%&form_id='+form_id+'&sys_env=%%=v(@environmentAppCentre)=%%&c=%%=v(@cookie)=%%&action_area='+action_area+'&id='+id+'&cbPos='+posInEmail+'&secret='+src_secret+'&use_ref_cb_hide='+use_ref_cb_hide+'&make_backup='+make_backup+'&create_or_update_backup='+create_or_update_backup+'&backup_id='+backup_id, {
                  method: 'POST',
                  body: JSON.stringify(formJSON, null, 2)
              });
              let resp = await response.json();
              %%[ IF @environmentAppCentre == 'UAT' THEN ]%%
              console.log(resp); console.log(resp.form_message); console.log(resp.message_color); console.log('resp: ' + JSON.stringify(resp.description));
              %%[ ENDIF ]%%
              let rm = resp.form_message ? resp.form_message : "Couldn't perform this action. The SFMC team has been notified and will get back to you shortly.";
              let rc = (resp.message_color != 'danger' && resp.message_color != 'success' && resp.message_color != 'warning') ? 'danger' : resp.message_color;
              if (resp.message == 'reloadpage') {
                window.location.reload(true);
                show_client_side_message('User session expired. Logging out...','warning');
              } else {
                if (action_area == 'edit' || action_area == 'decouple') {
                  $('#save_block_message_' + id).css("display","none");
                  show_client_side_message(rm,rc);
                  %%[ IF @preview_mode == 'focused' THEN ]%%
                    $('#emailPreviewIframe').attr('src','https://cloud.e.newsdigitalmedia.com.au/uat_appC_brand_HF?Brand=%%=v(@src_Brand)=%%&key=%%=v(@cookie)=%%&env=%%=v(@appStateEnvironment)=%%&secret=%%=v(@src_secret)=%%&sys_env=%%=v(@environmentAppCentre)=%%');
                    var friendly_cb_name = $('#cb_friendly_name_nav_source_' + id).html();
                    document.getElementById("cb_friendly_name_nav_target").innerHTML = friendly_cb_name;
                  %%[ ELSE ]%%
                    refreshIframebyId('emailPreviewIframe');
                  %%[ ENDIF ]%%
                  if(resp.message_color == 'success') { 
                      $('#duplicate_cb'+id).css("display","inline-block");
                      $('#share_cb'+id).css("display","inline-block"); 
                      $('#backup_settings'+id).css("display","block");
                      if (action_area == 'edit' && make_backup == 1) {
                        $('#backup'+id).css("display","unset");
                        $('#show_back_up_preview_link'+id).css("display","inline");
                        $('#make_backup_checkbox'+id).prop( "checked", false );
                      };
                      %%[ IF @environmentAppCentre == 'UAT' THEN ]%%
                        console.log('showed duplicate button id: '+ id);
                      %%[ ENDIF ]%% 
                  };
                  if ((posInEmail != newPos || !newPos || action_area == 'backup' || make_backup == 1) || de_eca_use_more_cts != edit_eca_use_more_cts && block_section == 1)  {
                    %%[ IF @Role != 'EditorPlus' AND @role != 'Editor' THEN ]%%
                      %%[ IF @environmentAppCentre == 'UAT' THEN ]%%
                      console.log('posInEmail: ' + posInEmail + ' | newPos: ' + newPos);
                      %%[ ENDIF ]%%
                      if (action_area == 'decouple' || action_area == 'backup' ) { var action_area = 'edit' };
                      load_list_of_content_blocks(action_area,src_secret,type,id);
                    %%[ ELSE ]%%
                      $('.modall').modal('hide');
                    %%[ ENDIF ]%%
                  } else {
                    $('.modall').modal('hide');
                  }
                } else {
                  if(resp.message_color != 'warning') {
                    window.location.reload(true);
                  } else {
                      show_client_side_message(rm,rc);
                      refreshIframebyId('emailPreviewIframe');
                      $("#emailPreviewIframe").css("display","block");
                      $('.modall').modal('hide');
                    }
                }
              }
              if (type == 'curated_collection' || type == 'recommended_collection' || type == 'video_collection') {
                let currentMax_articles = data.getAll("currentMaxArticles"+id).toString();
                let new_max_articles = data.getAll("MaxArticles"+id).toString();
                let use_multi_content_titles = data.getAll("use_more_cts").toString();
                if (currentMax_articles != new_max_articles && use_multi_content_titles) {
                  appC_ui_component(type,'CBCollapse'+action_area+id,id,'action_area='+action_area+'&cb_id='+id+'&cb_name='+type,'0','0','1','edit_cb_'+action_area+id);
                }
              }
            } catch (e) {
              show_client_side_message("Couldn't save the content block. The SFMC team has been notified and will get in touch during business hours. For urgent matters, please email shared_marketingcloud@news.com.au or raise an incident ticket by calling 1300006397 (select option 2 for Tech).","danger");
              $("#emailPreviewIframe").css("display","none");
              $('.modall').modal('hide');
              $("#loading_preview_right_view").hide();
              $("#error_right_view").css("display","block");
              %%[ IF @environmentAppCentre == 'UAT' THEN ]%%
                console.log('error: '+e);
              %%[ ENDIF ]%%
            }
          }

          function enable_buttom(id) {
            $("#"+id).prop('disabled',false); $("#"+id).css('background-color','#497edd');
          }

          async function cancel_job_api(app,jid,s) {
            event.preventDefault();
            event.stopPropagation();
            $('.modall').modal('show');
            let form_id = 'cancel_job_api';
            let data = new FormData(event.target);
            let formJSON = Object.fromEntries(data.entries());
            console.log(formJSON);
            let response = await fetch('https://cloud.e.newsdigitalmedia.com.au/%%=IIF(@appStateEnvironment == 'UAT','uat_','')=%%gaf_api?form_id='+form_id+'&sys_env=%%=v(@environmentAppCentre)=%%&c=%%=v(@cookie)=%%&jid='+jid+'&app='+app+'&s='+s, {
                method: 'POST',
                body: JSON.stringify(formJSON, null, 2)
            });
            let resp = await response.json();
            %%[ IF @environmentAppCentre == 'UAT' THEN ]%%
            console.log(resp); console.log(resp.form_message); console.log(resp.message_color); console.log('resp: ' + JSON.stringify(resp.description));
            %%[ ENDIF ]%%
            let rm = resp.form_message ? resp.form_message : "Couldn't perform this action. The SFMC team has been notified and will get back to you shortly.";
            let rc = (resp.message_color != 'danger' && resp.message_color != 'success' && resp.message_color != 'warning') ? 'danger' : resp.message_color;
            if (resp.message == 'reloadpage') {
              window.location.reload(true);
              show_client_side_message('User session expired. Logging out...','warning');
            } else {
              show_client_side_message(rm,rc);
              $('.modall').modal('hide');
              $('.modal').modal('hide');
            }
          }

          function change_pTop_iFrame(val) {
            let addcl = (val == 't') ? 'template_block_preview' : 'other_block_preview';
            let removecl = (val == 't') ? 'other_block_preview' : 'template_block_preview';
            $('#emailPreviewIframe').addClass(addcl);
            $('#emailPreviewIframe').removeClass(removecl);
            %%[ IF @environmentAppCentre == 'UAT' THEN ]%%
            console.log('change_pTop_iFrame = ' + val);
            %%[ ENDIF ]%%
          }

          function onchange_show_or_hide_on_value_match(s,t,v) {
            for (i = 0; i < v.length; i++) {
              console.log('length: ' + v.length +' looping nr: ' + i + ' v1: ' + v[i] + ' v2: ' + $('#' + s).val() +' t: ' + t[i]);
              if ($('#' + s).val() == v[i]) {
                $('#' + t[i]).show(); console.log('shown: ' + i + ' v: ' + v[i] + ' t: ' + t[i]); 
              } else { 
                $('#' + t[i]).hide(); console.log('hidden: ' + i +  ' v: ' + v[i] + ' t: ' + t[i]);
              }
            }
          }

          async function email_template_s_and_y_api(event) {
            event.preventDefault();
            event.stopPropagation();
            $("#emailPreviewIframe").css("display","none");
            $("#review_step_button").css("background-color","#c5c5c5").prop('disabled', true);
            $("#send_step_button").css("background-color","#c5c5c5").prop('disabled', true);
            %%[ IF @preview_mode == 'focused' THEN ]%%
            $("#subject_n_preheader").css("display","none");
            %%[ ENDIF ]%%
            const form_id = 'email_template_s_and_y_api';
            const data = new FormData(event.target);
            const formJSON = Object.fromEntries(data.entries());
            console.log(formJSON);
            let response = await fetch('https://cloud.e.newsdigitalmedia.com.au/gaf_api?form_id='+form_id+'&sys_env=%%=v(@environmentAppCentre)=%%&c=%%=v(@cookie)=%%', {
              method: 'POST',
              body: JSON.stringify(formJSON, null, 2)
            });
            refreshIframebyId('emailPreviewIframe');
            %%[ IF @preview_mode == 'focused' THEN ]%%
              load_subject_and_preheader();
              change_block_view('template');
            %%[ ENDIF ]%%
            let resp = await response.json();
            %%[ IF @environmentAppCentre == 'UAT' THEN ]%%
            console.log(resp.form_message); console.log(resp.message_color); console.log('resp: ' + JSON.stringify(resp.description));
            %%[ ENDIF ]%%
            let rm = resp.form_message ? resp.form_message : "Couldn't perform this action. The SFMC team has been notified and will get back to you shortly.";
            let rc = (resp.message_color != 'danger' && resp.message_color != 'success' && resp.message_color != 'warning') ? 'danger' : resp.message_color;
            if (resp.message == 'reloadpage') {
              window.location.reload(true);
              show_client_side_message('User session expired. Logging out...','warning');
            } else {
              $('#save_emailTemplate_message').css("display","none");
              show_client_side_message(rm,rc);
              $('.modall').modal('hide');
            }
          }
      
        function show_item() {
            $("[id*=hoverA]").hover(function(e) {
              var menu = e.target.id;
              var submenuvalue = menu.replace('hoverA','');
              var submenu = $('#' + submenuvalue);
              submenu.css("display","block");
              submenu.hover(function(e) {
                submenu.css("display","block");
              }, function() {
                if ($(this).attr("id") != menu) { submenu.css("display","none"); }
              })
            },
              function(e) {
                var menu = e.target.id;
                var submenuvalue = menu.replace('hoverA','');
                var submenu = $('#' + submenuvalue);
                submenu.css("display","none");
              });

        }

          function addInputField(h_or_f) {
            console.log('addInputField | ' + h_or_f);
            var max_fields = 10; /* maximum input fields allowed */
            var wrapper = $("#input_fields_wrap_" + h_or_f); /* wrapper for input fields */
            
            var x = wrapper.find("div").length; /* initial input field counter */
            console.log('x | ' + x);
            
            if (x < max_fields) {
              x++; /* increment input field counter */
              wrapper.append('<div><table style="width: 100%!important;"><tr><td style="width: 30%!important;" class="explainerfour pTop">'+x+'. Display name</td><td style="width:66%!important;" lcass="explainerfour pTop">Redirect URL / site link</td></tr><tr><td style="width:30%!important;"><input type="text" maxlength="400" class="question2" name="text_links_name_set_'+h_or_f+'" placeholder="Display name"/></td><td style="width:66%!important;"><input type="text" maxlength="400" class="question2" name="text_links_value_set_'+h_or_f+'"  placeholder="Provide a redirect URL / site link here."/></td><td style="width:4%!important;"><span class="remove_field_button"><span class="cross" onclick="removeInputField(event, \'' + h_or_f + '\')">X</span></span></td></tr></table></div>'); 
              /* add new input fields and remove button */
              
              /* show remove button only if there is more than one input field */
              if (x > 1) {
                wrapper.find(".remove_field_button").show();
              }
            }
          }

         function removeInputField(event, h_or_f) {
          event.preventDefault();
          console.log('removeInputField | ' + h_or_f);
          var wrapper = $("#input_fields_wrap_" + h_or_f);
          var x = wrapper.find("div").length;
          
          /* remove the input fields and their remove button */
          $(event.target).closest('div').remove();

          /* hide remove button if there are no more input fields */
          if (x == 1) {
            wrapper.find(".remove_field_button").hide();
          }
        }

        function addImageInputField(h_or_f) {
            console.log('addImageInputField | ' + h_or_f);
            var max_fields = 10; /* maximum input fields allowed */
            var wrapper = $("#image_input_fields_wrap_" + h_or_f); /* wrapper for input fields */
            
            var x = wrapper.find("div").length; /* initial input field counter */
            console.log('x | ' + x);
            
            if (x < max_fields) {
              x++; /* increment input field counter */

              wrapper.append('<div><table style="width:100%!important;"><tr><td style="width: 30%!important;" class="explainerfour pTop">'+x+'. Internal name</td><td style="width:66%!important;" class="explainerfour pTop">Redirect URL / site link</td></tr><tr><td style="width:50%!important;"><input type="text" class="question2" name="image_links_name_set_'+h_or_f+'" placeholder="Provide an internal image name." maxlength="400" /></td><td style="width:50%!important;"><input type="text" class="question2" name="image_links_value_set_'+h_or_f+'" placeholder="Provide a redirect URL / site link here." maxlength="400" ></td></tr></table><table style="width:100%!important;"><tr><td style="width: 100%!important;" class="explainerfour">Upload or provide an image logo url for your link here.</td></tr></table><table style="width:100%!important;"></table><table style="width:100%!important;"><tr><td style="width:16%!important;"><input id="upload_image_fileedit'+h_or_f+'_'+x+'" type="file" accept="image/*" placeholder="Upload an image." onchange="execute_image_upload(\'edit\',\''+h_or_f+'_'+x+'\');" style="border: none;font-size: 12px!important;color: #007bff!important;padding: 0px 2px 0px 0px;height: 32px!important;width: 80px;"></td><td style="width:80%!important;"><input id="image_upload_valueedit'+h_or_f+'_'+x+'" class="question2" name="image_logo_links_value_set_'+h_or_f+'" placeholder="Upload an image or provide an image logo url."></td><td style="width:4%!important;"><span class="remove_field_button"><span class="cross" onclick="removeImageInputField(event,\''+h_or_f+'\')">X</span></span></td></tr></table><br></div>');
              
              /* show remove button only if there is more than one input field */
              if (x > 1) {
                wrapper.find(".remove_field_button").show();
              }
            }
          }

         function removeImageInputField(event, h_or_f) {
          event.preventDefault();
          console.log('removeImageInputField | ' + h_or_f);
          var wrapper = $("#image_input_fields_wrap_" + h_or_f);
          var x = wrapper.find("div").length;
          
          /* remove the input fields and their remove button */
          $(event.target).closest('div').remove();

          /* hide remove button if there are no more input fields */
          if (x == 1) {
            wrapper.find(".remove_field_button").hide();
          }
        }

        function delete_asset(s) {
          var delete_asset = s.replace('deleteAsset','');
          var sourceIdValue = "#sourceIdValue" + delete_asset;
          var asset_name = $(sourceIdValue).text().trim();
          $("#delete_asset_input_field").val('Action:Delete//Value:' + asset_name);
          $("#deleteModal_asset").modal('show');
        }

        function show_client_side_message(message,message_color) {
          $('#client_side_message').html('<div id="appC_message_2" class="alert alert-dismissible fade show alert-' + message_color + '" role="alert" style="display:block;">' + message + '<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>');
        }

        function change_background_tr_row_on_click(t,bgc) {
          $('[id^="table_tr_row"]').css('background-color', 'white');
          $('#'+t).css("background-color",bgc);
          console.log('changed tr background to '+ bgc);
        }

        $('#emailPreviewIframe').on('load', function() {
          $("#emailPreviewIframe").css("display","block");
        });

          function hide_or_show_checkbox(s,t) {
            if ($('#' + s).is(":checked")) { $("#" + t).hide(); %%[ IF @environmentAppCentre == 'UAT' THEN ]%%console.log('hidden' + ' s: ' + s + ' t: ' + t);%%[ ENDIF ]%%  } else { $("#" + t).show(); %%[ IF @environmentAppCentre == 'UAT' THEN ]%%console.log('shown' + ' s: ' + s + ' t: ' + t);%%[ ENDIF ]%% };
          }

          function check_on_dropdown_value_list(s, t, v) {
            const selectedValue = $('#'+s).val();
            const checkboxElement = $('#' + t);
            if ($.inArray(selectedValue, v) !== -1) {
              checkboxElement.prop('checked', true);
            } else {
              checkboxElement.prop('checked', false);
            }
          }

          function change_btn_text_on_check(s,t,val1,val2) {
            var id = s.replace('make_backup_checkbox','');
            if ($('#'+s).is(":checked")) { $("#" + t).html(val1); $('#backup_options'+id).val('Create').change(); %%[ IF @environmentAppCentre == 'UAT' THEN ]%%console.log('changed button text' + '  t: ' + t);%%[ ENDIF ]%%  } else { $("#" + t).html(val2); %%[ IF @environmentAppCentre == 'UAT' THEN ]%%console.log('changed button text again reverse' + 's: ' + $('#'+s).val() + ' t: ' + t);%%[ ENDIF ]%% };
          }

          function change_btn_text_on_dropdown(s,t) {
            $("#" + t).html('Save changes and '+$('#' + s).val()+' the selected backup'); %%[ IF @environmentAppCentre == 'UAT' THEN ]%%console.log('changed button text on dropdown' + '  t: ' + t);%%[ ENDIF ]%%
          }

          function show_or_hide_checkbox(s,t) {
            if ($('#' + s).is(":checked")) { $("#" + t).show(); %%[ IF @environmentAppCentre == 'UAT' THEN ]%%console.log('shown' + ' s: ' + s + ' t: ' + t);%%[ ENDIF ]%%  } else { $("#" + t).hide(); console.log('hidden' + ' s: ' + s + ' t: ' + t);%%[ ENDIF ]%% };
          }

          function checkbox_will_show_element_if_hidden(s,t) {
            if ($('#' + s).is(":checked") && $("#" + t).css("display") == 'none') { $("#" + t).show(); %%[ IF @environmentAppCentre == 'UAT' THEN ]%%console.log('shown' + ' s: ' + s + ' t: ' + t);%%[ ENDIF ]%% };
          }

          function show_or_hide_dropdown(s,t,v) {
            if ($('#' + s).val() == v) { $('#' + t).show(); %%[ IF @environmentAppCentre == 'UAT' THEN ]%%console.log('shown' + ' s: ' + s + ' t: ' + t);%%[ ENDIF ]%% } else { $('#' + t).hide(); %%[ IF @environmentAppCentre == 'UAT' THEN ]%%console.log('hidden ' + t);%%[ ENDIF ]%% }
          }

          function hide_or_show_dropdown(s,t,v) {
            if ($('#' + s).val() == v) { $('#' + t).hide(); %%[ IF @environmentAppCentre == 'UAT' THEN ]%%console.log('hidden' + ' s: ' + s + ' t: ' + t);%%[ ENDIF ]%% } else { $('#' + t).show(); %%[ IF @environmentAppCentre == 'UAT' THEN ]%%console.log('shown');%%[ ENDIF ]%% }
          }

          function onchange_value_hide_array(s,[t],v) {
            if ($('#' + s).val() == v) { 
              for (i = 0; i < [t].length; i++) {
                $('#' + [t][i]).hide(); %%[ IF @environmentAppCentre == 'UAT' THEN ]%%console.log('hidden: ' + i + [t][i]);%%[ ENDIF ]%%
              }
            }
          }

          function hide_on_click_away(id) {
            $('#'+id).hide();
          }

          function onchange_populate_dinkus_values(id) {
            let id_d = id.replace('appC_dinkus','');
            if ($('#'+id).val() == "New") {
              $("#"+"d_name"+id_d).val('');
              $("#"+"d_title"+id_d).val('');
              $("#"+"d_small_img_url_check"+id_d).prop('checked', false);
              $("#"+"image_upload_value"+id_d+"_d_image_url").val('');
            } else {
              let id_d = id.replace('appC_dinkus','');
              %%[ IF @environmentAppCentre == 'UAT' THEN ]%%
              console.log('onchange_populate_dinkus_values: ' + id_d);
              %%[ ENDIF ]%%
              let v = $('#'+id).val();
              let val = $.parseJSON(v);
              $("#"+"d_name"+id_d).val(val.d_name);
              $("#"+"d_title"+id_d).val(val.d_title);
              chkbox = val.d_small_img_url_check != '1' ? false : true;
              $("#"+"d_small_img_url_check"+id_d).prop('checked', chkbox);
              $("#"+"image_upload_value"+id_d+"_d_image_url").val(val.d_image_url);
              %%[ IF @environmentAppCentre == 'UAT' THEN ]%%
              console.log('val: ' + val);
              console.log('val.d_name: ' + val.d_name);
              console.log('val.d_name: ' + val.d_title);
              console.log('val.d_name: ' + val.d_image_url);
              console.log('val.d_small_img_url_check: ' + val.d_small_img_url_check);
              %%[ ENDIF ]%%
            };
          }          

          function submit_onchange_val(source,doNotSubmitOnValue,form) {
            if ($('#' + source).val() != doNotSubmitOnValue) { $('#' + form).submit(); };
             %%[ IF @environmentAppCentre == "UAT" THEN ]%%
              console.log('executed submit_onchange_val('+source+','+doNotSubmitOnValue+','+form+')');
             %%[ ENDIF ]%%
          }

          function show_or_hide_on_click(t) {
            if ($('#' + t).css("display") == 'none') { 
              $('#' + t).css("display","block"); %%[ IF @environmentAppCentre == 'UAT' THEN ]%%console.log('shown');%%[ ENDIF ]%% 
            } else { 
              $('#' + t).css("display","none"); %%[ IF @environmentAppCentre == 'UAT' THEN ]%%console.log('hidden');%%[ ENDIF ]%% 
            };
          }

          function hide_or_show_on_click(t) {
            if ($('#' + t).css("display") == 'none') { 
              $('#' + t).css("display","none"); %%[ IF @environmentAppCentre == 'UAT' THEN ]%%console.log('hidden');%%[ ENDIF ]%% 
            } else { 
              $('#' + t).css("display","block"); %%[ IF @environmentAppCentre == 'UAT' THEN ]%%console.log('shown');%%[ ENDIF ]%% 
            };
          }

          function show_fields_if_checked_and_custom_value(v,s,t) {
            if ($('#' + v).val() != 'None') { 
              if($("#" + s).is(":checked")) {} 
              else { $("#" + t).show(); } 
            } 
            else { $("#" + t).hide(); }  
          }

          function click_to_trigger(t) {
            $('#' + t).trigger("click"); console.log('click triggered');
          }

          function color_pick_field(s) {
            var id = '#' + s;
            $(id).colorpicker({format: 'hex',popover: false,inline: false,container: id });
          }

          function uuidv4() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
              var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
              return v.toString(16);
            });
          }

        function hide_or_show_group(s,t1,t2,t3,v) {
          if ($('#' + s).is(":checked")) { 
            $("div[id=" + t1 + "]").hide();
            $("div[id=" + t2 + "]").hide();
            $("#" + t3).hide();
          } else { 
            $("div[id=" + t1 + "]").show();
            $("div[id=" + t2 + "]").show();
            if ($('#' + v).val() != 'None') { 
              $("#" + t3).show(); 
            } else { 
              $("#" + t3).hide(); 
            } 
          } 
        }

        function enable_sel_on_change(s,[t],v) {
          if ($('#' + s).val() == v) { 
            for (i = 0; i < [t].length; i++) {
              $('#' + [t][i]).prop('disabled',false); console.log('enabled: ' +[t][i]); 
            }
          }
        }

        function disable_sel_on_change(s,[t],v) {
          if ($('#' + s).val() == v) { 
            for (i = 0; i < [t].length; i++) {
              $('#' + [t][i]).prop('disabled',true); %%[ IF @environmentAppCentre == 'UAT' THEN ]%%console.log('disabled: ' +[t][i]);%%[ ENDIF ]%%
            }
          }
        }

        function true_if_clicked(t) {
          $('#' + t).val('1');
          %%[ IF @environmentAppCentre == 'UAT' THEN ]%%
            console.log('true_if_clicked form - value t: '+t);
          %%[ ENDIF ]%%
        }

        function image_upload(file,action_area,id) {
          var reader = new FileReader();
          reader.readAsDataURL(file);
          reader.onload = function() {
              $('.modall').modal('show');
              var fileEncoded = reader.result;
              var uuid = uuidv4();
              var base64enc = fileEncoded.split(";base64,")[1];
              var fullFileName = document.getElementById("upload_image_file" + action_area + id).files[0].name;
              var fileName = fullFileName.split(".")[0];
              var assetName = fullFileName.split(".")[1];
              var accountId = 1466763;
              var categoryId = 834517;
              fetch("https://cloud.e.newsdigitalmedia.com.au/fast_image_upload_url", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                source: "%%=v(@app)=%%",
                env: "%%=v(@AppStateEnvironment)=%%",
                fileName: fileName,
                appStateId: uuid,
                assetName: assetName,
                accountId: 1466763,
                categoryId: 834517,
                base64enc: base64enc
                })
              })
              .then(response => response.text() )
              .then( data => {
                var image_url = data.trim().replaceAll('"',''); 
                %%[ IF @environmentAppCentre == 'UAT' THEN ]%%
                console.log(image_url);
                %%[ ENDIF ]%%
                $("#image_upload_value" + action_area + id).val(image_url);
                $('.modall').modal('hide');
              })
              .catch(function(err) { console.log(err); $('.modall').modal('hide'); });
            };
          reader.onerror = function(error) {};
        }

        function execute_image_upload(action_area,id) {
          var files = document.getElementById("upload_image_file" + action_area + id).files;
          if (files[0].size > 210000) {
            window.alert("The image file is too large. Please make sure your image size is less than 200kb.");
            files.value = "";
          } else {
            image_upload(files[0],action_area,id);
          }
        }

        function load_quote_text_logic(event_id) {
          var toolbarOptions = [
            [{undo: 'undo'},{redo: 'redo'}],
            ['bold', 'italic', 'underline'],        
            ['link'],
            [{ 'align': [] }],
            ['clean']                               
          ];

          var options = { 
            toolbar: { container: toolbarOptions, handlers: { redo() { this.quill.history.redo(); }, undo() { this.quill.history.undo(); } } }, 
            history: { delay: 2000, maxStack: 500, userOnly: true } 
          };

          var editor = new Quill('#editor' + event_id, { modules: options, theme: 'snow'});
          $(".ql-undo").html('<i class="fas fa-undo cBlack"></i>');
          $(".ql-redo").html('<i class="fas fa-redo cBlack"></i>');
        }

        var isAdmin = %%=IIF(@role == 'Admin','true','false')=%%;

        function load_home_page_logic() {
          function searchLogic() {
              const filterTarget = ['FilterAsset', 'FilterAsset2', 'FilterAsset3'];
              const filterGridBodyRows = ['#recentTabelBody tbody tr', '#scheduledSendTableBody tbody tr', '#sendInTableBody tbody tr'];
              let input, filter;
              let newDiv = document.createElement('div');
              input = document.getElementById('assetsInputSearch');
              filter = input.value.toUpperCase().trim();
              [...filterTarget].forEach((item, i) => {
                  const rootFilterElement = document.getElementById(item);
                  const filterRowsElement = rootFilterElement.querySelectorAll(filterGridBodyRows[i]);
                  [...filterRowsElement].forEach((row) => {
                    let rowTextContent = row.textContent.toUpperCase();
                    let finalText = rowTextContent.replace('OPEN', '');
                    row.style.display = finalText.includes(filter) ? '' : 'none';
                  });
              });
          }
          document.getElementById('assetsInputSearch').addEventListener('keyup', () => {
            searchLogic();
          });

          document.getElementById('assetsInputSearch').addEventListener('search', () => {
            input = document.getElementById("assetsInputSearch");
            input.value = '';
            searchLogic();
          });
          console.trace(document);
          var outRows_sl = '%%=v(@outRows_sl)=%%';
          if (outRows_sl == 1 || outRows_sl == '1') {
            $("#scheduled_sends_tab").css("max-height","40px");
          } else {
            $("#scheduled_sends_tab").css("max-height","150px");
          };
          %%[ IF @environmentAppCentre == 'UAT' THEN ]%%
            console.log('changed outRows_sl max-height');
          %%[ ENDIF ]%%

          const infoToolTipDiv = document.getElementById('tooltip-home-page');
          const scheduledSendGridHeader = document.getElementById('scheduledSendTableHeader');
          const scheduledSendGridBody = document.getElementById('scheduledSendTableBody');
          var isAdmin = %%=IIF(@role == 'Admin','true','false')=%%;
          const elementIds = ['adminColumn01', 'adminColumn02', 'adminColumn03'];
          const tabel = document.getElementById('sendInTableBody');
          elementIds.forEach((item) => {
            const elementId = document.getElementById(item);
            isAdmin = elementId ? true : false;
          });
          getLongerTextCell(tabel);
          gridColumnwidthMapRecentTabel();
          gridColumnwidthMapsendInTableHeader();
          gridInjectHandlers();
          gridColumnwidthMapScheduledSendHeader();
          gridHeaderArrorwToggle('#scheduledSendTableHeader tr td.clickable');
          gridHeaderArrorwToggle('#recentTabelHeader tr td.clickable');
          gridHeaderArrorwToggle('#sendInTableHeader tr td.clickable');
          disableColumnSort();


          function gridInjectHandlers() {
            let eventCount = -1;
            let targetTabelName = 'scheduledSendTableBody';
            const headerRow = scheduledSendGridHeader.rows;
            [...headerRow].forEach((item) => {
              let headerCell = item.getElementsByTagName('td');
              [...headerCell].forEach((item) => {
                eventCount++;
                item.setAttribute('onclick', 'sortHomeTable(' + eventCount + ',' +  'scheduledSendTableBody' + ')');
                item.setAttribute('class', 'clickable');
                item.classList.add('asc');
              });
            });
          }
          
          function gridHeaderArrorwToggle(targetedTableCells) {
            const cells3 = document.querySelectorAll(targetedTableCells);
            cells3.forEach((cell) => {
              cell.addEventListener('click', () => { 
                if (cell.getAttribute('class').split(' ')[1] === 'asc') {
                    cell.classList.remove('asc');
                    cell.classList.add('desc');
                } else {
                    cell.classList.remove('desc');
                    cell.classList.add('asc');
                };
              });
            });
          }
          window.onresize = function() { 
            gridColumnwidthMapRecentTabel();
            gridColumnwidthMapsendInTableHeader();
            gridColumnwidthMapScheduledSendHeader();
          };
          function gridColumnwidthMapRecentTabel() {
            const tabelHeader = document.getElementById('recentTabelHeader');
            const tabel = document.getElementById('recentTabelBody');
            const tabelRows = tabel.rows;
              if(tabel.rows.length > 1) {
                const headerCell = tabelHeader.rows[0];
                const headerElements = headerCell.getElementsByTagName('td');
                const bodyCell =  tabel.rows[0];
                const cell = bodyCell.getElementsByTagName('td');
                [...headerElements].forEach((item, i) => {
                  if(i === 7) {
                  } else if(i === 6) {
                    cell[i].setAttribute('style', 'width:' + item.offsetWidth + 'px !important' + ';' + 'padding-right: 15px;text-align: right!important');
                  } else {
                    cell[i].setAttribute('style', 'width:' + item.offsetWidth + 'px !important');
                  };
                });
              } else {
                if(tabel.textContent.trim() === 'No Row Found') {
                } else {
                  noRowFound(tabel, determineColspanCount(tabelHeader));
                };
              };
          }
          function disableColumnSort() {
            const gridBodyList = ['recentTabelBody', 'scheduledSendTableBody', 'sendInTableBody'];
            [...gridBodyList].forEach((item, i) => {
                const gridBody = document.getElementById(item);
                chooseTheTableHeadToDisable(gridBody, i);
            });
          }
          function chooseTheTableHeadToDisable(gridBody, index) {
            const gridHeaderList = ['recentTabelHeader', 'scheduledSendTableHeader', 'sendInTableHeader'];
            const gridRows = gridBody.rows;
            [...gridRows].forEach((row) => {
              const gridCell =  row.getElementsByTagName('td');
              [...gridCell].forEach((cell) => {
                if(cell.innerHTML === 'No Row Found' || cell.innerHTML === 'There are no sends created in this brand that are currently scheduled.') {
                  const gridHeaderElement = document.getElementById(gridHeaderList[index]);
                   const headerRows =  gridHeaderElement.rows;
                   [...headerRows].forEach((row) => {
                      const headerCell =  row.getElementsByTagName('td');
                      [...headerCell].forEach((cell) => {
                        cell.style.pointerEvents = 'none';
                        cell.style.cursor = 'not-allowed';
                        cell.style.opacity = '0.4';
                      });
                   });
                };
              });
            });
          }
          function gridColumnwidthMapsendInTableHeader() {
            const tabelHeader = document.getElementById('sendInTableHeader');
            const tabel = document.getElementById('sendInTableBody');
              if(tabel.rows.length > 1) {
                const headerCell = tabelHeader.rows[0];
                const headerElements = headerCell.getElementsByTagName('td');
                const bodyCell =  tabel.rows[0];
                const cell = bodyCell.getElementsByTagName('td');
                [...headerElements].forEach((item, i) => {
                  if(i === (isAdmin ? 8 : 5)) {
                    } else {
                      cell[i].setAttribute('style', 'width:' + item.offsetWidth + 'px !important');
                    };     
                });
              } else {
                if(tabel.textContent.trim() === 'No Row Found') {
                } else {
                  noRowFound(tabel, determineColspanCount(tabelHeader));
                };
              };
          }
          function determineColspanCount(tabelHeader) {
            const headerCell = tabelHeader.rows[0];
            const headerElements = headerCell.getElementsByTagName('td');
            let headerCellLength;
            [...headerElements].forEach((item, i, arr) => {
              headerCellLength =  arr.length;
            });
            return headerCellLength;
          }
          function noRowFound(tabel, cellCount) {
              const newRow = tabel.insertRow();
              const newCell = newRow.insertCell(0);
              newCell.textContent = 'No Row Found';
              newCell.colSpan = cellCount;
              newCell.setAttribute('class', 'noRow');
          }
          function gridColumnwidthMapScheduledSendHeader() {
             const headerTable = document.getElementById('scheduledSendTableHeader');
             const bodyTable = document.getElementById('scheduledSendTableBody');
             const headerRow = headerTable.rows;
             const bodyRows = bodyTable.rows;
             const headerRowTd = headerRow[0].getElementsByTagName('td');
             const headerInnerWidth = [];
             [...headerRowTd].forEach((item, i, arr) => {
              headerInnerWidth.push(item.offsetWidth);
              if(i === arr.length -1) {
                 item.removeAttribute("onclick");
                 item.removeAttribute("class");
              }; 
             });
             [...bodyRows].forEach((rowItem) => {
                if (rowItem.getAttribute('class') === 'no-data-row') {
                } else {
                  const rowTd = rowItem.getElementsByTagName('td');
                  [...rowTd].forEach((rowCellItem, i, arr) => {
                    rowCellItem.setAttribute('style', 'width:' + headerInnerWidth[i] + 'px !important');
                  });
                };      
             });
          }
          function getLongerTextCell(tabel) { 
            const test = tabel.rows;
              [...test].forEach((item) => {
                const rowItem = item;
                const rowCell = rowItem.getElementsByTagName('td');
                [...rowCell].forEach((item, i) => {
                  if(i === (isAdmin ? 6 : 3) || i === (isAdmin ? 7 : 4)) {
                    if(item.textContent === '') {
                       if (item.className === 'emptyCell') {
                        item.innerHTML = '';
                       } else {
                        item.innerHTML = '';
                       };
                    };
                    item.addEventListener('mousemove', (e) => {
                      if (item.textContent === '') {
                      } else {
                        handleMousePosition(e, infoToolTipDiv);
                        infoToolTipDiv.innerHTML = item.textContent;
                        isDivTouchingWindowCorner(e);
                      };
                    }); 
                    handleMouseOut(item);
                  };
                });
              });
          }
          function handleMousePosition(e, div) {
            let posX = e.clientX;
            let posY = e.clientY;
            div.style.display = 'block';
            div.style.position = 'fixed';
            div.style.top = posY + 15 + 'px';
            div.style.left = posX + 10 + 'px';
          }
          function handleMouseOut(e) {
            e.addEventListener('mouseout', () => {
              infoToolTipDiv.style.display = 'none';
            });
          }
          function isDivTouchingWindowCorner(e) {
                const rect = infoToolTipDiv.getBoundingClientRect();
                const windowWidth = window.innerWidth;
                const windowHeight = window.innerHeight;
                const isTouchingTop = rect.top <= 0;
                const isTouchingBottom = rect.bottom >= windowHeight;
                const isTouchingLeft = rect.left <= 0;
                const isTouchingRight = rect.right >= windowWidth;
                if(isTouchingBottom) {
                  infoToolTipDiv.style.top = e.clientY - 50 + 'px';
                };
                return isTouchingTop || isTouchingBottom || isTouchingLeft || isTouchingRight;
          }
        }

        function parseDateStringToDate(dateString) {
            var dateComponents = dateString.split(/[\s\/:]/);
            if(dateComponents !== undefined) {
              if (dateComponents[5].toLowerCase() === 'pm') {
                  dateComponents[3] = String(Number(dateComponents[3]) + 12);
              };
              var formattedDate = new Date('20' + dateComponents[2],dateComponents[1] - 1,dateComponents[0],dateComponents[3],dateComponents[4]);
            };
            return formattedDate;
          }

        function typeChecker(Xvalue, Yvalue, col, tableID) {
            let trimXValue = Xvalue.trim();
            let trimYValue = Yvalue.trim();
            const processedValue = { x: '', y: '' };
            if(tableID === 'recentTabelBody') {
              if (col === 0) {
              processedValue.x = +trimXValue;
              processedValue.y = +trimYValue;
              } else if (col === 1 || col === 2 || col === 3 || col === 4) {
                processedValue.x = trimXValue;
                processedValue.y = trimYValue;
              } else if(col === 5) {
                if(trimXValue !== '' && trimYValue !== '') {
                  processedValue.x = parseDateStringToDate(trimXValue);
                  processedValue.y = parseDateStringToDate(trimYValue);
                };
              };
              return processedValue;
            } else if (tableID === 'sendInTableBody') {
                if (col === 0) {
                  if(trimXValue !== '' && trimYValue !== '') {
                    processedValue.x = parseDateStringToDate(trimXValue);
                    processedValue.y = parseDateStringToDate(trimYValue);
                 };
                } else {
                  processedValue.x = trimXValue;
                  processedValue.y = trimYValue;
                };
              return processedValue;
            } else if (tableID === 'scheduledSendTableBody') {
              if(col === 1 || col === 2 || col ===3) {
                if(trimXValue === '--' || trimYValue === '--') {
                  processedValue.x = trimXValue;
                  processedValue.y = trimYValue;
                } else {
                  processedValue.x = parseDateStringToDate(trimXValue);
                  processedValue.y = parseDateStringToDate(trimYValue);
                };
              } else {
                processedValue.x = trimXValue;
                processedValue.y = trimYValue;
              };
              return processedValue;
            };
          }

        function typeConverter(tableID) {
              if(typeof tableID === 'string') {
                return tableID;
              } else {
                return tableID.getAttribute('id');
              };
          }

        function sortHomeTable(n, tableID) {
            const tableToSort = typeConverter(tableID);
            var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
            table = document.getElementById(tableToSort);
            switching = true;
            dir = "asc"; 
            while (switching) {
              switching = false;
              rows = table.rows;
              for (i = 0; i < (rows.length - 1); i++) {
                shouldSwitch = false;
                x = rows[i+1].getElementsByTagName('td')[n];
                y = rows[i].getElementsByTagName('td')[n];
                  const processedValue = typeChecker(x.textContent, y.textContent, n, tableToSort); 
                if (dir == "asc") {
                  if (processedValue.x > processedValue.y) {
                    shouldSwitch= true;
                    break;
                  }
                } else if (dir == "desc") {
                  if (processedValue.x < processedValue.y) {
                    shouldSwitch = true;
                    break;
                  };
                };
              };
              if (shouldSwitch) {
                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                switching = true;
                switchcount ++;      
              } else {
                if (switchcount == 0 && dir == "asc") {
                  dir = "desc";
                  switching = true;
                };
              };
            };
          }

        function load_free_text_logic(event_id) {
          var toolbar_id = '#toolbar' + event_id;
          var editor_id = '#editor' + event_id;

          var options = {
              toolbar: { 
                container: toolbar_id,
                handlers: { 
                  redo() { this.quill.history.redo(); }, 
                  undo() { this.quill.history.undo(); },
                  'image': showImageUI,
                  'image2': function() {
                        var range = this.quill.getSelection();
                        var value = prompt('please copy paste the image url here.');
                        if (value) {
                           this.quill.insertEmbed(range.index, 'image', value, Quill.sources.USER);
                        }
                     },
                  'emoji': function() {},
                  'multi_col': function () {
                      var range = this.quill.getSelection();
                      var cursorPosition = this.quill.getSelection().index;
                      var value = '-------------------------------------------------------||next colomn||------------------------------------------------------';
                      if(value){
                          this.quill.insertText(cursorPosition, value);
                          this.quill.setSelection(cursorPosition + 125);
                      }
                  },
                  'cta': function () {
                      var range = this.quill.getSelection();
                      var cursorPosition = this.quill.getSelection().index;
                      var value = '|||_CTA_link_|||';
                      if(value){
                          this.quill.insertText(cursorPosition, value);
                          this.quill.setSelection(range.index, 16);
                      }
                      click_to_trigger('link' + event_id);
                  },
                  'linebreak': function () {
                    var range = this.quill.getSelection();
                      var cursorPosition = this.quill.getSelection().index;
                      var value = '*||linebreak||*';
                      if(value){
                          this.quill.insertText(cursorPosition, value);
                          this.quill.setSelection(range.index, 15);
                      }
                  },
                  'divider': function () {
                    var range = this.quill.getSelection();
                      var cursorPosition = this.quill.getSelection().index;
                      var value = '*||divider||*';
                      if(value){
                          this.quill.insertText(cursorPosition, value);
                          this.quill.setSelection(range.index, 15);
                      }
                  }
                } 
              }, 
              history: { delay: 3000, maxStack: 500, userOnly: false },
              "emoji-toolbar": true,
              "emoji-textarea": false,
              "emoji-shortname": true
            };

            function showImageUI() {
              var editor_id = 'editor' + event_id;
              var fileInput = this.container.querySelector('input.ql-image[type=file]');
              var range = this.quill.getSelection();
              this.quill.enable(true);
              if (fileInput == null) {
                fileInput = document.createElement('input');
                fileInput.setAttribute('type', 'file');
                fileInput.setAttribute('accept', 'image/png, image/gif, image/jpeg, image/bmp, image/x-icon');
                fileInput.classList.add('ql-image');
                fileInput.addEventListener('change', () => {
                  if (fileInput.files != null && fileInput.files[0] != null && fileInput.files[0].size < 1500000) {
                      $('.modall').modal('show');
                      var uuid = uuidv4();
                      var reader = new FileReader();
                      reader.onload = function(e) {
                        var fileEncoded = reader.result;
                        var base64enc = fileEncoded.split(";base64,")[1];
                        var fullFileName = fileInput.files[0].name;
                        var fileName = fullFileName.split(".")[0];
                        var assetName = fullFileName.split(".")[1];
                        fetch("https://cloud.e.newsdigitalmedia.com.au/%%=IIF(@AppStateEnvironment == 'UAT','uat_image_url_response','image_upload_url_response')=%%", { 
                          method: "POST",
                          headers: {
                            "Content-Type": "application/json"
                          },
                          body: JSON.stringify({
                            source: "%%=v(@app)=%%",
                            env: "%%=v(@AppStateEnvironment)=%%",
                            fileName: fileName,
                            appStateId: uuid,
                            assetName: assetName,
                            accountId: 1466763,
                            categoryId: 834517,
                            base64enc: base64enc
                          })
                        })
                        .then(response => response.text() )
                        .then( data => {
                          var image_url = data.trim().replaceAll('"','');
                          %%[ IF @environmentAppCentre == 'UAT' THEN ]%%
                          console.log(image_url);
                          console.log(editor);
                          %%[ ENDIF ]%%
                          editor.insertEmbed(range.index, 'image', image_url);
                          fileInput.value = '';
                          $('.modall').modal('hide');
                        })
                        .catch(function(err) { console.log(err) });
                      };
                    var range = this.quill.getSelection();
                    reader.onerror = function(error) {};
                    reader.readAsDataURL(fileInput.files[0]);
                  } else {
                    window.alert("The image file is too large. Please make sure your image smaller than 1.5mb.");
                  }
                });
                this.container.appendChild(fileInput);
              }
              fileInput.click();
            }

            Quill.prototype.getHtml = function() {return this.container.querySelector('.ql-editor').innerHTML;};
            var editor = new Quill(editor_id, { modules: options, theme: 'snow'});
            var quillEd_txtArea_1 = document.createElement('textarea');
            var attrQuillTxtArea = document.createAttribute('quill__html');
            quillEd_txtArea_1.setAttributeNode(attrQuillTxtArea);
            var quillCustomDiv = editor.addContainer('ql-custom');
            quillCustomDiv.appendChild(quillEd_txtArea_1);
            var quillsHtmlBtns = document.querySelectorAll('.ql-html');
            for (var i = 0; i < quillsHtmlBtns.length; i++){
                  quillsHtmlBtns[i].addEventListener('click', function(evt) {
                      var wasActiveTxtArea_1 =
                          (quillEd_txtArea_1.getAttribute('quill__html').indexOf('-active-') > -1);
                      if (wasActiveTxtArea_1) {
                          editor.pasteHTML(quillEd_txtArea_1.value);
                          evt.target.classList.remove('ql-active');
                      } else {
                          quillEd_txtArea_1.value = editor.getHtml();
                          evt.target.classList.add('ql-active');
                      }
                      quillEd_txtArea_1.setAttribute('quill__html', wasActiveTxtArea_1 ? '' : '-active-');
                  });
            }

            class QuillToolbarItem{constructor(e){let t=this;t.options=e,t.qlFormatsEl=document.querySelector("#ql_formats_id"+event_id)}attach(e){let t=this;t.quill=e,t.toolbar=e.getModule("toolbar"),t.toolbarEl=t.toolbar.container,t.toolbarEl.appendChild(t.qlFormatsEl)}detach(e){this.toolbarEl.removeChild(this.qlFormatsEl)}_getTextWidth(e,t="500 14px 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif"){let l=this._getTextWidth.canvas||(this._getTextWidth.canvas=document.createElement("canvas")),o=l.getContext("2d");o.font=t;let n=o.measureText(e);return n.width}_addCssRule(e){let t=document.createElement("style");document.head.appendChild(t),t.sheet.insertRule(e,0)}_generateId(){return Math.random().toString().substr(2,10)}}class QuillToolbarDropDown extends QuillToolbarItem{constructor(e){super(e);let t=this;t.id=t.options.id||`dropdown-${t._generateId()}`;let l=document.createElement("span");l.className=`ql-${t.id} ql-picker`,t.qlFormatsEl.appendChild(l);let o=document.createElement("span");o.className="ql-picker-label",l.appendChild(o),o.addEventListener("click",function(e){l.classList.toggle("ql-expanded")}),window.addEventListener("click",function(e){l.contains(e.target)||l.classList.remove("ql-expanded")});let n=document.createElement("span");n.className="ql-picker-options",l.appendChild(n),t.dropDownEl=l,t.dropDownPickerEl=t.dropDownEl.querySelector(".ql-picker-options"),t.dropDownPickerLabelEl=t.dropDownEl.querySelector(".ql-picker-label"),t.dropDownPickerLabelEl.innerHTML='<svg viewBox="0 0 18 18"> <polygon class="ql-stroke" points="7 11 9 13 11 11 7 11"></polygon> <polygon class="ql-stroke" points="7 7 9 5 11 7 7 7"></polygon> </svg>',t.setLabel(t.options.label||""),t.setItems(t.options.items||{}),t._addCssRule(`.ql-snow .ql-picker.ql-${t.id} .ql-picker-label::before, .ql-${t.id} .ql-picker.ql-size .ql-picker-item::before {content: attr(data-label);}`)}setItems(e){let t=this;for(let[l,o]of Object.entries(e)){let n=document.createElement("span");n.className="ql-picker-item",n.innerHTML=l,n.setAttribute("data-value",o),n.onclick=function(e){t.dropDownEl.classList.remove("ql-expanded"),t.options.rememberSelection&&t.setLabel(l),t.onSelect&&t.onSelect(l,o,t.quill)},t.dropDownPickerEl.appendChild(n)}}setLabel(e){let t=this,l=`${t._getTextWidth(e)+30}px`;t.dropDownPickerLabelEl.style.width=l,t.dropDownPickerLabelEl.setAttribute("data-label",e)}onSelect(e,t,l){}}class QuillToolbarButton extends QuillToolbarItem{constructor(e){super(e);let t=this;t.id=t.options.id||`button-${t._generateId()}`,t.qlButton=document.createElement("button"),t.qlButton.className=`ql-${t.id}`,t.setValue(t.options.value),t.setIcon(t.options.icon),t.qlButton.onclick=function(){t.onClick(t.quill)},t.qlFormatsEl.appendChild(t.qlButton)}setIcon(e){let t=this;t.qlButton.innerHTML=e}setValue(e){let t=this;t.qlButton.value=e}getValue(){return this.qlButton.value}onClick(e,t){}};

            const dropDownItems = {
                'Weekday':'[[[Weekday]]]',
                'Day of the month':'[[[DOTM]]]',
                'Day suffix (th, nd, rd)':'[[[DSFX]]]',
                'Month name':'[[[MonthName]]]',
                'Time of day':'[[[TimeOfDay]]]',
                'First name customer': '[[[FirstName]]]',
                'Last name customer': '[[[LastName]]]',
                'Email customer': '[[[EmailAddress]]]',
                'Postcode customer': '[[[PostCode]]]',
                'Current brand name': '[[[BrandName]]]',
                'Current masthead name': '[[[MastheadName]]]',
                'Current masthead website link': '[[[SiteLink]]]'
            };
            const myDropDown = new QuillToolbarDropDown({
                label: "Personalisation strings",
                rememberSelection: false
            });
            myDropDown.setItems(dropDownItems);
            myDropDown.onSelect = function(label, value, quill) {
                const { index, length } = quill.selection.savedRange;
                quill.deleteText(index, length);
                quill.insertText(index, value);
                quill.setSelection(index + value.length);
            };
            myDropDown.attach(editor);

            /* Add a custom Button to the Quill Editor's toolbar:
            const myButton = new QuillToolbarButton({
                icon: `<svg viewBox="0 0 18 18"> <path class="ql-stroke" d="M5,3V9a4.012,4.012,0,0,0,4,4H9a4.012,4.012,0,0,0,4-4V3"></path></svg>`
            })
            myButton.onClick = function(quill) {
                const { index, length } = quill.selection.savedRange
                const selectedText = quill.getText(index, length)
                const newText = selectedText.toUpperCase()
                quill.deleteText(index, length)
                quill.insertText(index, newText)
                quill.setSelection(index, newText.length)
            }
            myButton.attach(editor);
            */
          }

          function change_single_input_value_on_click(id,value) {
            $('#'+id).val(value);
          }

          async function appC_p_form_requests_api(app,id,action_area) {
            $('.modall').modal('show');
              event.preventDefault();
              event.stopPropagation();
              let form_id = 'appC_p_form_requests_api';
              let data = new FormData(event.target);
              let formJSON = Object.fromEntries(data.entries());
              let selectedDays = data.getAll("days_of_the_week").toString();
              formJSON.days_of_the_week = selectedDays;
              console.log(formJSON);
              let request_type = formJSON.request_type;
              let disable_send_if_scheduled = formJSON.disable_send_if_scheduled;
              %%[ IF @environmentAppCentre == 'UAT' THEN ]%%
              console.log('form id: ' + form_id + ' | request type: ' + request_type);
              %%[ ENDIF ]%%
              try {
                let response = await fetch('https://cloud.e.newsdigitalmedia.com.au/%%=IIF(@appStateEnvironment == "UAT","uat_","")=%%gaf_api?form_id='+form_id+'&sys_env=%%=v(@environmentAppCentre)=%%&c=%%=v(@cookie)=%%&app='+app+'&p_id='+id+'&rt='+request_type+'&aa='+action_area+'&biz_env=%%=v(@appStateEnvironment)=%%', {
                  method: 'POST',
                  body: JSON.stringify(formJSON, null, 2)
                });
                let resp = await response.json();
                console.log(resp.form_message); console.log(resp.message_color); console.log('resp: ' + JSON.stringify(resp.description));
                let rm = resp.form_message ? resp.form_message : "Couldn't perform this action. The SFMC team has been notified and will get back to you shortly.";
                let rc = (resp.message_color != 'danger' && resp.message_color != 'success' && resp.message_color != 'warning') ? 'danger' : resp.message_color;
                if (resp.message == 'reloadpage') {
                  window.location.reload(true);
                  show_client_side_message('User session expired. Logging out...','warning');
                } else {
                  if (request_type != 'save' && resp.message_color == 'success') {
                    appC_ui_component('appC_p_programs_form_ui','sch_options_tab','','app=email_editor&aa=edit','0','1');
                  }
                  %%[ IF @app == 'Email Editor' THEN ]%%
                    document.getElementById('next_run_field').innerHTML = '';
                    if (request_type == 'save_and_schedule' && disable_send_if_scheduled && resp.message_color == 'success') {
                      let button = '#send_step_button'; 
                      $(button).prop('disabled',true); 
                      $(button).css('background-color','#c5c5c5');
                      document.getElementById('scheduled_status_id').innerHTML = '(Scheduled)';
                      console.log('disable send button');
                    } else {
                        if (request_type == 'pause') {
                          let button = '#send_step_button';
                          %%[ IF @currentProgress == 2 THEN ]%%
                          $(button).prop('disabled',false); 
                          $(button).css('background-color','#497edd');
                          %%[ ENDIF ]%%
                          document.getElementById('scheduled_status_id').innerHTML = '3. Real send';
                          %%[ IF @environmentAppCentre == 'UAT' THEN ]%%
                          console.log('enable send button');
                          %%[ ENDIF ]%%
                        }
                        %%[ IF @environmentAppCentre == 'UAT' THEN ]%%
                        console.log('disable_send_if_scheduled: ' + disable_send_if_scheduled + ' | request_type: ' + request_type);
                        %%[ ENDIF ]%%
                    }
                  %%[ ENDIF ]%%
                  show_client_side_message(rm,rc);
                }
                $('.modall').modal('hide');
              } catch (e) {
                show_client_side_message("Couldn't perform the '"+action_area+"' action. The SFMC team has been notified and will get in touch during business hours. For urgent matters, please email shared_marketingcloud@news.com.au or raise an incident ticket by calling 1300006397 (select option 2 for Tech).","danger");
                $("#emailPreviewIframe").css("display","none");
                $('.modall').modal('hide');
                $("#loading_preview_right_view").hide();
                $("#error_right_view").css("display","block");
                %%[ IF @environmentAppCentre == "UAT" THEN ]%%
                  console.log('error: '+ e);
                %%[ ENDIF ]%%
              }
          }

        window.FontAwesomeKitConfig={asyncLoading:{enabled:!0},autoA11y:{enabled:!0},baseUrl:"https://kit-free.fontawesome.com",detectConflictsUntil:null,license:"free",method:"css",minify:{enabled:!0},v4FontFaceShim:{enabled:!0},v4shim:{enabled:!0},version:"latest"},function(){function e(e){var t,n=[],i=document,o=i.documentElement.doScroll,a="DOMContentLoaded",r=(o?/^loaded|^c/:/^loaded|^i|^c/).test(i.readyState);r||i.addEventListener(a,t=function(){for(i.removeEventListener(a,t),r=1;t=n.shift();)t()}),r?setTimeout(e,0):n.push(e)}function t(e){var t,n,i,o;prefixesArray=e||["fa"],prefixesSelectorString="."+Array.prototype.join.call(e,",."),t=document.querySelectorAll(prefixesSelectorString),Array.prototype.forEach.call(t,function(e){n=e.getAttribute("title"),e.setAttribute("aria-hidden","true"),i=!e.nextElementSibling||!e.nextElementSibling.classList.contains("sr-only"),n&&i&&((o=document.createElement("span")).innerHTML=n,o.classList.add("sr-only"),e.parentNode.insertBefore(o,e.nextSibling))})}!function(){if(!(void 0===window.Element||"classList"in document.documentElement)){var e,t,n,i=Array.prototype,o=i.push,a=i.splice,r=i.join;d.prototype={add:function(e){this.contains(e)||(o.call(this,e),this.el.className=this.toString())},contains:function(e){return-1!=this.el.className.indexOf(e)},item:function(e){return this[e]||null},remove:function(e){if(this.contains(e)){for(var t=0;t<this.length&&this[t]!=e;t++);a.call(this,t,1),this.el.className=this.toString()}},toString:function(){return r.call(this," ")},toggle:function(e){return this.contains(e)?this.remove(e):this.add(e),this.contains(e)}},window.DOMTokenList=d,e=Element.prototype,t="classList",n=function(){return new d(this)},Object.defineProperty?Object.defineProperty(e,t,{get:n}):e.__defineGetter__(t,n)}function d(e){for(var t=(this.el=e).className.replace(/^\s+|\s+$/g,"").split(/\s+/),n=0;n<t.length;n++)o.call(this,t[n])}}();var n,i,o,a,r,d=function(e,t){var n=document.createElement("link");n.href=e,n.media="all",n.rel="stylesheet",n.id="font-awesome-5-kit-css",t&&t.detectingConflicts&&t.detectionIgnoreAttr&&n.setAttributeNode(document.createAttribute(t.detectionIgnoreAttr)),document.getElementsByTagName("head")[0].appendChild(n)},s=function(e,t){!function(e,t){var n,i=t&&t.before||void 0,o=t&&t.media||void 0,a=window.document,r=a.createElement("link");if(t&&t.detectingConflicts&&t.detectionIgnoreAttr&&r.setAttributeNode(document.createAttribute(t.detectionIgnoreAttr)),i)n=i;else{var d=(a.body||a.getElementsByTagName("head")[0]).childNodes;n=d[d.length-1]}var s=a.styleSheets;r.rel="stylesheet",r.href=e,r.media="only x",function e(t){if(a.body)return t();setTimeout(function(){e(t)})}(function(){n.parentNode.insertBefore(r,i?n:n.nextSibling)});var c=function(e){for(var t=r.href,n=s.length;n--;)if(s[n].href===t)return e();setTimeout(function(){c(e)})};function l(){r.addEventListener&&r.removeEventListener("load",l),r.media=o||"all"}r.addEventListener&&r.addEventListener("load",l),(r.onloadcssdefined=c)(l)}(e,t)},c=function(e,t,n){var i=t&&void 0!==t.autoFetchSvg?t.autoFetchSvg:void 0,o=t&&void 0!==t.async?t.async:void 0,a=t&&void 0!==t.autoA11y?t.autoA11y:void 0,r=document.createElement("script"),d=document.scripts[0];r.src=e,void 0!==a&&r.setAttribute("data-auto-a11y",a?"true":"false"),i&&(r.setAttributeNode(document.createAttribute("data-auto-fetch-svg")),r.setAttribute("data-fetch-svg-from",t.fetchSvgFrom)),o&&r.setAttributeNode(document.createAttribute("defer")),n&&n.detectingConflicts&&n.detectionIgnoreAttr&&r.setAttributeNode(document.createAttribute(n.detectionIgnoreAttr)),d.parentNode.appendChild(r)};function l(e,t){var n=t&&t.addOn||"",i=t&&t.baseFilename||e.license+n,o=t&&t.minify?".min":"",a=t&&t.fileSuffix||e.method,r=t&&t.subdir||e.method;return e.baseUrl+"/releases/"+("latest"===e.version?"latest":"v".concat(e.version))+"/"+r+"/"+i+o+"."+a}try{if(window.FontAwesomeKitConfig){var u,f=window.FontAwesomeKitConfig,m={detectingConflicts:f.detectConflictsUntil&&new Date<=new Date(f.detectConflictsUntil),detectionIgnoreAttr:"data-fa-detection-ignore",detectionTimeoutAttr:"data-fa-detection-timeout",detectionTimeout:null};"js"===f.method&&(a=m,r={async:(o=f).asyncLoading.enabled,autoA11y:o.autoA11y.enabled},"pro"===o.license&&(r.autoFetchSvg=!0,r.fetchSvgFrom=o.baseUrl+"/releases/"+("latest"===o.version?"latest":"v".concat(o.version))+"/svgs"),o.v4shim.enabled&&c(l(o,{addOn:"-v4-shims",minify:o.minify.enabled})),c(l(o,{minify:o.minify.enabled}),r,a)),"css"===f.method&&function(n,i){var o=t.bind(t,["fa","fab","fas","far","fal","fad"]);n.autoA11y.enabled&&(e(o),"undefined"!=typeof MutationObserver&&new MutationObserver(o).observe(document,{childList:!0,subtree:!0})),n.v4shim.enabled&&(n.license,n.asyncLoading.enabled?s(l(n,{addOn:"-v4-shims",minify:n.minify.enabled}),i):d(l(n,{addOn:"-v4-shims",minify:n.minify.enabled}),i)),n.v4FontFaceShim.enabled&&(n.asyncLoading.enabled?s(l(n,{addOn:"-v4-font-face",minify:n.minify.enabled}),i):d(l(n,{addOn:"-v4-font-face",minify:n.minify.enabled}),i));var a=l(n,{minify:n.minify.enabled});n.asyncLoading.enabled?s(a,i):d(a,i)}(f,m),m.detectingConflicts&&((u=document.currentScript.getAttribute(m.detectionTimeoutAttr))&&(m.detectionTimeout=u),document.currentScript.setAttributeNode(document.createAttribute(m.detectionIgnoreAttr)),n=f,i=m,e(function(){var e=document.createElement("script");i&&i.detectionIgnoreAttr&&e.setAttributeNode(document.createAttribute(i.detectionIgnoreAttr)),i&&i.detectionTimeoutAttr&&i.detectionTimeout&&e.setAttribute(i.detectionTimeoutAttr,i.detectionTimeout),e.src=l(n,{baseFilename:"conflict-detection",fileSuffix:"js",subdir:"js",minify:n.minify.enabled}),e.async=!0,document.body.appendChild(e)}))}}catch(c){}}();

        +function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.toggle"),f="object"==typeof b&&b;e||d.data("bs.toggle",e=new c(this,f)),"string"==typeof b&&e[b]&&e[b]()})}var c=function(b,c){this.$element=a(b),this.options=a.extend({},this.defaults(),c),this.render()};c.VERSION="2.2.0",c.DEFAULTS={on:"On",off:"Off",onstyle:"primary",offstyle:"default",size:"normal",style:"",width:null,height:null},c.prototype.defaults=function(){return{on:this.$element.attr("data-on")||c.DEFAULTS.on,off:this.$element.attr("data-off")||c.DEFAULTS.off,onstyle:this.$element.attr("data-onstyle")||c.DEFAULTS.onstyle,offstyle:this.$element.attr("data-offstyle")||c.DEFAULTS.offstyle,size:this.$element.attr("data-size")||c.DEFAULTS.size,style:this.$element.attr("data-style")||c.DEFAULTS.style,width:this.$element.attr("data-width")||c.DEFAULTS.width,height:this.$element.attr("data-height")||c.DEFAULTS.height}},c.prototype.render=function(){this._onstyle="btn-"+this.options.onstyle,this._offstyle="btn-"+this.options.offstyle;var b="large"===this.options.size?"btn-lg":"small"===this.options.size?"btn-sm":"mini"===this.options.size?"btn-xs":"",c=a('<label class="btn">').html(this.options.on).addClass(this._onstyle+" "+b),d=a('<label class="btn">').html(this.options.off).addClass(this._offstyle+" "+b+" active"),e=a('<span class="toggle-handle btn btn-default">').addClass(b),f=a('<div class="toggle-group">').append(c,d,e),g=a('<div class="toggle btn" data-toggle="toggle">').addClass(this.$element.prop("checked")?this._onstyle:this._offstyle+" off").addClass(b).addClass(this.options.style);this.$element.wrap(g),a.extend(this,{$toggle:this.$element.parent(),$toggleOn:c,$toggleOff:d,$toggleGroup:f}),this.$toggle.append(f);var h=this.options.width||Math.max(c.outerWidth(),d.outerWidth())+e.outerWidth()/2,i=this.options.height||Math.max(c.outerHeight(),d.outerHeight());c.addClass("toggle-on"),d.addClass("toggle-off"),this.$toggle.css({width:h,height:i}),this.options.height&&(c.css("line-height",c.height()+"px"),d.css("line-height",d.height()+"px")),this.update(!0),this.trigger(!0)},c.prototype.toggle=function(){this.$element.prop("checked")?this.off():this.on()},c.prototype.on=function(a){return this.$element.prop("disabled")?!1:(this.$toggle.removeClass(this._offstyle+" off").addClass(this._onstyle),this.$element.prop("checked",!0),void(a||this.trigger()))},c.prototype.off=function(a){return this.$element.prop("disabled")?!1:(this.$toggle.removeClass(this._onstyle).addClass(this._offstyle+" off"),this.$element.prop("checked",!1),void(a||this.trigger()))},c.prototype.enable=function(){this.$toggle.removeAttr("disabled"),this.$element.prop("disabled",!1)},c.prototype.disable=function(){this.$toggle.attr("disabled","disabled"),this.$element.prop("disabled",!0)},c.prototype.update=function(a){this.$element.prop("disabled")?this.disable():this.enable(),this.$element.prop("checked")?this.on(a):this.off(a)},c.prototype.trigger=function(b){this.$element.off("change.bs.toggle"),b||this.$element.change(),this.$element.on("change.bs.toggle",a.proxy(function(){this.update()},this))},c.prototype.destroy=function(){this.$element.off("change.bs.toggle"),this.$toggleGroup.remove(),this.$element.removeData("bs.toggle"),this.$element.unwrap()};var d=a.fn.bootstrapToggle;a.fn.bootstrapToggle=b,a.fn.bootstrapToggle.Constructor=c,a.fn.toggle.noConflict=function(){return a.fn.bootstrapToggle=d,this},a(function(){a("input[type=checkbox][data-toggle^=toggle]").bootstrapToggle()}),a(document).on("click.bs.toggle","div[data-toggle^=toggle]",function(b){var c=a(this).find("input[type=checkbox]");c.bootstrapToggle("toggle"),b.preventDefault()})}(jQuery);

        %%[ ENDIF ]%%
      </script>
      <div class="modall bd-example-modal-lg" data-backdrop="static" data-keyboard="false" tabindex="-1">
          <div class="modall-dialog modal-sm">
            <div class="modall-content" style="width: 48px">
              <span class="fa fa-circle-o-notch fa-spin fa-fw fa-2x"></span>
            </div>
          </div>
      </div>
  </body>
</html>